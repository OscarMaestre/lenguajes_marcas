<!DOCTYPE html>
<html class="writer-html5" lang="es" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Anexo: Ejercicios de XQuery &mdash; Apuntes de Lenguajes de Marcas v1.3</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../_static/documentation_options.js?v=7ece2587"></script>
        <script src="../../_static/doctools.js?v=888ff710"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../../_static/translations.js?v=efdbd0b9"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Índice" href="../../genindex.html" />
    <link rel="search" title="Búsqueda" href="../../search.html" />
    <link rel="prev" title="Anexo: Ejercicios de XPath" href="../xpath/anexo_ejercicios_xpath.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            Apuntes de Lenguajes de Marcas
          </a>
              <div class="version">
                1.3
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Buscar documentos" aria-label="Buscar documentos" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../tema1.html">Introducción</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tema2.html">HTML5</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tema3.html">CSS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tema4.html">Javascript</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tema5.html">XML</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tema6.html">Recuperación de información</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tema7.html">Sindicación y transformación de contenidos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tema8.html">Sistemas de gestión de información</a></li>
<li class="toctree-l1"><a class="reference internal" href="../html/anexo_tablas.html">Anexo: ejercicios sobre tablas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../formularios/anexo_formularios.html">Anexo: ejercicios sobre formularios</a></li>
<li class="toctree-l1"><a class="reference internal" href="../esquemas/ejercicios_dtd.html">Anexo: Ejercicios DTDs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../esquemas/ejercicios_dtd.html#lista-de-productos">Lista de productos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../grids/anexo.html">Anexo: ejercicios sobre «grids»</a></li>
<li class="toctree-l1"><a class="reference internal" href="../xslt/anexo_ejercicios_xslt.html">Anexo: ejercicios sobre XSLT</a></li>
<li class="toctree-l1"><a class="reference internal" href="../xpath/anexo_ejercicios_xpath.html">Anexo: Ejercicios de XPath</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Anexo: Ejercicios de XQuery</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#consulta-ciudad-de-los-proveedores">Consulta: ciudad de los proveedores</a></li>
<li class="toctree-l2"><a class="reference internal" href="#consulta-filas-de-la-tabla-partes">Consulta: filas de la tabla partes</a></li>
<li class="toctree-l2"><a class="reference internal" href="#consulta-con-join-s">Consulta con join’s</a></li>
<li class="toctree-l2"><a class="reference internal" href="#paso-0-analisis">Paso 0: análisis</a></li>
<li class="toctree-l2"><a class="reference internal" href="#paso-1-hacemos-el-cruce">Paso 1: hacemos el cruce</a></li>
<li class="toctree-l2"><a class="reference internal" href="#paso-2-anadir-condiciones">Paso 2: añadir condiciones</a></li>
<li class="toctree-l2"><a class="reference internal" href="#consulta-ciudades-iguales">Consulta: ciudades iguales</a></li>
<li class="toctree-l2"><a class="reference internal" href="#consulta-partes-con-colores-iguales">Consulta: partes con colores iguales</a></li>
<li class="toctree-l2"><a class="reference internal" href="#consulta-cantidad-de-partes-de-londres">Consulta: cantidad de partes de Londres</a></li>
<li class="toctree-l2"><a class="reference internal" href="#consulta-media-de-partes-rojas">Consulta: media de partes rojas</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#paso-1-cruce-de-tablas">Paso 1: cruce de tablas</a></li>
<li class="toctree-l3"><a class="reference internal" href="#paso-2-anadir-condicion-de-filtrado">Paso 2: añadir condicion de filtrado</a></li>
<li class="toctree-l3"><a class="reference internal" href="#paso-3-calcular-la-media">Paso 3: calcular la media</a></li>
<li class="toctree-l3"><a class="reference internal" href="#comprobacion">Comprobación</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#consulta-media-individual-de-partes-rojas">Consulta: media individual de partes rojas</a></li>
<li class="toctree-l2"><a class="reference internal" href="#consulta-media-de-suministros">Consulta: media de suministros</a></li>
<li class="toctree-l2"><a class="reference internal" href="#consulta-media-por-proveedor">Consulta: media por proveedor</a></li>
<li class="toctree-l2"><a class="reference internal" href="#consulta-suministros-en-grandes-cantidades">Consulta: suministros en grandes cantidades</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Apuntes de Lenguajes de Marcas</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Anexo: Ejercicios de XQuery</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/ejercicios/xquery/anexo_ejercicios_xquery.rst.txt" rel="nofollow"> Ver código fuente de la página</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="anexo-ejercicios-de-xquery">
<h1>Anexo: Ejercicios de XQuery<a class="headerlink" href="#anexo-ejercicios-de-xquery" title="Link to this heading"></a></h1>
<p>En los ejercicios siguientes se asume que se va a utilizar la siguiente base de datos XML (tomada del libro de C.J. Date «Sistemas Gestores de Bases de Datos»)</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;datos&gt;</span>
<span class="w">    </span><span class="nt">&lt;proveedores&gt;</span>
<span class="w">        </span><span class="nt">&lt;proveedor</span><span class="w"> </span><span class="na">numprov=</span><span class="s">&quot;v1&quot;</span><span class="nt">&gt;</span>
<span class="w">            </span><span class="nt">&lt;nombreprov&gt;</span>Smith<span class="nt">&lt;/nombreprov&gt;</span>
<span class="w">            </span><span class="nt">&lt;estado&gt;</span>20<span class="nt">&lt;/estado&gt;</span>
<span class="w">            </span><span class="nt">&lt;ciudad&gt;</span>Londres<span class="nt">&lt;/ciudad&gt;</span>
<span class="w">        </span><span class="nt">&lt;/proveedor&gt;</span>
<span class="w">        </span><span class="nt">&lt;proveedor</span><span class="w"> </span><span class="na">numprov=</span><span class="s">&quot;v2&quot;</span><span class="nt">&gt;</span>
<span class="w">            </span><span class="nt">&lt;nombreprov&gt;</span>Jones<span class="nt">&lt;/nombreprov&gt;</span>
<span class="w">            </span><span class="nt">&lt;estado&gt;</span>10<span class="nt">&lt;/estado&gt;</span>
<span class="w">            </span><span class="nt">&lt;ciudad&gt;</span>Paris<span class="nt">&lt;/ciudad&gt;</span>
<span class="w">        </span><span class="nt">&lt;/proveedor&gt;</span>
<span class="w">        </span><span class="nt">&lt;proveedor</span><span class="w"> </span><span class="na">numprov=</span><span class="s">&quot;v3&quot;</span><span class="nt">&gt;</span>
<span class="w">            </span><span class="nt">&lt;nombreprov&gt;</span>Blake<span class="nt">&lt;/nombreprov&gt;</span>
<span class="w">            </span><span class="nt">&lt;estado&gt;</span>30<span class="nt">&lt;/estado&gt;</span>
<span class="w">            </span><span class="nt">&lt;ciudad&gt;</span>Paris<span class="nt">&lt;/ciudad&gt;</span>
<span class="w">        </span><span class="nt">&lt;/proveedor&gt;</span>
<span class="w">        </span><span class="nt">&lt;proveedor</span><span class="w"> </span><span class="na">numprov=</span><span class="s">&quot;v4&quot;</span><span class="nt">&gt;</span>
<span class="w">            </span><span class="nt">&lt;nombreprov&gt;</span>Clarke<span class="nt">&lt;/nombreprov&gt;</span>
<span class="w">            </span><span class="nt">&lt;estado&gt;</span>20<span class="nt">&lt;/estado&gt;</span>
<span class="w">            </span><span class="nt">&lt;ciudad&gt;</span>Londres<span class="nt">&lt;/ciudad&gt;</span>
<span class="w">        </span><span class="nt">&lt;/proveedor&gt;</span>
<span class="w">        </span><span class="nt">&lt;proveedor</span><span class="w"> </span><span class="na">numprov=</span><span class="s">&quot;v5&quot;</span><span class="nt">&gt;</span>
<span class="w">            </span><span class="nt">&lt;nombreprov&gt;</span>Adams<span class="nt">&lt;/nombreprov&gt;</span>
<span class="w">            </span><span class="nt">&lt;estado&gt;</span>30<span class="nt">&lt;/estado&gt;</span>
<span class="w">            </span><span class="nt">&lt;ciudad&gt;</span>Atenas<span class="nt">&lt;/ciudad&gt;</span>
<span class="w">        </span><span class="nt">&lt;/proveedor&gt;</span><span class="w">       </span>
<span class="w">    </span><span class="nt">&lt;/proveedores&gt;</span>
<span class="w">    </span><span class="nt">&lt;partes&gt;</span>
<span class="w">        </span><span class="nt">&lt;parte</span><span class="w"> </span><span class="na">numparte=</span><span class="s">&quot;p1&quot;</span><span class="nt">&gt;</span>
<span class="w">            </span><span class="nt">&lt;nombreparte&gt;</span>Tuerca<span class="nt">&lt;/nombreparte&gt;</span>
<span class="w">            </span><span class="nt">&lt;color&gt;</span>Rojo<span class="nt">&lt;/color&gt;</span>
<span class="w">            </span><span class="nt">&lt;peso&gt;</span>12<span class="nt">&lt;/peso&gt;</span>
<span class="w">            </span><span class="nt">&lt;ciudad&gt;</span>Londres<span class="nt">&lt;/ciudad&gt;</span>
<span class="w">        </span><span class="nt">&lt;/parte&gt;</span>
<span class="w">        </span><span class="nt">&lt;parte</span><span class="w"> </span><span class="na">numparte=</span><span class="s">&quot;p2&quot;</span><span class="nt">&gt;</span>
<span class="w">            </span><span class="nt">&lt;nombreparte&gt;</span>Perno<span class="nt">&lt;/nombreparte&gt;</span>
<span class="w">            </span><span class="nt">&lt;color&gt;</span>Verde<span class="nt">&lt;/color&gt;</span>
<span class="w">            </span><span class="nt">&lt;peso&gt;</span>17<span class="nt">&lt;/peso&gt;</span>
<span class="w">            </span><span class="nt">&lt;ciudad&gt;</span>Paris<span class="nt">&lt;/ciudad&gt;</span>
<span class="w">        </span><span class="nt">&lt;/parte&gt;</span>
<span class="w">        </span><span class="nt">&lt;parte</span><span class="w"> </span><span class="na">numparte=</span><span class="s">&quot;p3&quot;</span><span class="nt">&gt;</span>
<span class="w">            </span><span class="nt">&lt;nombreparte&gt;</span>Tornillo<span class="nt">&lt;/nombreparte&gt;</span>
<span class="w">            </span><span class="nt">&lt;color&gt;</span>Azul<span class="nt">&lt;/color&gt;</span>
<span class="w">            </span><span class="nt">&lt;peso&gt;</span>17<span class="nt">&lt;/peso&gt;</span>
<span class="w">            </span><span class="nt">&lt;ciudad&gt;</span>Roma<span class="nt">&lt;/ciudad&gt;</span>
<span class="w">        </span><span class="nt">&lt;/parte&gt;</span>
<span class="w">        </span><span class="nt">&lt;parte</span><span class="w"> </span><span class="na">numparte=</span><span class="s">&quot;p4&quot;</span><span class="nt">&gt;</span>
<span class="w">            </span><span class="nt">&lt;nombreparte&gt;</span>Tornillo<span class="nt">&lt;/nombreparte&gt;</span>
<span class="w">            </span><span class="nt">&lt;color&gt;</span>Rojo<span class="nt">&lt;/color&gt;</span>
<span class="w">            </span><span class="nt">&lt;peso&gt;</span>14<span class="nt">&lt;/peso&gt;</span>
<span class="w">            </span><span class="nt">&lt;ciudad&gt;</span>Londres<span class="nt">&lt;/ciudad&gt;</span>
<span class="w">        </span><span class="nt">&lt;/parte&gt;</span>
<span class="w">        </span><span class="nt">&lt;parte</span><span class="w"> </span><span class="na">numparte=</span><span class="s">&quot;p5&quot;</span><span class="nt">&gt;</span>
<span class="w">            </span><span class="nt">&lt;nombreparte&gt;</span>Leva<span class="nt">&lt;/nombreparte&gt;</span>
<span class="w">            </span><span class="nt">&lt;color&gt;</span>Azul<span class="nt">&lt;/color&gt;</span>
<span class="w">            </span><span class="nt">&lt;peso&gt;</span>12<span class="nt">&lt;/peso&gt;</span>
<span class="w">            </span><span class="nt">&lt;ciudad&gt;</span>Paris<span class="nt">&lt;/ciudad&gt;</span>
<span class="w">        </span><span class="nt">&lt;/parte&gt;</span>
<span class="w">        </span><span class="nt">&lt;parte</span><span class="w"> </span><span class="na">numparte=</span><span class="s">&quot;p6&quot;</span><span class="nt">&gt;</span>
<span class="w">            </span><span class="nt">&lt;nombreparte&gt;</span>Engranaje<span class="nt">&lt;/nombreparte&gt;</span>
<span class="w">            </span><span class="nt">&lt;color&gt;</span>Rojo<span class="nt">&lt;/color&gt;</span>
<span class="w">            </span><span class="nt">&lt;peso&gt;</span>19<span class="nt">&lt;/peso&gt;</span>
<span class="w">            </span><span class="nt">&lt;ciudad&gt;</span>Londres<span class="nt">&lt;/ciudad&gt;</span>
<span class="w">        </span><span class="nt">&lt;/parte&gt;</span>
<span class="w">    </span><span class="nt">&lt;/partes&gt;</span>
<span class="w">    </span><span class="nt">&lt;proyectos&gt;</span>
<span class="w">        </span><span class="nt">&lt;proyecto</span><span class="w"> </span><span class="na">numproyecto=</span><span class="s">&quot;y1&quot;</span><span class="nt">&gt;</span>
<span class="w">            </span><span class="nt">&lt;nombreproyecto&gt;</span>Clasificador<span class="nt">&lt;/nombreproyecto&gt;</span>
<span class="w">            </span><span class="nt">&lt;ciudad&gt;</span>Paris<span class="nt">&lt;/ciudad&gt;</span>
<span class="w">        </span><span class="nt">&lt;/proyecto&gt;</span>
<span class="w">        </span><span class="nt">&lt;proyecto</span><span class="w"> </span><span class="na">numproyecto=</span><span class="s">&quot;y2&quot;</span><span class="nt">&gt;</span>
<span class="w">            </span><span class="nt">&lt;nombreproyecto&gt;</span>Monitor<span class="nt">&lt;/nombreproyecto&gt;</span>
<span class="w">            </span><span class="nt">&lt;ciudad&gt;</span>Roma<span class="nt">&lt;/ciudad&gt;</span>
<span class="w">        </span><span class="nt">&lt;/proyecto&gt;</span>
<span class="w">        </span><span class="nt">&lt;proyecto</span><span class="w"> </span><span class="na">numproyecto=</span><span class="s">&quot;y3&quot;</span><span class="nt">&gt;</span>
<span class="w">            </span><span class="nt">&lt;nombreproyecto&gt;</span>OCR<span class="nt">&lt;/nombreproyecto&gt;</span>
<span class="w">            </span><span class="nt">&lt;ciudad&gt;</span>Atenas<span class="nt">&lt;/ciudad&gt;</span>
<span class="w">        </span><span class="nt">&lt;/proyecto&gt;</span>
<span class="w">        </span><span class="nt">&lt;proyecto</span><span class="w"> </span><span class="na">numproyecto=</span><span class="s">&quot;y4&quot;</span><span class="nt">&gt;</span>
<span class="w">            </span><span class="nt">&lt;nombreproyecto&gt;</span>Consola<span class="nt">&lt;/nombreproyecto&gt;</span>
<span class="w">            </span><span class="nt">&lt;ciudad&gt;</span>Atenas<span class="nt">&lt;/ciudad&gt;</span>
<span class="w">        </span><span class="nt">&lt;/proyecto&gt;</span>
<span class="w">        </span><span class="nt">&lt;proyecto</span><span class="w"> </span><span class="na">numproyecto=</span><span class="s">&quot;y5&quot;</span><span class="nt">&gt;</span>
<span class="w">            </span><span class="nt">&lt;nombreproyecto&gt;</span>RAID<span class="nt">&lt;/nombreproyecto&gt;</span>
<span class="w">            </span><span class="nt">&lt;ciudad&gt;</span>Londres<span class="nt">&lt;/ciudad&gt;</span>
<span class="w">        </span><span class="nt">&lt;/proyecto&gt;</span>
<span class="w">        </span><span class="nt">&lt;proyecto</span><span class="w"> </span><span class="na">numproyecto=</span><span class="s">&quot;y6&quot;</span><span class="nt">&gt;</span>
<span class="w">            </span><span class="nt">&lt;nombreproyecto&gt;</span>EDS<span class="nt">&lt;/nombreproyecto&gt;</span>
<span class="w">            </span><span class="nt">&lt;ciudad&gt;</span>Oslo<span class="nt">&lt;/ciudad&gt;</span>
<span class="w">        </span><span class="nt">&lt;/proyecto&gt;</span>
<span class="w">        </span><span class="nt">&lt;proyecto</span><span class="w"> </span><span class="na">numproyecto=</span><span class="s">&quot;y7&quot;</span><span class="nt">&gt;</span>
<span class="w">            </span><span class="nt">&lt;nombreproyecto&gt;</span>Cinta<span class="nt">&lt;/nombreproyecto&gt;</span>
<span class="w">            </span><span class="nt">&lt;ciudad&gt;</span>Londres<span class="nt">&lt;/ciudad&gt;</span>
<span class="w">        </span><span class="nt">&lt;/proyecto&gt;</span>
<span class="w">    </span><span class="nt">&lt;/proyectos&gt;</span>
<span class="w">    </span><span class="nt">&lt;suministros&gt;</span>
<span class="w">        </span><span class="nt">&lt;suministra&gt;</span>
<span class="w">            </span><span class="nt">&lt;numprov&gt;</span>v1<span class="nt">&lt;/numprov&gt;</span>
<span class="w">            </span><span class="nt">&lt;numparte&gt;</span>p1<span class="nt">&lt;/numparte&gt;</span>
<span class="w">            </span><span class="nt">&lt;numproyecto&gt;</span>y1<span class="nt">&lt;/numproyecto&gt;</span>
<span class="w">            </span><span class="nt">&lt;cantidad&gt;</span>200<span class="nt">&lt;/cantidad&gt;</span>
<span class="w">        </span><span class="nt">&lt;/suministra&gt;</span>
<span class="w">        </span><span class="nt">&lt;suministra&gt;</span>
<span class="w">            </span><span class="nt">&lt;numprov&gt;</span>v1<span class="nt">&lt;/numprov&gt;</span>
<span class="w">            </span><span class="nt">&lt;numparte&gt;</span>p1<span class="nt">&lt;/numparte&gt;</span>
<span class="w">            </span><span class="nt">&lt;numproyecto&gt;</span>y4<span class="nt">&lt;/numproyecto&gt;</span>
<span class="w">            </span><span class="nt">&lt;cantidad&gt;</span>700<span class="nt">&lt;/cantidad&gt;</span>
<span class="w">        </span><span class="nt">&lt;/suministra&gt;</span>
<span class="w">        </span><span class="nt">&lt;suministra&gt;</span>
<span class="w">            </span><span class="nt">&lt;numprov&gt;</span>v2<span class="nt">&lt;/numprov&gt;</span>
<span class="w">            </span><span class="nt">&lt;numparte&gt;</span>p3<span class="nt">&lt;/numparte&gt;</span>
<span class="w">            </span><span class="nt">&lt;numproyecto&gt;</span>y1<span class="nt">&lt;/numproyecto&gt;</span>
<span class="w">            </span><span class="nt">&lt;cantidad&gt;</span>400<span class="nt">&lt;/cantidad&gt;</span>
<span class="w">        </span><span class="nt">&lt;/suministra&gt;</span>
<span class="w">        </span><span class="nt">&lt;suministra&gt;</span>
<span class="w">            </span><span class="nt">&lt;numprov&gt;</span>v2<span class="nt">&lt;/numprov&gt;</span>
<span class="w">            </span><span class="nt">&lt;numparte&gt;</span>p3<span class="nt">&lt;/numparte&gt;</span>
<span class="w">            </span><span class="nt">&lt;numproyecto&gt;</span>y2<span class="nt">&lt;/numproyecto&gt;</span>
<span class="w">            </span><span class="nt">&lt;cantidad&gt;</span>200<span class="nt">&lt;/cantidad&gt;</span>
<span class="w">        </span><span class="nt">&lt;/suministra&gt;</span>
<span class="w">        </span><span class="nt">&lt;suministra&gt;</span>
<span class="w">            </span><span class="nt">&lt;numprov&gt;</span>v2<span class="nt">&lt;/numprov&gt;</span>
<span class="w">            </span><span class="nt">&lt;numparte&gt;</span>p3<span class="nt">&lt;/numparte&gt;</span>
<span class="w">            </span><span class="nt">&lt;numproyecto&gt;</span>y3<span class="nt">&lt;/numproyecto&gt;</span>
<span class="w">            </span><span class="nt">&lt;cantidad&gt;</span>300<span class="nt">&lt;/cantidad&gt;</span>
<span class="w">        </span><span class="nt">&lt;/suministra&gt;</span>
<span class="w">        </span><span class="nt">&lt;suministra&gt;</span>
<span class="w">            </span><span class="nt">&lt;numprov&gt;</span>v2<span class="nt">&lt;/numprov&gt;</span>
<span class="w">            </span><span class="nt">&lt;numparte&gt;</span>p3<span class="nt">&lt;/numparte&gt;</span>
<span class="w">            </span><span class="nt">&lt;numproyecto&gt;</span>y4<span class="nt">&lt;/numproyecto&gt;</span>
<span class="w">            </span><span class="nt">&lt;cantidad&gt;</span>500<span class="nt">&lt;/cantidad&gt;</span>
<span class="w">        </span><span class="nt">&lt;/suministra&gt;</span>
<span class="w">        </span><span class="nt">&lt;suministra&gt;</span>
<span class="w">            </span><span class="nt">&lt;numprov&gt;</span>v2<span class="nt">&lt;/numprov&gt;</span>
<span class="w">            </span><span class="nt">&lt;numparte&gt;</span>p3<span class="nt">&lt;/numparte&gt;</span>
<span class="w">            </span><span class="nt">&lt;numproyecto&gt;</span>y5<span class="nt">&lt;/numproyecto&gt;</span>
<span class="w">            </span><span class="nt">&lt;cantidad&gt;</span>600<span class="nt">&lt;/cantidad&gt;</span>
<span class="w">        </span><span class="nt">&lt;/suministra&gt;</span>
<span class="w">        </span><span class="nt">&lt;suministra&gt;</span>
<span class="w">            </span><span class="nt">&lt;numprov&gt;</span>v2<span class="nt">&lt;/numprov&gt;</span>
<span class="w">            </span><span class="nt">&lt;numparte&gt;</span>p3<span class="nt">&lt;/numparte&gt;</span>
<span class="w">            </span><span class="nt">&lt;numproyecto&gt;</span>y6<span class="nt">&lt;/numproyecto&gt;</span>
<span class="w">            </span><span class="nt">&lt;cantidad&gt;</span>400<span class="nt">&lt;/cantidad&gt;</span>
<span class="w">        </span><span class="nt">&lt;/suministra&gt;</span>
<span class="w">        </span><span class="nt">&lt;suministra&gt;</span>
<span class="w">            </span><span class="nt">&lt;numprov&gt;</span>v2<span class="nt">&lt;/numprov&gt;</span>
<span class="w">            </span><span class="nt">&lt;numparte&gt;</span>p3<span class="nt">&lt;/numparte&gt;</span>
<span class="w">            </span><span class="nt">&lt;numproyecto&gt;</span>y7<span class="nt">&lt;/numproyecto&gt;</span>
<span class="w">            </span><span class="nt">&lt;cantidad&gt;</span>600<span class="nt">&lt;/cantidad&gt;</span>
<span class="w">        </span><span class="nt">&lt;/suministra&gt;</span>
<span class="w">        </span><span class="nt">&lt;suministra&gt;</span>
<span class="w">            </span><span class="nt">&lt;numprov&gt;</span>v2<span class="nt">&lt;/numprov&gt;</span>
<span class="w">            </span><span class="nt">&lt;numparte&gt;</span>p5<span class="nt">&lt;/numparte&gt;</span>
<span class="w">            </span><span class="nt">&lt;numproyecto&gt;</span>y2<span class="nt">&lt;/numproyecto&gt;</span>
<span class="w">            </span><span class="nt">&lt;cantidad&gt;</span>100<span class="nt">&lt;/cantidad&gt;</span>
<span class="w">        </span><span class="nt">&lt;/suministra&gt;</span>
<span class="w">        </span><span class="nt">&lt;suministra&gt;</span>
<span class="w">            </span><span class="nt">&lt;numprov&gt;</span>v3<span class="nt">&lt;/numprov&gt;</span>
<span class="w">            </span><span class="nt">&lt;numparte&gt;</span>p3<span class="nt">&lt;/numparte&gt;</span>
<span class="w">            </span><span class="nt">&lt;numproyecto&gt;</span>y1<span class="nt">&lt;/numproyecto&gt;</span>
<span class="w">            </span><span class="nt">&lt;cantidad&gt;</span>200<span class="nt">&lt;/cantidad&gt;</span>
<span class="w">        </span><span class="nt">&lt;/suministra&gt;</span>
<span class="w">        </span><span class="nt">&lt;suministra&gt;</span>
<span class="w">            </span><span class="nt">&lt;numprov&gt;</span>v3<span class="nt">&lt;/numprov&gt;</span>
<span class="w">            </span><span class="nt">&lt;numparte&gt;</span>p4<span class="nt">&lt;/numparte&gt;</span>
<span class="w">            </span><span class="nt">&lt;numproyecto&gt;</span>y2<span class="nt">&lt;/numproyecto&gt;</span>
<span class="w">            </span><span class="nt">&lt;cantidad&gt;</span>500<span class="nt">&lt;/cantidad&gt;</span>
<span class="w">        </span><span class="nt">&lt;/suministra&gt;</span>
<span class="w">        </span><span class="nt">&lt;suministra&gt;</span>
<span class="w">            </span><span class="nt">&lt;numprov&gt;</span>v4<span class="nt">&lt;/numprov&gt;</span>
<span class="w">            </span><span class="nt">&lt;numparte&gt;</span>p6<span class="nt">&lt;/numparte&gt;</span>
<span class="w">            </span><span class="nt">&lt;numproyecto&gt;</span>y3<span class="nt">&lt;/numproyecto&gt;</span>
<span class="w">            </span><span class="nt">&lt;cantidad&gt;</span>300<span class="nt">&lt;/cantidad&gt;</span>
<span class="w">        </span><span class="nt">&lt;/suministra&gt;</span>
<span class="w">        </span><span class="nt">&lt;suministra&gt;</span>
<span class="w">            </span><span class="nt">&lt;numprov&gt;</span>v4<span class="nt">&lt;/numprov&gt;</span>
<span class="w">            </span><span class="nt">&lt;numparte&gt;</span>p6<span class="nt">&lt;/numparte&gt;</span>
<span class="w">            </span><span class="nt">&lt;numproyecto&gt;</span>y7<span class="nt">&lt;/numproyecto&gt;</span>
<span class="w">            </span><span class="nt">&lt;cantidad&gt;</span>300<span class="nt">&lt;/cantidad&gt;</span>
<span class="w">        </span><span class="nt">&lt;/suministra&gt;</span>
<span class="w">        </span><span class="nt">&lt;suministra&gt;</span>
<span class="w">            </span><span class="nt">&lt;numprov&gt;</span>v5<span class="nt">&lt;/numprov&gt;</span>
<span class="w">            </span><span class="nt">&lt;numparte&gt;</span>p2<span class="nt">&lt;/numparte&gt;</span>
<span class="w">            </span><span class="nt">&lt;numproyecto&gt;</span>y2<span class="nt">&lt;/numproyecto&gt;</span>
<span class="w">            </span><span class="nt">&lt;cantidad&gt;</span>200<span class="nt">&lt;/cantidad&gt;</span>
<span class="w">        </span><span class="nt">&lt;/suministra&gt;</span>
<span class="w">        </span><span class="nt">&lt;suministra&gt;</span>
<span class="w">            </span><span class="nt">&lt;numprov&gt;</span>v5<span class="nt">&lt;/numprov&gt;</span>
<span class="w">            </span><span class="nt">&lt;numparte&gt;</span>p2<span class="nt">&lt;/numparte&gt;</span>
<span class="w">            </span><span class="nt">&lt;numproyecto&gt;</span>y4<span class="nt">&lt;/numproyecto&gt;</span>
<span class="w">            </span><span class="nt">&lt;cantidad&gt;</span>100<span class="nt">&lt;/cantidad&gt;</span>
<span class="w">        </span><span class="nt">&lt;/suministra&gt;</span>
<span class="w">        </span><span class="nt">&lt;suministra&gt;</span>
<span class="w">            </span><span class="nt">&lt;numprov&gt;</span>v5<span class="nt">&lt;/numprov&gt;</span>
<span class="w">            </span><span class="nt">&lt;numparte&gt;</span>p5<span class="nt">&lt;/numparte&gt;</span>
<span class="w">            </span><span class="nt">&lt;numproyecto&gt;</span>y5<span class="nt">&lt;/numproyecto&gt;</span>
<span class="w">            </span><span class="nt">&lt;cantidad&gt;</span>500<span class="nt">&lt;/cantidad&gt;</span>
<span class="w">        </span><span class="nt">&lt;/suministra&gt;</span>
<span class="w">        </span><span class="nt">&lt;suministra&gt;</span>
<span class="w">            </span><span class="nt">&lt;numprov&gt;</span>v5<span class="nt">&lt;/numprov&gt;</span>
<span class="w">            </span><span class="nt">&lt;numparte&gt;</span>p6<span class="nt">&lt;/numparte&gt;</span>
<span class="w">            </span><span class="nt">&lt;numproyecto&gt;</span>y2<span class="nt">&lt;/numproyecto&gt;</span>
<span class="w">            </span><span class="nt">&lt;cantidad&gt;</span>200<span class="nt">&lt;/cantidad&gt;</span>
<span class="w">        </span><span class="nt">&lt;/suministra&gt;</span>
<span class="w">        </span><span class="nt">&lt;suministra&gt;</span>
<span class="w">            </span><span class="nt">&lt;numprov&gt;</span>v5<span class="nt">&lt;/numprov&gt;</span>
<span class="w">            </span><span class="nt">&lt;numparte&gt;</span>p1<span class="nt">&lt;/numparte&gt;</span>
<span class="w">            </span><span class="nt">&lt;numproyecto&gt;</span>y4<span class="nt">&lt;/numproyecto&gt;</span>
<span class="w">            </span><span class="nt">&lt;cantidad&gt;</span>100<span class="nt">&lt;/cantidad&gt;</span>
<span class="w">        </span><span class="nt">&lt;/suministra&gt;</span>
<span class="w">        </span><span class="nt">&lt;suministra&gt;</span>
<span class="w">            </span><span class="nt">&lt;numprov&gt;</span>v5<span class="nt">&lt;/numprov&gt;</span>
<span class="w">            </span><span class="nt">&lt;numparte&gt;</span>p3<span class="nt">&lt;/numparte&gt;</span>
<span class="w">            </span><span class="nt">&lt;numproyecto&gt;</span>y4<span class="nt">&lt;/numproyecto&gt;</span>
<span class="w">            </span><span class="nt">&lt;cantidad&gt;</span>200<span class="nt">&lt;/cantidad&gt;</span>
<span class="w">        </span><span class="nt">&lt;/suministra&gt;</span>
<span class="w">        </span><span class="nt">&lt;suministra&gt;</span>
<span class="w">            </span><span class="nt">&lt;numprov&gt;</span>v5<span class="nt">&lt;/numprov&gt;</span>
<span class="w">            </span><span class="nt">&lt;numparte&gt;</span>p4<span class="nt">&lt;/numparte&gt;</span>
<span class="w">            </span><span class="nt">&lt;numproyecto&gt;</span>y4<span class="nt">&lt;/numproyecto&gt;</span>
<span class="w">            </span><span class="nt">&lt;cantidad&gt;</span>800<span class="nt">&lt;/cantidad&gt;</span>
<span class="w">        </span><span class="nt">&lt;/suministra&gt;</span>
<span class="w">        </span><span class="nt">&lt;suministra&gt;</span>
<span class="w">            </span><span class="nt">&lt;numprov&gt;</span>v5<span class="nt">&lt;/numprov&gt;</span>
<span class="w">            </span><span class="nt">&lt;numparte&gt;</span>p5<span class="nt">&lt;/numparte&gt;</span>
<span class="w">            </span><span class="nt">&lt;numproyecto&gt;</span>y4<span class="nt">&lt;/numproyecto&gt;</span>
<span class="w">            </span><span class="nt">&lt;cantidad&gt;</span>400<span class="nt">&lt;/cantidad&gt;</span>
<span class="w">        </span><span class="nt">&lt;/suministra&gt;</span>
<span class="w">        </span><span class="nt">&lt;suministra&gt;</span>
<span class="w">            </span><span class="nt">&lt;numprov&gt;</span>v5<span class="nt">&lt;/numprov&gt;</span>
<span class="w">            </span><span class="nt">&lt;numparte&gt;</span>p6<span class="nt">&lt;/numparte&gt;</span>
<span class="w">            </span><span class="nt">&lt;numproyecto&gt;</span>y4<span class="nt">&lt;/numproyecto&gt;</span>
<span class="w">            </span><span class="nt">&lt;cantidad&gt;</span>500<span class="nt">&lt;/cantidad&gt;</span>
<span class="w">        </span><span class="nt">&lt;/suministra&gt;</span>
<span class="w">    </span><span class="nt">&lt;/suministros&gt;</span>
<span class="nt">&lt;/datos&gt;</span>
</pre></div>
</div>
<p>A continuación se muestra la estructura en forma de tabla de los elementos XML de dicho archivo. Obsérvese que los atributos llevan la arroba delante y que no se han puesto todas las filas:</p>
<p>Tabla proveedores</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>&#64;numprov</p></th>
<th class="head"><p>nombre</p></th>
<th class="head"><p>estado</p></th>
<th class="head"><p>ciudad</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>v1</p></td>
<td><p>Smith</p></td>
<td><p>20</p></td>
<td><p>Londres</p></td>
</tr>
<tr class="row-odd"><td><p>v2</p></td>
<td><p>Jones</p></td>
<td><p>10</p></td>
<td><p>Paris</p></td>
</tr>
</tbody>
</table>
<p>Tabla partes:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>&#64;numparte</p></th>
<th class="head"><p>nombreparte</p></th>
<th class="head"><p>color</p></th>
<th class="head"><p>peso</p></th>
<th class="head"><p>ciudad</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>p1</p></td>
<td><p>Tuerca</p></td>
<td><p>Rojo</p></td>
<td><p>12</p></td>
<td><p>Londres</p></td>
</tr>
<tr class="row-odd"><td><p>p2</p></td>
<td><p>Perno</p></td>
<td><p>Verde</p></td>
<td><p>17</p></td>
<td><p>Paris</p></td>
</tr>
</tbody>
</table>
<p>Tabla proyectos</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>&#64;numproyecto</p></th>
<th class="head"><p>nombreproyecto</p></th>
<th class="head"><p>ciudad</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>y1</p></td>
<td><p>Clasificador</p></td>
<td><p>Paris</p></td>
</tr>
<tr class="row-odd"><td><p>y2</p></td>
<td><p>Monitor</p></td>
<td><p>Roma</p></td>
</tr>
</tbody>
</table>
<p>Tabla suministra</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>numprov</p></th>
<th class="head"><p>numparte</p></th>
<th class="head"><p>numproyecto</p></th>
<th class="head"><p>cantidad</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>v1</p></td>
<td><p>p1</p></td>
<td><p>y1</p></td>
<td><p>200</p></td>
</tr>
<tr class="row-odd"><td><p>v1</p></td>
<td><p>p1</p></td>
<td><p>y4</p></td>
<td><p>700</p></td>
</tr>
</tbody>
</table>
<p>Obsérvese también que:</p>
<ul class="simple">
<li><p>En la tabla <code class="docutils literal notranslate"><span class="pre">suministra</span></code> el campo <code class="docutils literal notranslate"><span class="pre">numprov</span></code> es el mismo que el campo <code class="docutils literal notranslate"><span class="pre">numprov</span></code> de la tabla <code class="docutils literal notranslate"><span class="pre">proveedor</span></code></p></li>
<li><p>En la tabla <code class="docutils literal notranslate"><span class="pre">suministra</span></code> el campo <code class="docutils literal notranslate"><span class="pre">numparte</span></code> es el mismo que el campo <code class="docutils literal notranslate"><span class="pre">numparte</span></code> de la tabla <code class="docutils literal notranslate"><span class="pre">partes</span></code></p></li>
<li><p>En la tabla <code class="docutils literal notranslate"><span class="pre">suministra</span></code> el campo <code class="docutils literal notranslate"><span class="pre">numproyecto</span></code> es el mismo que el campo <code class="docutils literal notranslate"><span class="pre">numproyecto</span></code> de la tabla <code class="docutils literal notranslate"><span class="pre">proyectos</span></code></p></li>
</ul>
<section id="consulta-ciudad-de-los-proveedores">
<h2>Consulta: ciudad de los proveedores<a class="headerlink" href="#consulta-ciudad-de-los-proveedores" title="Link to this heading"></a></h2>
<p>Extraer la ciudad de los proveedores (no debe aparecer la etiqueta) que tengan un estado mayor de 15.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="x">for $proveedor in doc(&quot;datos.xml&quot;)/datos/proveedores/proveedor</span>
<span class="x">where $proveedor/estado &gt; 15</span>
<span class="x">return $proveedor/ciudad/text()</span>
</pre></div>
</div>
<p>Si se ejecuta esto se verá que el resultado es correcto sin embargo la presentación no es muy buena, al mostrarse todo seguido. Usemos por ejemplo la función <code class="docutils literal notranslate"><span class="pre">concat</span></code> para que cada resultado lleve un espacio detrás:</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="x">for $proveedor in doc(&quot;datos.xml&quot;)/datos/proveedores/proveedor</span>
<span class="x">where $proveedor/estado &gt; 15</span>
<span class="x">return concat($proveedor/ciudad/text(), &#39; &#39;)</span>
</pre></div>
</div>
</section>
<section id="consulta-filas-de-la-tabla-partes">
<h2>Consulta: filas de la tabla partes<a class="headerlink" href="#consulta-filas-de-la-tabla-partes" title="Link to this heading"></a></h2>
<p>Averiguar cuantas partes existen, es decir, el total de filas de la «tabla» partes.</p>
<p>Para resolverlo una tentación muy común es resolverlo así:</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="x">for $partes in doc(&quot;datos.xml&quot;)/datos/partes</span>
<span class="x">return count ($partes/parte)</span>
</pre></div>
</div>
<p>Y aunque esta solución funciona <strong>en realidad estamos haciendo un bucle de una sola iteración</strong>.</p>
<p>En este caso, se puede recurrir directamente a la función <code class="docutils literal notranslate"><span class="pre">count</span></code> que permite contar el número de elementos de una consulta parcial sin tener que hacer siquiera el recorrido.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="x">count (doc(&quot;datos.xml&quot;)/datos/partes/parte)</span>
</pre></div>
</div>
</section>
<section id="consulta-con-join-s">
<h2>Consulta con join’s<a class="headerlink" href="#consulta-con-join-s" title="Link to this heading"></a></h2>
<p>Obtener el nombre de los proyectos cuya ciudad sea Paris y que reciban una cantidad de partes &gt; 350</p>
</section>
<section id="paso-0-analisis">
<h2>Paso 0: análisis<a class="headerlink" href="#paso-0-analisis" title="Link to this heading"></a></h2>
<p>La cantidad está en las filas (elementos XML) <code class="docutils literal notranslate"><span class="pre">suministra</span></code> pero el <code class="docutils literal notranslate"><span class="pre">nombreproyecto</span></code> está en las filas <code class="docutils literal notranslate"><span class="pre">proyecto</span></code>. Será necesario «cruzar» elementos <code class="docutils literal notranslate"><span class="pre">proyecto</span></code> con elementos <code class="docutils literal notranslate"><span class="pre">suministra</span></code> usando como condición que <code class="docutils literal notranslate"><span class="pre">&#64;numproyecto</span></code> de los elementos <code class="docutils literal notranslate"><span class="pre">proyecto</span></code> sea igual a los campos <code class="docutils literal notranslate"><span class="pre">numproyecto</span></code> de los elementos <code class="docutils literal notranslate"><span class="pre">suministra</span></code></p>
</section>
<section id="paso-1-hacemos-el-cruce">
<h2>Paso 1: hacemos el cruce<a class="headerlink" href="#paso-1-hacemos-el-cruce" title="Link to this heading"></a></h2>
<p>Una primera aproximación sería esta:</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="x">for $suministra in</span>
<span class="x">  doc(&quot;datos.xml&quot;)/datos/suministros/suministra</span>
<span class="x">for $proyecto in</span>
<span class="x">  doc(&quot;datos.xml&quot;)/datos/proyectos/proyecto</span>
<span class="x">where $suministra/numproyecto = $proyecto/@numproyecto</span>

<span class="x">return $proyecto/nombreproyecto</span>
</pre></div>
</div>
<p>Sin embargo, esto devuelve «todos los proyectos» que de alguna manera aparezcan en la tabla <code class="docutils literal notranslate"><span class="pre">suministra</span></code></p>
</section>
<section id="paso-2-anadir-condiciones">
<h2>Paso 2: añadir condiciones<a class="headerlink" href="#paso-2-anadir-condiciones" title="Link to this heading"></a></h2>
<p>Nos han dicho que la cantidad de la tabla <code class="docutils literal notranslate"><span class="pre">suministra</span></code> debe ser mayor de 350, así que en el where o en el for de <code class="docutils literal notranslate"><span class="pre">suministra</span></code> podemos añadir una condición de filtrado:</p>
<p>Asimismo necesitamos solamente los proyectos cuyo campo <code class="docutils literal notranslate"><span class="pre">ciudad</span></code> sea Paris.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="x">for $suministra in</span>
<span class="x">  doc(&quot;datos.xml&quot;)/datos/suministros/suministra[cantidad&gt;350]</span>
<span class="x">for $proyecto in</span>
<span class="x">  doc(&quot;datos.xml&quot;)/datos/proyectos/proyecto[ciudad=&quot;Paris&quot;]</span>
<span class="x">where $suministra/numproyecto = $proyecto/@numproyecto</span>

<span class="x">return $proyecto/nombreproyecto</span>
</pre></div>
</div>
<p>Otra variante usando condiciones en el <code class="docutils literal notranslate"><span class="pre">where</span></code> sería esta:</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="x">for $suministra in</span>
<span class="x">  doc(&quot;datos.xml&quot;)/datos/suministros/suministra</span>
<span class="x">for $proyecto in</span>
<span class="x">  doc(&quot;datos.xml&quot;)/datos/proyectos/proyecto</span>
<span class="x">where $suministra/numproyecto = $proyecto/@numproyecto</span>
<span class="x">   and</span>
<span class="x">     $suministra/cantidad &gt; 350</span>
<span class="x">   and</span>
<span class="x">     $proyecto/ciudad=&quot;Paris&quot;</span>
<span class="x">return $proyecto/nombreproyecto</span>
</pre></div>
</div>
</section>
<section id="consulta-ciudades-iguales">
<h2>Consulta: ciudades iguales<a class="headerlink" href="#consulta-ciudades-iguales" title="Link to this heading"></a></h2>
<p>Obtener los nombres de proyecto y nombres de parte que estén en la misma ciudad.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="x">for $proyecto in</span>
<span class="x">    doc(&quot;datos.xml&quot;)/datos/proyectos/proyecto</span>
<span class="x">    for $parte in</span>
<span class="x">        doc(&quot;datos.xml&quot;)/datos/partes/parte</span>
<span class="x">        where</span>
<span class="x">            $parte/ciudad = $proyecto/ciudad</span>
<span class="x">    return concat(</span>
<span class="x">        $parte/nombreparte, &quot; en la misma ciudad que &quot;,</span>
<span class="x">        $proyecto/nombreproyecto, &quot;-----&quot;</span>
<span class="x">    )</span>
</pre></div>
</div>
</section>
<section id="consulta-partes-con-colores-iguales">
<h2>Consulta: partes con colores iguales<a class="headerlink" href="#consulta-partes-con-colores-iguales" title="Link to this heading"></a></h2>
<p>Obtener parejas de partes que tengan el mismo color (indicando el nombre de ambas partes y el color que comparten)</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="x">for $p1 in</span>
<span class="x">    doc(&quot;datos.xml&quot;)/datos/partes/parte</span>
<span class="x">for $p2 in</span>
<span class="x">    doc(&quot;datos.xml&quot;)/datos/partes/parte</span>
<span class="x">    where</span>
<span class="x">        $p1/color = $p2/color</span>
<span class="x">    return concat ($p1/nombreparte,</span>
<span class="x">                   &quot; tiene el mismo color que &quot;,</span>
<span class="x">                   $p2/nombreparte,</span>
<span class="x">                   &quot; en concreto el color es:&quot;,</span>
<span class="x">                   $p1/color, &quot;</span>
<span class="x">                   &quot;)</span>
</pre></div>
</div>
<p>Esta consulta funciona, pero ofrece parejas de partes que no tienen mucho sentido en pantalla, por ejemplo «Tuerca es igual que Tuerca». Para mejorar la consulta, vamos a eliminar parejas en la cuales el <code class="docutils literal notranslate"><span class="pre">numparte</span></code> sea el mismo, es decir no vamos a contemplar el emparejar una parte consigo misma.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="x">for $p1 in</span>
<span class="x">    doc(&quot;datos.xml&quot;)/datos/partes/parte</span>
<span class="x">for $p2 in</span>
<span class="x">    doc(&quot;datos.xml&quot;)/datos/partes/parte</span>
<span class="x">where</span>
<span class="x">    $p1/color = $p2/color</span>
<span class="x">and</span>
<span class="x">    $p1/@numparte != $p2/@numparte</span>
<span class="x">return concat ($p1/nombreparte,</span>
<span class="x">                   &quot; tiene el mismo color que &quot;,</span>
<span class="x">                   $p2/nombreparte,</span>
<span class="x">                   &quot; en concreto el color es:&quot;,</span>
<span class="x">                   $p1/color, &quot;</span>
<span class="x">                   &quot;)</span>
</pre></div>
</div>
</section>
<section id="consulta-cantidad-de-partes-de-londres">
<h2>Consulta: cantidad de partes de Londres<a class="headerlink" href="#consulta-cantidad-de-partes-de-londres" title="Link to this heading"></a></h2>
<p>Averiguar cuantas partes existen cuya ciudad sea «Londres», es decir, el total de filas de la «tabla» partes pero teniendo en cuenta la condición de que el «campo» ciudad debe ser Londres.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="x">count (doc(&quot;datos.xml&quot;)/datos/partes/parte[ciudad=&#39;Londres&#39;])</span>
</pre></div>
</div>
</section>
<section id="consulta-media-de-partes-rojas">
<h2>Consulta: media de partes rojas<a class="headerlink" href="#consulta-media-de-partes-rojas" title="Link to this heading"></a></h2>
<p>Crear una consulta XQuery que averigüe la media de partes suministradas cuyo color sea “Rojo”</p>
<section id="paso-1-cruce-de-tablas">
<h3>Paso 1: cruce de tablas<a class="headerlink" href="#paso-1-cruce-de-tablas" title="Link to this heading"></a></h3>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="x">for $parte in</span>
<span class="x">    doc(&quot;datos.xml&quot;)/datos/partes/parte</span>
<span class="x">for $suministra in</span>
<span class="x">    doc(&quot;datos.xml&quot;)/datos/suministros/suministra</span>
<span class="x">where</span>
<span class="x">    $parte/@numparte = $suministra/numparte</span>
<span class="x">//Faltaria el return</span>
</pre></div>
</div>
</section>
<section id="paso-2-anadir-condicion-de-filtrado">
<h3>Paso 2: añadir condicion de filtrado<a class="headerlink" href="#paso-2-anadir-condicion-de-filtrado" title="Link to this heading"></a></h3>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="x">for $parte in</span>
<span class="x">    doc(&quot;datos.xml&quot;)/datos/partes/parte</span>
<span class="x">for $suministra in</span>
<span class="x">    doc(&quot;datos.xml&quot;)/datos/suministros/suministra</span>
<span class="x">where</span>
<span class="x">    $parte/@numparte = $suministra/numparte</span>
<span class="x">and</span>
<span class="x">    $parte/color=&#39;Rojo&#39;</span>
<span class="x">return $suministra/cantidad</span>
</pre></div>
</div>
<p>En realidad, este filtro también se podría hacer así:</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="x">for $parte in</span>
<span class="x">    doc(&quot;datos.xml&quot;)/datos/partes/parte[color=&#39;Rojo&#39;]</span>
<span class="x">for $suministra in</span>
<span class="x">    doc(&quot;datos.xml&quot;)/datos/suministros/suministra</span>
<span class="x">where</span>
<span class="x">    $parte/@numparte = $suministra/numparte</span>
<span class="x">return $suministra/cantidad</span>
</pre></div>
</div>
</section>
<section id="paso-3-calcular-la-media">
<h3>Paso 3: calcular la media<a class="headerlink" href="#paso-3-calcular-la-media" title="Link to this heading"></a></h3>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="x">avg (</span>
<span class="x">    for $parte in</span>
<span class="x">        doc(&quot;datos.xml&quot;)/datos/partes/parte[color=&#39;Rojo&#39;]</span>
<span class="x">    for $suministra in</span>
<span class="x">        doc(&quot;datos.xml&quot;)/datos/suministros/suministra</span>
<span class="x">    where</span>
<span class="x">        $parte/@numparte = $suministra/numparte</span>
<span class="x">    return $suministra/cantidad</span>
<span class="x">)</span>
</pre></div>
</div>
</section>
<section id="comprobacion">
<h3>Comprobación<a class="headerlink" href="#comprobacion" title="Link to this heading"></a></h3>
<p>Si analizamos la tabla partes veremos que las únicas partes cuyo color es “Rojo” son las partes <code class="docutils literal notranslate"><span class="pre">p1</span></code>, <code class="docutils literal notranslate"><span class="pre">p4</span></code> y <code class="docutils literal notranslate"><span class="pre">p6</span></code>.
Esto significa que las unicas filas de <code class="docutils literal notranslate"><span class="pre">suministra</span></code> que nos interesan son estas:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>numprov</p></th>
<th class="head"><p>numparte</p></th>
<th class="head"><p>numproyecto</p></th>
<th class="head"><p>cantidad</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>v1</p></td>
<td><p>p1</p></td>
<td><p>y1</p></td>
<td><p>200</p></td>
</tr>
<tr class="row-odd"><td><p>v1</p></td>
<td><p>p1</p></td>
<td><p>y4</p></td>
<td><p>700</p></td>
</tr>
<tr class="row-even"><td><p>v3</p></td>
<td><p>p4</p></td>
<td><p>y2</p></td>
<td><p>500</p></td>
</tr>
<tr class="row-odd"><td><p>v4</p></td>
<td><p>p6</p></td>
<td><p>y3</p></td>
<td><p>300</p></td>
</tr>
<tr class="row-even"><td><p>v4</p></td>
<td><p>p6</p></td>
<td><p>y7</p></td>
<td><p>300</p></td>
</tr>
<tr class="row-odd"><td><p>v5</p></td>
<td><p>p6</p></td>
<td><p>y2</p></td>
<td><p>200</p></td>
</tr>
<tr class="row-even"><td><p>v5</p></td>
<td><p>p1</p></td>
<td><p>y4</p></td>
<td><p>100</p></td>
</tr>
<tr class="row-odd"><td><p>v5</p></td>
<td><p>p4</p></td>
<td><p>y4</p></td>
<td><p>800</p></td>
</tr>
<tr class="row-even"><td><p>v5</p></td>
<td><p>p6</p></td>
<td><p>y4</p></td>
<td><p>500</p></td>
</tr>
</tbody>
</table>
<p>Como vemos hay 9 filas con suministros de partes cuyo color es “Rojo” y la suma de cantidades es 3600 por lo el resultado correcto es 400</p>
</section>
</section>
<section id="consulta-media-individual-de-partes-rojas">
<h2>Consulta: media individual de partes rojas<a class="headerlink" href="#consulta-media-individual-de-partes-rojas" title="Link to this heading"></a></h2>
<p>En el ejercicio anterior hemos calculado <em>la media global</em> de
partes rojas. Sin embargo, nos interesaría conocer la media de cada parte roja. Es decir, la media de p1, la media de p4 y la media de p6.</p>
<p>Extraigamos primero las partes cuyo color es rojo:</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="x">for $parte in doc(&quot;datos.xml&quot;)/datos/partes/parte[color=&#39;Rojo&#39;]</span>
<span class="x">return $parte</span>
</pre></div>
</div>
<p>Si analizamos los resultados veremos que nos devuelve las partes p1, p4 y p6. Una vez hecho esto ahora devolvamos la media para cada una de esas partes:</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="x">for $parte in doc(&quot;datos.xml&quot;)/datos/partes/parte[color=&#39;Rojo&#39;]</span>
<span class="x">return avg( doc(&quot;datos.xml&quot;)/datos/suministros/suministra</span>
<span class="x">    [numparte=$parte/@numparte]/cantidad)</span>
</pre></div>
</div>
<p>Esta consulta nos muestra solo las cantidades de cada parte cuyo color es rojo. Vamos a mejorarla haciendo que aparezcan los
nombres de parte. Obsérvese que concatenamos las siguientes cosas:</p>
<ul class="simple">
<li><p>Primero el nombre de la parte.</p></li>
<li><p>Segundo un pequeño separador.</p></li>
<li><p>Despues la media (que se calcula solo para las filas de <code class="docutils literal notranslate"><span class="pre">suministra</span></code> cuyo <code class="docutils literal notranslate"><span class="pre">numparte</span></code> es igual que el atributo <code class="docutils literal notranslate"><span class="pre">numparte</span></code> de la parte que estamos analizando.)</p></li>
<li><p>Despues un espacio que separa unos resultados de otros</p></li>
</ul>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="x">for $parte in doc(&quot;datos.xml&quot;)/datos/partes/parte[color=&#39;Rojo&#39;]</span>
<span class="x">return concat (</span>
<span class="x">    $parte/nombreparte,</span>
<span class="x">    &quot;--&quot;,</span>
<span class="x">    avg (</span>
<span class="x">        doc(&quot;datos.xml&quot;)/datos/suministros/suministra</span>
<span class="x">        [numparte=$parte/@numparte]/cantidad</span>
<span class="x">        ), &quot;          &quot; )</span>
</pre></div>
</div>
</section>
<section id="consulta-media-de-suministros">
<h2>Consulta: media de suministros<a class="headerlink" href="#consulta-media-de-suministros" title="Link to this heading"></a></h2>
<p>Averiguar la media de la cantidad de partes que aparecen en la «tabla» suministra</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="x">avg (doc(&quot;datos.xml&quot;)/datos/suministros/suministra/cantidad)</span>
</pre></div>
</div>
<p>Pregunta: ¿por qué no ponemos esta solución?</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="x">avg (doc(&quot;datos.xml&quot;)/datos/suministros/suministra/cantidad/text())</span>
</pre></div>
</div>
<p>Respuesta: las funciones son capaces de «extraer el texto automáticamente» si en el elemento no hay hijos. En este caso, la cantidad no tiene hijos, por lo que podemos ahorrarnos el <code class="docutils literal notranslate"><span class="pre">text()</span></code></p>
</section>
<section id="consulta-media-por-proveedor">
<h2>Consulta: media por proveedor<a class="headerlink" href="#consulta-media-por-proveedor" title="Link to this heading"></a></h2>
<p>Averiguar la media de cantidades por proveedor usando los datos de la tabla suministra.</p>
<p>Hagamos esta consulta por partes. En primer lugar, saquemos los distintos proveedores que hay en suministra</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="x">for $n in distinct-values(</span>
<span class="x">doc(&quot;datos.xml&quot;)/datos/</span>
<span class="x">proveedores/proveedor/@numprov)</span>
<span class="x">return $n</span>
</pre></div>
</div>
<p>Ahora, teniendo los distintos proveedores podemos devolver algo distinto de <code class="docutils literal notranslate"><span class="pre">numprov</span></code>. Podemos devolver la media para ese proveedor aprovechando los filtrados XPath.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="x">for $n in distinct-values(</span>
<span class="x">doc(&quot;datos.xml&quot;)/datos/</span>
<span class="x">proveedores/proveedor/@numprov)</span>
<span class="x">return avg</span>
<span class="x">( doc(&quot;datos.xml&quot;)/datos/suministros/suministra</span>
<span class="x">[numprov=$n]/cantidad)</span>
</pre></div>
</div>
<p>Y por último, si usamos <code class="docutils literal notranslate"><span class="pre">concat</span></code> apropiadamente podemos hacer que aparezca el número de proveedor al lado de dica cantidad.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="x">for $n in distinct-values(</span>
<span class="x">doc(&quot;datos.xml&quot;)/datos/proveedores/proveedor/@numprov)</span>
<span class="x">return concat (</span>
<span class="x"> $n, &#39; &#39;, avg(</span>
<span class="x"> doc(&quot;datos.xml&quot;)/datos/suministros</span>
<span class="x">/suministra[numprov=$n]/cantidad)</span>
<span class="x">)</span>
</pre></div>
</div>
</section>
<section id="consulta-suministros-en-grandes-cantidades">
<h2>Consulta: suministros en grandes cantidades<a class="headerlink" href="#consulta-suministros-en-grandes-cantidades" title="Link to this heading"></a></h2>
<p>Averiguar el nombre de los proyectos (sin que haya repeticiones) que reciban una cantidad en la tabla suministra mayor de 650.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="x">for $proyecto</span>
<span class="x">in doc(&quot;datos.xml&quot;)/datos/proyectos/proyecto</span>
<span class="x">for $suministra</span>
<span class="x">in</span>
<span class="x">doc(&quot;datos.xml&quot;)/datos/suministros/suministra[cantidad&gt;650]</span>
<span class="x">where $proyecto/@numproyecto = $suministra/numproyecto</span>
<span class="x">return ($proyecto/nombreproyecto, $suministra/cantidad)</span>
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Pie de página">
        <a href="../xpath/anexo_ejercicios_xpath.html" class="btn btn-neutral float-left" title="Anexo: Ejercicios de XPath" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Anterior</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Derechos de autor 2016, Oscar Gomez.</p>
  </div>

  Compilado con <a href="https://www.sphinx-doc.org/">Sphinx</a> usando un
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">tema</a>
    proporcionado por <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>