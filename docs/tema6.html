

<!DOCTYPE html>
<html class="writer-html5" lang="es" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Recuperación de información &mdash; Apuntes de Lenguajes de Marcas v1.3</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
        <script type="text/javascript" src="_static/translations.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Índice" href="genindex.html" />
    <link rel="search" title="Búsqueda" href="search.html" />
    <link rel="next" title="Sindicación y transformación de contenidos" href="tema7.html" />
    <link rel="prev" title="XML" href="tema5.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home" alt="Inicio de Documentación"> Apuntes de Lenguajes de Marcas
          

          
          </a>

          
            
            
              <div class="version">
                1.3
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Buscar documentos" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="tema1.html">Introducción</a></li>
<li class="toctree-l1"><a class="reference internal" href="tema2.html">HTML5</a></li>
<li class="toctree-l1"><a class="reference internal" href="tema3.html">CSS</a></li>
<li class="toctree-l1"><a class="reference internal" href="tema4.html">Javascript</a></li>
<li class="toctree-l1"><a class="reference internal" href="tema5.html">XML</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Recuperación de información</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#introduccion">Introducción</a></li>
<li class="toctree-l2"><a class="reference internal" href="#xquery">XQuery</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#bucles-for-en-xquery">Bucles <code class="docutils literal notranslate"><span class="pre">for</span></code> en XQuery</a></li>
<li class="toctree-l3"><a class="reference internal" href="#ordenacion-en-xquery">Ordenación en XQuery</a></li>
<li class="toctree-l3"><a class="reference internal" href="#funciones-en-xquery">Funciones en XQuery</a></li>
<li class="toctree-l3"><a class="reference internal" href="#consultas-de-ejemplo">Consultas de ejemplo</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#suministros-grandes">Suministros grandes</a></li>
<li class="toctree-l4"><a class="reference internal" href="#renombrado-de-etiquetas">Renombrado de etiquetas</a></li>
<li class="toctree-l4"><a class="reference internal" href="#cruces-o-joins">Cruces o joins</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#fundamentos-de-dom-con-java">Fundamentos de DOM con Java</a></li>
<li class="toctree-l2"><a class="reference internal" href="#ejemplo-de-base">Ejemplo de base</a></li>
<li class="toctree-l2"><a class="reference internal" href="#la-clase-document">La clase Document</a></li>
<li class="toctree-l2"><a class="reference internal" href="#ejercicios">Ejercicios</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#ejercicio">Ejercicio</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id1">Ejercicio</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id2">Ejercicio</a></li>
<li class="toctree-l3"><a class="reference internal" href="#ejercicio-extraccion-de-informacion-financiera">Ejercicio: extracción de información financiera</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id3">Ejercicio</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id4">Ejercicio</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id5">Ejercicio</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id6">Ejercicio</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id7">Ejercicio</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#analisis-del-problema">Análisis del problema</a></li>
<li class="toctree-l4"><a class="reference internal" href="#solucion">Solución</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id8">Ejercicio</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#analisis">Análisis</a></li>
<li class="toctree-l4"><a class="reference internal" href="#diseno">Diseño</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id9">Ejercicio</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id10">Ejercicio</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id11">Análisis</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id12">Diseño</a></li>
<li class="toctree-l4"><a class="reference internal" href="#implementacion">Implementación</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id13">Ejercicio</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id14">Análisis</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id15">Diseño</a></li>
<li class="toctree-l4"><a class="reference internal" href="#solucion-1">Solución 1</a></li>
<li class="toctree-l4"><a class="reference internal" href="#solucion-2">Solución 2</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#anexo">Anexo</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#codigo-java">Código Java</a></li>
<li class="toctree-l3"><a class="reference internal" href="#archivo-xml">Archivo XML</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#procesamiento-con-sax">Procesamiento con SAX</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#ejercicio-encontrar-producto">Ejercicio: encontrar producto</a></li>
<li class="toctree-l3"><a class="reference internal" href="#ejercicio-precios">Ejercicio: precios</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#ejercicios-para-preparar-examen">Ejercicios para preparar examen</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="tema7.html">Sindicación y transformación de contenidos</a></li>
<li class="toctree-l1"><a class="reference internal" href="tema8.html">Sistemas de gestión de información</a></li>
<li class="toctree-l1"><a class="reference internal" href="ejercicios/html/anexo_tablas.html">Anexo: ejercicios sobre tablas</a></li>
<li class="toctree-l1"><a class="reference internal" href="ejercicios/formularios/anexo_formularios.html">Anexo: ejercicios sobre formularios</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Apuntes de Lenguajes de Marcas</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Recuperación de información</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/tema6.rst.txt" rel="nofollow"> Ver código fuente de la página</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="recuperacion-de-informacion">
<h1>Recuperación de información<a class="headerlink" href="#recuperacion-de-informacion" title="Enlazar permanentemente con este título">¶</a></h1>
<div class="section" id="introduccion">
<h2>Introducción<a class="headerlink" href="#introduccion" title="Enlazar permanentemente con este título">¶</a></h2>
<p>En este tema veremos que podemos recuperar información de archivos XML <em>igual</em> que si fuesen bases de datos. Para ello podemos usar dos cosas:</p>
<ul class="simple">
<li><p>Un lenguaje de programación de propósito general, como es Java.</p></li>
<li><p>O un lenguaje de programación especializado como es XQuery.</p></li>
</ul>
<p>En líneas generales hay dos grandes formas de usar un lenguaje de programación como Java para leer o escribir archivos XML.</p>
<ul class="simple">
<li><p>DOM: significa Document Object Model (o Modelo del objeto documento). DOM en general almacena los archivos en memoria lo que es mucho más rápido y eficiente.</p></li>
<li><p>SAX: en algunos casos, los archivos muy grandes, pueden no caber en memoria. SAX proporciona otras clases y métodos distintos para ir procesando un archivo por partes. SAX significa Simple Access for XML, pero en general es un poco más complicado. En este módulo, no lo veremos.</p></li>
</ul>
<p>DOM es un estándar y sus clases y métodos existen en muchos otros lenguajes.</p>
</div>
<div class="section" id="xquery">
<h2>XQuery<a class="headerlink" href="#xquery" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Para empezar <strong>XQuery es un superconjunto de XPath</strong> por lo que las expresiones básicas de XQuery también servirán en XQuery. La primera diferencia es que en XQuery tendremos que usar la función <code class="docutils literal notranslate"><span class="pre">doc</span></code> para cargar un archivo y luego navegar por él. Supongamos que tenemos un archivo de ejemplo como este:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;datos&gt;</span>
    <span class="nt">&lt;proveedores&gt;</span>
        <span class="nt">&lt;proveedor</span> <span class="na">numprov=</span><span class="s">&quot;v1&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;nombreprov&gt;</span>Smith<span class="nt">&lt;/nombreprov&gt;</span>
            <span class="nt">&lt;estado&gt;</span>20<span class="nt">&lt;/estado&gt;</span>
            <span class="nt">&lt;ciudad&gt;</span>Londres<span class="nt">&lt;/ciudad&gt;</span>
        <span class="nt">&lt;/proveedor&gt;</span>
        <span class="nt">&lt;proveedor</span> <span class="na">numprov=</span><span class="s">&quot;v2&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;nombreprov&gt;</span>Jones<span class="nt">&lt;/nombreprov&gt;</span>
            <span class="nt">&lt;estado&gt;</span>10<span class="nt">&lt;/estado&gt;</span>
            <span class="nt">&lt;ciudad&gt;</span>Paris<span class="nt">&lt;/ciudad&gt;</span>
        <span class="nt">&lt;/proveedor&gt;</span>
        <span class="nt">&lt;proveedor</span> <span class="na">numprov=</span><span class="s">&quot;v3&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;nombreprov&gt;</span>Blake<span class="nt">&lt;/nombreprov&gt;</span>
            <span class="nt">&lt;estado&gt;</span>30<span class="nt">&lt;/estado&gt;</span>
            <span class="nt">&lt;ciudad&gt;</span>Paris<span class="nt">&lt;/ciudad&gt;</span>
        <span class="nt">&lt;/proveedor&gt;</span>
        <span class="nt">&lt;proveedor</span> <span class="na">numprov=</span><span class="s">&quot;v4&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;nombreprov&gt;</span>Clarke<span class="nt">&lt;/nombreprov&gt;</span>
            <span class="nt">&lt;estado&gt;</span>20<span class="nt">&lt;/estado&gt;</span>
            <span class="nt">&lt;ciudad&gt;</span>Londres<span class="nt">&lt;/ciudad&gt;</span>
        <span class="nt">&lt;/proveedor&gt;</span>
        <span class="nt">&lt;proveedor</span> <span class="na">numprov=</span><span class="s">&quot;v5&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;nombreprov&gt;</span>Adams<span class="nt">&lt;/nombreprov&gt;</span>
            <span class="nt">&lt;estado&gt;</span>30<span class="nt">&lt;/estado&gt;</span>
            <span class="nt">&lt;ciudad&gt;</span>Atenas<span class="nt">&lt;/ciudad&gt;</span>
        <span class="nt">&lt;/proveedor&gt;</span>
    <span class="nt">&lt;/proveedores&gt;</span>
    <span class="nt">&lt;partes&gt;</span>
        <span class="nt">&lt;parte</span> <span class="na">numparte=</span><span class="s">&quot;p1&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;nombreparte&gt;</span>Tuerca<span class="nt">&lt;/nombreparte&gt;</span>
            <span class="nt">&lt;color&gt;</span>Rojo<span class="nt">&lt;/color&gt;</span>
            <span class="nt">&lt;peso&gt;</span>12<span class="nt">&lt;/peso&gt;</span>
            <span class="nt">&lt;ciudad&gt;</span>Londres<span class="nt">&lt;/ciudad&gt;</span>
        <span class="nt">&lt;/parte&gt;</span>
        <span class="nt">&lt;parte</span> <span class="na">numparte=</span><span class="s">&quot;p2&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;nombreparte&gt;</span>Perno<span class="nt">&lt;/nombreparte&gt;</span>
            <span class="nt">&lt;color&gt;</span>Verde<span class="nt">&lt;/color&gt;</span>
            <span class="nt">&lt;peso&gt;</span>17<span class="nt">&lt;/peso&gt;</span>
            <span class="nt">&lt;ciudad&gt;</span>Paris<span class="nt">&lt;/ciudad&gt;</span>
        <span class="nt">&lt;/parte&gt;</span>
        <span class="nt">&lt;parte</span> <span class="na">numparte=</span><span class="s">&quot;p3&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;nombreparte&gt;</span>Tornillo<span class="nt">&lt;/nombreparte&gt;</span>
            <span class="nt">&lt;color&gt;</span>Azul<span class="nt">&lt;/color&gt;</span>
            <span class="nt">&lt;peso&gt;</span>17<span class="nt">&lt;/peso&gt;</span>
            <span class="nt">&lt;ciudad&gt;</span>Roma<span class="nt">&lt;/ciudad&gt;</span>
        <span class="nt">&lt;/parte&gt;</span>
        <span class="nt">&lt;parte</span> <span class="na">numparte=</span><span class="s">&quot;p4&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;nombreparte&gt;</span>Tornillo<span class="nt">&lt;/nombreparte&gt;</span>
            <span class="nt">&lt;color&gt;</span>Rojo<span class="nt">&lt;/color&gt;</span>
            <span class="nt">&lt;peso&gt;</span>14<span class="nt">&lt;/peso&gt;</span>
            <span class="nt">&lt;ciudad&gt;</span>Londres<span class="nt">&lt;/ciudad&gt;</span>
        <span class="nt">&lt;/parte&gt;</span>
        <span class="nt">&lt;parte</span> <span class="na">numparte=</span><span class="s">&quot;p5&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;nombreparte&gt;</span>Leva<span class="nt">&lt;/nombreparte&gt;</span>
            <span class="nt">&lt;color&gt;</span>Azul<span class="nt">&lt;/color&gt;</span>
            <span class="nt">&lt;peso&gt;</span>12<span class="nt">&lt;/peso&gt;</span>
            <span class="nt">&lt;ciudad&gt;</span>Paris<span class="nt">&lt;/ciudad&gt;</span>
        <span class="nt">&lt;/parte&gt;</span>
        <span class="nt">&lt;parte</span> <span class="na">numparte=</span><span class="s">&quot;p6&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;nombreparte&gt;</span>Engranaje<span class="nt">&lt;/nombreparte&gt;</span>
            <span class="nt">&lt;color&gt;</span>Rojo<span class="nt">&lt;/color&gt;</span>
            <span class="nt">&lt;peso&gt;</span>19<span class="nt">&lt;/peso&gt;</span>
            <span class="nt">&lt;ciudad&gt;</span>Londres<span class="nt">&lt;/ciudad&gt;</span>
        <span class="nt">&lt;/parte&gt;</span>
    <span class="nt">&lt;/partes&gt;</span>
    <span class="nt">&lt;proyectos&gt;</span>
        <span class="nt">&lt;proyecto</span> <span class="na">numproyecto=</span><span class="s">&quot;y1&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;nombreproyecto&gt;</span>Clasificador<span class="nt">&lt;/nombreproyecto&gt;</span>
            <span class="nt">&lt;ciudad&gt;</span>Paris<span class="nt">&lt;/ciudad&gt;</span>
        <span class="nt">&lt;/proyecto&gt;</span>
        <span class="nt">&lt;proyecto</span> <span class="na">numproyecto=</span><span class="s">&quot;y2&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;nombreproyecto&gt;</span>Monitor<span class="nt">&lt;/nombreproyecto&gt;</span>
            <span class="nt">&lt;ciudad&gt;</span>Roma<span class="nt">&lt;/ciudad&gt;</span>
        <span class="nt">&lt;/proyecto&gt;</span>
        <span class="nt">&lt;proyecto</span> <span class="na">numproyecto=</span><span class="s">&quot;y3&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;nombreproyecto&gt;</span>OCR<span class="nt">&lt;/nombreproyecto&gt;</span>
            <span class="nt">&lt;ciudad&gt;</span>Atenas<span class="nt">&lt;/ciudad&gt;</span>
        <span class="nt">&lt;/proyecto&gt;</span>
        <span class="nt">&lt;proyecto</span> <span class="na">numproyecto=</span><span class="s">&quot;y4&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;nombreproyecto&gt;</span>Consola<span class="nt">&lt;/nombreproyecto&gt;</span>
            <span class="nt">&lt;ciudad&gt;</span>Atenas<span class="nt">&lt;/ciudad&gt;</span>
        <span class="nt">&lt;/proyecto&gt;</span>
        <span class="nt">&lt;proyecto</span> <span class="na">numproyecto=</span><span class="s">&quot;y5&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;nombreproyecto&gt;</span>RAID<span class="nt">&lt;/nombreproyecto&gt;</span>
            <span class="nt">&lt;ciudad&gt;</span>Londres<span class="nt">&lt;/ciudad&gt;</span>
        <span class="nt">&lt;/proyecto&gt;</span>
        <span class="nt">&lt;proyecto</span> <span class="na">numproyecto=</span><span class="s">&quot;y6&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;nombreproyecto&gt;</span>EDS<span class="nt">&lt;/nombreproyecto&gt;</span>
            <span class="nt">&lt;ciudad&gt;</span>Oslo<span class="nt">&lt;/ciudad&gt;</span>
        <span class="nt">&lt;/proyecto&gt;</span>
        <span class="nt">&lt;proyecto</span> <span class="na">numproyecto=</span><span class="s">&quot;y7&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;nombreproyecto&gt;</span>Cinta<span class="nt">&lt;/nombreproyecto&gt;</span>
            <span class="nt">&lt;ciudad&gt;</span>Londres<span class="nt">&lt;/ciudad&gt;</span>
        <span class="nt">&lt;/proyecto&gt;</span>
    <span class="nt">&lt;/proyectos&gt;</span>
    <span class="nt">&lt;suministros&gt;</span>
        <span class="nt">&lt;suministra&gt;</span>
            <span class="nt">&lt;numprov&gt;</span>v1<span class="nt">&lt;/numprov&gt;</span>
            <span class="nt">&lt;numparte&gt;</span>p1<span class="nt">&lt;/numparte&gt;</span>
            <span class="nt">&lt;numproyecto&gt;</span>y1<span class="nt">&lt;/numproyecto&gt;</span>
            <span class="nt">&lt;cantidad&gt;</span>200<span class="nt">&lt;/cantidad&gt;</span>
        <span class="nt">&lt;/suministra&gt;</span>
        <span class="nt">&lt;suministra&gt;</span>
            <span class="nt">&lt;numprov&gt;</span>v1<span class="nt">&lt;/numprov&gt;</span>
            <span class="nt">&lt;numparte&gt;</span>p1<span class="nt">&lt;/numparte&gt;</span>
            <span class="nt">&lt;numproyecto&gt;</span>y4<span class="nt">&lt;/numproyecto&gt;</span>
            <span class="nt">&lt;cantidad&gt;</span>700<span class="nt">&lt;/cantidad&gt;</span>
        <span class="nt">&lt;/suministra&gt;</span>
        <span class="nt">&lt;suministra&gt;</span>
            <span class="nt">&lt;numprov&gt;</span>v2<span class="nt">&lt;/numprov&gt;</span>
            <span class="nt">&lt;numparte&gt;</span>p3<span class="nt">&lt;/numparte&gt;</span>
            <span class="nt">&lt;numproyecto&gt;</span>y1<span class="nt">&lt;/numproyecto&gt;</span>
            <span class="nt">&lt;cantidad&gt;</span>400<span class="nt">&lt;/cantidad&gt;</span>
        <span class="nt">&lt;/suministra&gt;</span>
        <span class="nt">&lt;suministra&gt;</span>
            <span class="nt">&lt;numprov&gt;</span>v2<span class="nt">&lt;/numprov&gt;</span>
            <span class="nt">&lt;numparte&gt;</span>p3<span class="nt">&lt;/numparte&gt;</span>
            <span class="nt">&lt;numproyecto&gt;</span>y2<span class="nt">&lt;/numproyecto&gt;</span>
            <span class="nt">&lt;cantidad&gt;</span>200<span class="nt">&lt;/cantidad&gt;</span>
        <span class="nt">&lt;/suministra&gt;</span>
        <span class="nt">&lt;suministra&gt;</span>
            <span class="nt">&lt;numprov&gt;</span>v2<span class="nt">&lt;/numprov&gt;</span>
            <span class="nt">&lt;numparte&gt;</span>p3<span class="nt">&lt;/numparte&gt;</span>
            <span class="nt">&lt;numproyecto&gt;</span>y3<span class="nt">&lt;/numproyecto&gt;</span>
            <span class="nt">&lt;cantidad&gt;</span>300<span class="nt">&lt;/cantidad&gt;</span>
        <span class="nt">&lt;/suministra&gt;</span>
        <span class="nt">&lt;suministra&gt;</span>
            <span class="nt">&lt;numprov&gt;</span>v2<span class="nt">&lt;/numprov&gt;</span>
            <span class="nt">&lt;numparte&gt;</span>p3<span class="nt">&lt;/numparte&gt;</span>
            <span class="nt">&lt;numproyecto&gt;</span>y4<span class="nt">&lt;/numproyecto&gt;</span>
            <span class="nt">&lt;cantidad&gt;</span>500<span class="nt">&lt;/cantidad&gt;</span>
        <span class="nt">&lt;/suministra&gt;</span>
        <span class="nt">&lt;suministra&gt;</span>
            <span class="nt">&lt;numprov&gt;</span>v2<span class="nt">&lt;/numprov&gt;</span>
            <span class="nt">&lt;numparte&gt;</span>p3<span class="nt">&lt;/numparte&gt;</span>
            <span class="nt">&lt;numproyecto&gt;</span>y5<span class="nt">&lt;/numproyecto&gt;</span>
            <span class="nt">&lt;cantidad&gt;</span>600<span class="nt">&lt;/cantidad&gt;</span>
        <span class="nt">&lt;/suministra&gt;</span>
        <span class="nt">&lt;suministra&gt;</span>
            <span class="nt">&lt;numprov&gt;</span>v2<span class="nt">&lt;/numprov&gt;</span>
            <span class="nt">&lt;numparte&gt;</span>p3<span class="nt">&lt;/numparte&gt;</span>
            <span class="nt">&lt;numproyecto&gt;</span>y6<span class="nt">&lt;/numproyecto&gt;</span>
            <span class="nt">&lt;cantidad&gt;</span>400<span class="nt">&lt;/cantidad&gt;</span>
        <span class="nt">&lt;/suministra&gt;</span>
        <span class="nt">&lt;suministra&gt;</span>
            <span class="nt">&lt;numprov&gt;</span>v2<span class="nt">&lt;/numprov&gt;</span>
            <span class="nt">&lt;numparte&gt;</span>p3<span class="nt">&lt;/numparte&gt;</span>
            <span class="nt">&lt;numproyecto&gt;</span>y7<span class="nt">&lt;/numproyecto&gt;</span>
            <span class="nt">&lt;cantidad&gt;</span>600<span class="nt">&lt;/cantidad&gt;</span>
        <span class="nt">&lt;/suministra&gt;</span>
        <span class="nt">&lt;suministra&gt;</span>
            <span class="nt">&lt;numprov&gt;</span>v2<span class="nt">&lt;/numprov&gt;</span>
            <span class="nt">&lt;numparte&gt;</span>p5<span class="nt">&lt;/numparte&gt;</span>
            <span class="nt">&lt;numproyecto&gt;</span>y2<span class="nt">&lt;/numproyecto&gt;</span>
            <span class="nt">&lt;cantidad&gt;</span>100<span class="nt">&lt;/cantidad&gt;</span>
        <span class="nt">&lt;/suministra&gt;</span>
        <span class="nt">&lt;suministra&gt;</span>
            <span class="nt">&lt;numprov&gt;</span>v3<span class="nt">&lt;/numprov&gt;</span>
            <span class="nt">&lt;numparte&gt;</span>p3<span class="nt">&lt;/numparte&gt;</span>
            <span class="nt">&lt;numproyecto&gt;</span>y1<span class="nt">&lt;/numproyecto&gt;</span>
            <span class="nt">&lt;cantidad&gt;</span>200<span class="nt">&lt;/cantidad&gt;</span>
        <span class="nt">&lt;/suministra&gt;</span>
        <span class="nt">&lt;suministra&gt;</span>
            <span class="nt">&lt;numprov&gt;</span>v3<span class="nt">&lt;/numprov&gt;</span>
            <span class="nt">&lt;numparte&gt;</span>p4<span class="nt">&lt;/numparte&gt;</span>
            <span class="nt">&lt;numproyecto&gt;</span>y2<span class="nt">&lt;/numproyecto&gt;</span>
            <span class="nt">&lt;cantidad&gt;</span>500<span class="nt">&lt;/cantidad&gt;</span>
        <span class="nt">&lt;/suministra&gt;</span>
        <span class="nt">&lt;suministra&gt;</span>
            <span class="nt">&lt;numprov&gt;</span>v4<span class="nt">&lt;/numprov&gt;</span>
            <span class="nt">&lt;numparte&gt;</span>p6<span class="nt">&lt;/numparte&gt;</span>
            <span class="nt">&lt;numproyecto&gt;</span>y3<span class="nt">&lt;/numproyecto&gt;</span>
            <span class="nt">&lt;cantidad&gt;</span>300<span class="nt">&lt;/cantidad&gt;</span>
        <span class="nt">&lt;/suministra&gt;</span>
        <span class="nt">&lt;suministra&gt;</span>
            <span class="nt">&lt;numprov&gt;</span>v4<span class="nt">&lt;/numprov&gt;</span>
            <span class="nt">&lt;numparte&gt;</span>p6<span class="nt">&lt;/numparte&gt;</span>
            <span class="nt">&lt;numproyecto&gt;</span>y7<span class="nt">&lt;/numproyecto&gt;</span>
            <span class="nt">&lt;cantidad&gt;</span>300<span class="nt">&lt;/cantidad&gt;</span>
        <span class="nt">&lt;/suministra&gt;</span>
        <span class="nt">&lt;suministra&gt;</span>
            <span class="nt">&lt;numprov&gt;</span>v5<span class="nt">&lt;/numprov&gt;</span>
            <span class="nt">&lt;numparte&gt;</span>p2<span class="nt">&lt;/numparte&gt;</span>
            <span class="nt">&lt;numproyecto&gt;</span>y2<span class="nt">&lt;/numproyecto&gt;</span>
            <span class="nt">&lt;cantidad&gt;</span>200<span class="nt">&lt;/cantidad&gt;</span>
        <span class="nt">&lt;/suministra&gt;</span>
        <span class="nt">&lt;suministra&gt;</span>
            <span class="nt">&lt;numprov&gt;</span>v5<span class="nt">&lt;/numprov&gt;</span>
            <span class="nt">&lt;numparte&gt;</span>p2<span class="nt">&lt;/numparte&gt;</span>
            <span class="nt">&lt;numproyecto&gt;</span>y4<span class="nt">&lt;/numproyecto&gt;</span>
            <span class="nt">&lt;cantidad&gt;</span>100<span class="nt">&lt;/cantidad&gt;</span>
        <span class="nt">&lt;/suministra&gt;</span>
        <span class="nt">&lt;suministra&gt;</span>
            <span class="nt">&lt;numprov&gt;</span>v5<span class="nt">&lt;/numprov&gt;</span>
            <span class="nt">&lt;numparte&gt;</span>p5<span class="nt">&lt;/numparte&gt;</span>
            <span class="nt">&lt;numproyecto&gt;</span>y5<span class="nt">&lt;/numproyecto&gt;</span>
            <span class="nt">&lt;cantidad&gt;</span>500<span class="nt">&lt;/cantidad&gt;</span>
        <span class="nt">&lt;/suministra&gt;</span>
        <span class="nt">&lt;suministra&gt;</span>
            <span class="nt">&lt;numprov&gt;</span>v5<span class="nt">&lt;/numprov&gt;</span>
            <span class="nt">&lt;numparte&gt;</span>p6<span class="nt">&lt;/numparte&gt;</span>
            <span class="nt">&lt;numproyecto&gt;</span>y2<span class="nt">&lt;/numproyecto&gt;</span>
            <span class="nt">&lt;cantidad&gt;</span>200<span class="nt">&lt;/cantidad&gt;</span>
        <span class="nt">&lt;/suministra&gt;</span>
        <span class="nt">&lt;suministra&gt;</span>
            <span class="nt">&lt;numprov&gt;</span>v5<span class="nt">&lt;/numprov&gt;</span>
            <span class="nt">&lt;numparte&gt;</span>p1<span class="nt">&lt;/numparte&gt;</span>
            <span class="nt">&lt;numproyecto&gt;</span>y4<span class="nt">&lt;/numproyecto&gt;</span>
            <span class="nt">&lt;cantidad&gt;</span>100<span class="nt">&lt;/cantidad&gt;</span>
        <span class="nt">&lt;/suministra&gt;</span>
        <span class="nt">&lt;suministra&gt;</span>
            <span class="nt">&lt;numprov&gt;</span>v5<span class="nt">&lt;/numprov&gt;</span>
            <span class="nt">&lt;numparte&gt;</span>p3<span class="nt">&lt;/numparte&gt;</span>
            <span class="nt">&lt;numproyecto&gt;</span>y4<span class="nt">&lt;/numproyecto&gt;</span>
            <span class="nt">&lt;cantidad&gt;</span>200<span class="nt">&lt;/cantidad&gt;</span>
        <span class="nt">&lt;/suministra&gt;</span>
        <span class="nt">&lt;suministra&gt;</span>
            <span class="nt">&lt;numprov&gt;</span>v5<span class="nt">&lt;/numprov&gt;</span>
            <span class="nt">&lt;numparte&gt;</span>p4<span class="nt">&lt;/numparte&gt;</span>
            <span class="nt">&lt;numproyecto&gt;</span>y4<span class="nt">&lt;/numproyecto&gt;</span>
            <span class="nt">&lt;cantidad&gt;</span>800<span class="nt">&lt;/cantidad&gt;</span>
        <span class="nt">&lt;/suministra&gt;</span>
        <span class="nt">&lt;suministra&gt;</span>
            <span class="nt">&lt;numprov&gt;</span>v5<span class="nt">&lt;/numprov&gt;</span>
            <span class="nt">&lt;numparte&gt;</span>p5<span class="nt">&lt;/numparte&gt;</span>
            <span class="nt">&lt;numproyecto&gt;</span>y4<span class="nt">&lt;/numproyecto&gt;</span>
            <span class="nt">&lt;cantidad&gt;</span>400<span class="nt">&lt;/cantidad&gt;</span>
        <span class="nt">&lt;/suministra&gt;</span>
        <span class="nt">&lt;suministra&gt;</span>
            <span class="nt">&lt;numprov&gt;</span>v5<span class="nt">&lt;/numprov&gt;</span>
            <span class="nt">&lt;numparte&gt;</span>p6<span class="nt">&lt;/numparte&gt;</span>
            <span class="nt">&lt;numproyecto&gt;</span>y4<span class="nt">&lt;/numproyecto&gt;</span>
            <span class="nt">&lt;cantidad&gt;</span>500<span class="nt">&lt;/cantidad&gt;</span>
        <span class="nt">&lt;/suministra&gt;</span>
    <span class="nt">&lt;/suministros&gt;</span>
<span class="nt">&lt;/datos&gt;</span>
</pre></div>
</div>
<p>En el esquema siguiente se muestra el mismo fichero en forma de tablas.</p>
<div class="figure align-default" id="id16">
<a class="reference internal image-reference" href="_images/BaseDatosProveedoresPartesProyectos.png"><img alt="_images/BaseDatosProveedoresPartesProyectos.png" src="_images/BaseDatosProveedoresPartesProyectos.png" style="width: 706.3px; height: 385.7px;" /></a>
<p class="caption"><span class="caption-text">Estructura de tablas del XML de la base de datos de proveedores, partes y proyectos</span><a class="headerlink" href="#id16" title="Enlace permanente a esta imagen">¶</a></p>
</div>
<p>En él podríamos ejecutar consultas como estas:
* Recuperar todos los proveedores con <code class="docutils literal notranslate"><span class="pre">doc(&quot;datos.xml&quot;)/datos/proveedores</span></code>
* Recuperar todos los datos con <code class="docutils literal notranslate"><span class="pre">doc(&quot;datos.xml&quot;)/datos/</span></code>
* Recuperar todas las partes con <code class="docutils literal notranslate"><span class="pre">doc(&quot;datos.xml&quot;)/datos/partes</span></code>.</p>
<p>De hecho, podemos usar las mismas consultas con predicados XPath y así por ejemplo extraer los datos del proveedor cuyo numprov es “v1” con la consulta siguiente:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">doc</span><span class="p">(</span><span class="s2">&quot;datos.xml&quot;</span><span class="p">)</span><span class="o">/</span><span class="n">datos</span><span class="o">/</span><span class="n">proveedores</span><span class="o">/</span><span class="n">proveedor</span><span class="p">[</span><span class="nd">@numprov</span><span class="o">=</span><span class="s1">&#39;v1&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>Que devuelve este resultado:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;proveedor</span> <span class="na">numprov=</span><span class="s">&quot;v1&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;nombreprov&gt;</span>Smith<span class="nt">&lt;/nombreprov&gt;</span>
    <span class="nt">&lt;estado&gt;</span>20<span class="nt">&lt;/estado&gt;</span>
    <span class="nt">&lt;ciudad&gt;</span>Londres<span class="nt">&lt;/ciudad&gt;</span>
<span class="nt">&lt;/proveedor&gt;</span>
</pre></div>
</div>
<p>Extraer los datos de partes cuyo color sea “Rojo”. La consulta XQuery sería:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">doc</span><span class="p">(</span><span class="s2">&quot;datos.xml&quot;</span><span class="p">)</span><span class="o">/</span><span class="n">datos</span><span class="o">/</span><span class="n">partes</span><span class="o">/</span><span class="n">parte</span><span class="p">[</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;Rojo&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>Y el resultado sería:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;parte</span> <span class="na">numparte=</span><span class="s">&quot;p1&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;nombreparte&gt;</span>Tuerca<span class="nt">&lt;/nombreparte&gt;</span>
    <span class="nt">&lt;color&gt;</span>Rojo<span class="nt">&lt;/color&gt;</span>
    <span class="nt">&lt;peso&gt;</span>12<span class="nt">&lt;/peso&gt;</span>
    <span class="nt">&lt;ciudad&gt;</span>Londres<span class="nt">&lt;/ciudad&gt;</span>
<span class="nt">&lt;/parte&gt;</span>
<span class="nt">&lt;parte</span> <span class="na">numparte=</span><span class="s">&quot;p4&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;nombreparte&gt;</span>Tornillo<span class="nt">&lt;/nombreparte&gt;</span>
    <span class="nt">&lt;color&gt;</span>Rojo<span class="nt">&lt;/color&gt;</span>
    <span class="nt">&lt;peso&gt;</span>14<span class="nt">&lt;/peso&gt;</span>
    <span class="nt">&lt;ciudad&gt;</span>Londres<span class="nt">&lt;/ciudad&gt;</span>
<span class="nt">&lt;/parte&gt;</span>
<span class="nt">&lt;parte</span> <span class="na">numparte=</span><span class="s">&quot;p6&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;nombreparte&gt;</span>Engranaje<span class="nt">&lt;/nombreparte&gt;</span>
    <span class="nt">&lt;color&gt;</span>Rojo<span class="nt">&lt;/color&gt;</span>
    <span class="nt">&lt;peso&gt;</span>19<span class="nt">&lt;/peso&gt;</span>
    <span class="nt">&lt;ciudad&gt;</span>Londres<span class="nt">&lt;/ciudad&gt;</span>
<span class="nt">&lt;/parte&gt;</span>
</pre></div>
</div>
<p>En XQuery se pueden mezclar las marcas con el programa. Sin embargo, para poder distinguir lo que se tiene que ejecutar de lo que no, tendremos que encerrar nuestras sentencias XQuery entre llaves y dejar las marcas fuera de las llaves.</p>
<p>Así, esta consulta consigue generarnos un XML valido añadiendo un elemento raíz al conjunto de partes:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">partesrojas</span><span class="o">&gt;</span>
<span class="p">{</span>
    <span class="n">doc</span><span class="p">(</span><span class="s2">&quot;datos.xml&quot;</span><span class="p">)</span><span class="o">/</span><span class="n">datos</span><span class="o">/</span><span class="n">partes</span><span class="o">/</span><span class="n">parte</span><span class="p">[</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;Rojo&#39;</span><span class="p">]</span>
<span class="p">}</span>
<span class="o">&lt;/</span><span class="n">partesrojas</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>El resultado devuelto es este:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;partesrojas&gt;</span>
    <span class="nt">&lt;parte</span> <span class="na">numparte=</span><span class="s">&quot;p1&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;nombreparte&gt;</span>Tuerca<span class="nt">&lt;/nombreparte&gt;</span>
        <span class="nt">&lt;color&gt;</span>Rojo<span class="nt">&lt;/color&gt;</span>
        <span class="nt">&lt;peso&gt;</span>12<span class="nt">&lt;/peso&gt;</span>
        <span class="nt">&lt;ciudad&gt;</span>Londres<span class="nt">&lt;/ciudad&gt;</span>
    <span class="nt">&lt;/parte&gt;&lt;parte</span> <span class="na">numparte=</span><span class="s">&quot;p4&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;nombreparte&gt;</span>Tornillo<span class="nt">&lt;/nombreparte&gt;</span>
        <span class="nt">&lt;color&gt;</span>Rojo<span class="nt">&lt;/color&gt;</span>
        <span class="nt">&lt;peso&gt;</span>14<span class="nt">&lt;/peso&gt;</span>
        <span class="nt">&lt;ciudad&gt;</span>Londres<span class="nt">&lt;/ciudad&gt;</span>
    <span class="nt">&lt;/parte&gt;&lt;parte</span> <span class="na">numparte=</span><span class="s">&quot;p6&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;nombreparte&gt;</span>Engranaje<span class="nt">&lt;/nombreparte&gt;</span>
        <span class="nt">&lt;color&gt;</span>Rojo<span class="nt">&lt;/color&gt;</span>
        <span class="nt">&lt;peso&gt;</span>19<span class="nt">&lt;/peso&gt;</span>
        <span class="nt">&lt;ciudad&gt;</span>Londres<span class="nt">&lt;/ciudad&gt;</span>
    <span class="nt">&lt;/parte&gt;</span>
<span class="nt">&lt;/partesrojas&gt;</span>
</pre></div>
</div>
<p>Antes se ha mencionado que se puede usar <code class="docutils literal notranslate"><span class="pre">WHERE</span></code> para crear condiciones. ¿Como cambiar entonces la consulta anterior para poner la condición en un <code class="docutils literal notranslate"><span class="pre">WHERE</span></code> y no meterla entre corchetes?</p>
<p>Si queremos usar un <code class="docutils literal notranslate"><span class="pre">where</span></code> es porque queremos filtrar un conjunto de elementos, y si queremos un conjunto de elementos necesitaremos un bucle <code class="docutils literal notranslate"><span class="pre">for</span></code>. Y a su vez, si recorremos un conjunto de elementos tendremos que hacer algún procesamiento con ellos o al menos devolverlos de la manera normal.</p>
<div class="section" id="bucles-for-en-xquery">
<h3>Bucles <code class="docutils literal notranslate"><span class="pre">for</span></code> en XQuery<a class="headerlink" href="#bucles-for-en-xquery" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Los bucles de XQuery son parecidos a los de Java. Hay una variable de bucle que iremos procesando de alguna manera. Dicha variable llevará siempre el simbolo del dolar ($). Así, un bucle que recupera todas las partes sería:</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="x">for $p in doc(&quot;datos.xml&quot;)/datos/partes/parte</span>
<span class="x">return $p</span>
</pre></div>
</div>
<p>Si ahora queremos filtrar las partes rojas haremos esto:</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="x">for $p in doc(&quot;datos.xml&quot;)/datos/partes/parte</span>
<span class="x">where $p/color=&#39;Rojo&#39;</span>
<span class="x">return $p</span>
</pre></div>
</div>
<p>Y si ahora queremos un nuevo elemento raíz podremos hacer esto:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;partesrojas&gt;</span>
{
    for $p in doc(&quot;datos.xml&quot;)/datos/partes/parte
    where $p/color=&#39;Rojo&#39;
    return $p
}
<span class="nt">&lt;/partesrojas&gt;</span>
</pre></div>
</div>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;suministrosgrandes&gt;</span>
{
    for $suministra
    in doc(&quot;datos.xml&quot;)/datos/suministros/suministra
    where $suministra/cantidad &gt; 450
    return $suministra
}
<span class="nt">&lt;/suministrosgrandes&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="ordenacion-en-xquery">
<h3>Ordenación en XQuery<a class="headerlink" href="#ordenacion-en-xquery" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Si se desea ordenar un conjunto de datos puede usarse la clásula <code class="docutils literal notranslate"><span class="pre">order</span> <span class="pre">by</span></code> poniendo despues uno o varios elementos o atributos y usando <code class="docutils literal notranslate"><span class="pre">ascending</span></code> o <code class="docutils literal notranslate"><span class="pre">descending</span></code>, de manera similar a SQL.</p>
<p>Así, por ejemplo, para ordenar la consulta anterior por cantidad usaríamos esto:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;suministrosgrandes&gt;</span>
{
    for $suministra
    in doc(&quot;datos.xml&quot;)/datos/suministros/suministra
    where $suministra/cantidad &gt; 450
    order by $suministra/cantidad descending
    return $suministra
}
<span class="nt">&lt;/suministrosgrandes&gt;</span>
</pre></div>
</div>
<p>Igual que en SQL se pueden combinar varios campos. Si por ejemplo quisiéramos ordenar por proveedor ascendente y luego por parte descendiente haríamos esto.</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;suministrosgrandes&gt;</span>
{
    for $suministra
    in doc(&quot;datos.xml&quot;)/datos/suministros/suministra
    where $suministra/cantidad &gt; 450
    order by $suministra/proveedor ascending,
            $suministra/parte descending
    return $suministra
}
<span class="nt">&lt;/suministrosgrandes&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="funciones-en-xquery">
<h3>Funciones en XQuery<a class="headerlink" href="#funciones-en-xquery" title="Enlazar permanentemente con este título">¶</a></h3>
<p>XQuery y XPath comparten funciones que permiten aplicar procesamiento extra a los nodos de un XML. A continuación se nombran algunas muy usadas:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">concat($fila,</span> <span class="pre">'</span> <span class="pre">')</span></code> concatena dos elementos, en este caso pone un espacio tras los datos de <code class="docutils literal notranslate"><span class="pre">fila</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">string-length($elemento)</span></code> devuelve la longitud de una cadena.</p></li>
<li><p>XQuery también tiene «funciones de agregación» al estilo de SQL como <code class="docutils literal notranslate"><span class="pre">sum</span></code>, <code class="docutils literal notranslate"><span class="pre">count</span></code> y <code class="docutils literal notranslate"><span class="pre">avg</span></code>. Además se pueden aplicar directamente a un conjunto sin necesidad de hacer un bucle <code class="docutils literal notranslate"><span class="pre">for</span></code>.</p></li>
<li><p>En XQuery se usa <code class="docutils literal notranslate"><span class="pre">distinct-values</span></code> en lugar de <code class="docutils literal notranslate"><span class="pre">distinct</span></code> como hace SQL.</p></li>
</ul>
</div>
<div class="section" id="consultas-de-ejemplo">
<h3>Consultas de ejemplo<a class="headerlink" href="#consultas-de-ejemplo" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Las siguientes consultas van referidas a la  base de datos de proveedores y partes que aparecen al principio.</p>
<div class="section" id="suministros-grandes">
<h4>Suministros grandes<a class="headerlink" href="#suministros-grandes" title="Enlazar permanentemente con este título">¶</a></h4>
<p>Usando <code class="docutils literal notranslate"><span class="pre">where</span></code> recuperar de la tabla de suministros todas las cantidades que sean mayores de 450. Encerrar los resultados dentro de un elemento raíz <code class="docutils literal notranslate"><span class="pre">suministrosgrandes</span></code></p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;suministrosgrandes&gt;</span>
{
for $fila in doc(&quot;datos.xml&quot;)//suministra
where $fila/cantidad &gt; 450
return $fila/cantidad
}
<span class="nt">&lt;/suministrosgrandes&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="renombrado-de-etiquetas">
<h4>Renombrado de etiquetas<a class="headerlink" href="#renombrado-de-etiquetas" title="Enlazar permanentemente con este título">¶</a></h4>
<p>Usando <code class="docutils literal notranslate"><span class="pre">where</span></code> recuperar de la tabla de suministros todas las cantidades que sean mayores de 450 <em>y haciendo que las etiquetas cantidad pasen a llamarse numpartes</em> . Encerrar los resultados dentro de un elemento raíz <code class="docutils literal notranslate"><span class="pre">suministrosgrandes</span></code></p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;suministrosgrandes&gt;</span>
{
for $fila in doc(&quot;datos.xml&quot;)//suministra
where $fila/cantidad &gt; 450
return <span class="nt">&lt;numpartes&gt;</span>
         {$fila/cantidad/text()}
       <span class="nt">&lt;/numpartes&gt;</span>
}
<span class="nt">&lt;/suministrosgrandes&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="cruces-o-joins">
<h4>Cruces o joins<a class="headerlink" href="#cruces-o-joins" title="Enlazar permanentemente con este título">¶</a></h4>
<p>Recuperar la ciudad de los proveedores que suministran mas de 450 partes. Devolverlo todo dentro de un elemento raíz <code class="docutils literal notranslate"><span class="pre">resultados</span></code> haciendo que en cada fila haya un elemento <code class="docutils literal notranslate"><span class="pre">datos</span></code> que tenga a su vez tres hijos:</p>
<ul class="simple">
<li><p>Un elemento <code class="docutils literal notranslate"><span class="pre">numprov</span></code> donde se vea el numero de proveedor.</p></li>
<li><p>Un elemento <code class="docutils literal notranslate"><span class="pre">nombre</span></code> donde se vea el nombre del proveedor.</p></li>
<li><p>Un elemento <code class="docutils literal notranslate"><span class="pre">cantidadpartes</span></code> donde vaya la cantidad de partes suministradas (que evidentemente debería ser siempre mayor de 450)</p></li>
</ul>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;resultados&gt;</span>
{
for $proveedor in doc(&quot;datos.xml&quot;)/datos/proveedores/proveedor
for $suministra in doc(&quot;datos.xml&quot;)/datos/suministros/suministra
where $proveedor/@numprov=$suministra/numprov
and $suministra/cantidad &gt; 450
return <span class="nt">&lt;datos&gt;</span>
        <span class="nt">&lt;numprov&gt;</span>
        {string($proveedor/@numprov)}
        <span class="nt">&lt;/numprov&gt;</span>
        <span class="nt">&lt;nombre&gt;</span>
        {$proveedor/nombreprov/text()}
        <span class="nt">&lt;/nombre&gt;</span>
        <span class="nt">&lt;cantidadpartes&gt;</span>
        {$suministra/cantidad/text()}
        <span class="nt">&lt;/cantidadpartes&gt;</span>
       <span class="nt">&lt;/datos&gt;</span>
}
<span class="nt">&lt;/resultados&gt;</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="fundamentos-de-dom-con-java">
<h2>Fundamentos de DOM con Java<a class="headerlink" href="#fundamentos-de-dom-con-java" title="Enlazar permanentemente con este título">¶</a></h2>
<p>En primer lugar va a ser necesario importar las clases correctas para poder usar DOM. La línea correcta es</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">javax.xml.parsers.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.w3c.dom.*</span><span class="o">;</span>
</pre></div>
</div>
<p>Un parser es un programa que analiza la sintaxis de un fichero, en nuestro caso un fichero XML. En castellano se debería decir analizador o analizador gramatical.</p>
</div>
<div class="section" id="ejemplo-de-base">
<h2>Ejemplo de base<a class="headerlink" href="#ejemplo-de-base" title="Enlazar permanentemente con este título">¶</a></h2>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">com.ies</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.xml.parsers.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.File</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.w3c.dom.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ProcesadorXML</span> <span class="o">{</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">procesarArchivo</span><span class="o">(</span><span class="n">String</span> <span class="n">nombreArchivo</span><span class="o">){</span>
                <span class="n">DocumentBuilderFactory</span> <span class="n">fabrica</span><span class="o">;</span>
                <span class="n">DocumentBuilder</span> <span class="n">constructor</span><span class="o">;</span>
                <span class="n">Document</span> <span class="n">documentoXML</span><span class="o">;</span>
                <span class="n">File</span> <span class="n">fichero</span><span class="o">=</span><span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="n">nombreArchivo</span><span class="o">);</span>
                <span class="n">fabrica</span><span class="o">=</span>
                        <span class="n">DocumentBuilderFactory</span><span class="o">.</span><span class="na">newInstance</span><span class="o">();</span>
                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Procesando &quot;</span><span class="o">+</span><span class="n">nombreArchivo</span><span class="o">);</span>
                <span class="k">try</span> <span class="o">{</span>
                        <span class="n">constructor</span><span class="o">=</span>
                          <span class="n">fabrica</span><span class="o">.</span><span class="na">newDocumentBuilder</span><span class="o">();</span>
                        <span class="n">documentoXML</span><span class="o">=</span><span class="n">constructor</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="n">fichero</span><span class="o">);</span>
                <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                        <span class="c1">// TODO Auto-generated catch block</span>
                        <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
                <span class="o">}</span>



        <span class="o">}</span>
        <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span> <span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">argumentos</span><span class="o">){</span>
                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Probando...&quot;</span><span class="o">);</span>
                <span class="n">ProcesadorXML</span> <span class="n">proc</span><span class="o">=</span><span class="k">new</span> <span class="n">ProcesadorXML</span><span class="o">();</span>
                <span class="n">proc</span><span class="o">.</span><span class="na">procesarArchivo</span><span class="o">(</span><span class="s">&quot;bolsas.xml&quot;</span><span class="o">);</span>
        <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="la-clase-document">
<h2>La clase Document<a class="headerlink" href="#la-clase-document" title="Enlazar permanentemente con este título">¶</a></h2>
<p>La clase Document es una representación Java que almacena en memoria un archivo XML.Mediante esta clase y otras clases compañeras podremos recorrer cualquier punto del archivo XML.</p>
<p>Este recorrido se basa siempre en la visita de nodos hijo o nodos hermano. No todos los nodos son iguales y se debe tener presente que en un nodo podríamos encontrar que los saltos de línea pueden ser un problema a la hora de recorrer el árbol DOM.</p>
<p>Por ejemplo, dado un documento, se debe empezar obteniendo la raíz. Este elemento se llama también el “elemento documento” y podemos obtenerlo así:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">documento</span><span class="o">=</span><span class="n">constructor</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="n">archivoXML</span><span class="o">);</span>
<span class="n">Element</span> <span class="n">raiz</span><span class="o">=</span><span class="n">documento</span><span class="o">.</span><span class="na">getDocumentElement</span><span class="o">();</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">raiz</span><span class="o">.</span><span class="na">getNodeName</span><span class="o">());</span>
</pre></div>
</div>
<p>La clase principal que nos interesa es la clase <code class="docutils literal notranslate"><span class="pre">Node</span></code>, siendo <code class="docutils literal notranslate"><span class="pre">Document</span></code> su clase Hija. Algunos métodos de interés son estos:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">getDocumentElement()</span></code> obtiene el elemento raíz, a partir del cual podremos empezar a «navegar» a través de los elementos.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">getFirstChild()</span></code> obtiene el primer elemento hijo del nodo que estemos visitando.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">getParentNode()</span></code> nos permite obtener el nodo padre de un cierto nodo.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">getChildNodes()</span></code> obtiene todos los nodos hijo.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">getNextSibling()</span></code> obtiene el siguiente nodo hermano.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">getChildNodes()</span></code> devuelve un <code class="docutils literal notranslate"><span class="pre">NodeList</span></code> con todos los hijos de un elemento. Esta <code class="docutils literal notranslate"><span class="pre">NodeList</span></code> se puede recorrer con un <code class="docutils literal notranslate"><span class="pre">for</span></code>, obteniendo el tamaño de la lista con <code class="docutils literal notranslate"><span class="pre">getLength()</span></code> y extrayendo los elementos con el método <code class="docutils literal notranslate"><span class="pre">item(posicion)</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">getNodeType()</span></code> es un método que nos indica el tipo de nodo (devuelve un <code class="docutils literal notranslate"><span class="pre">short</span></code>). Podemos comparar con <code class="docutils literal notranslate"><span class="pre">Node.ELEMENT_NODE</span></code> para ver si el nodo es realmente un elemento.</p></li>
<li><p>Otro método de utilidad es <code class="docutils literal notranslate"><span class="pre">getElementsByTagName</span></code> que extrae todos los subelementos que tengan un cierto nombre de etiqueta.</p></li>
</ul>
<div class="admonition hint">
<p class="admonition-title">Consejo</p>
<p>En general, hay muchas clases que proporcionan más métodos de utilidad, como por ejemplo la clase <code class="docutils literal notranslate"><span class="pre">Element</span></code>. En muchas ocasiones, podremos hacer un <code class="docutils literal notranslate"><span class="pre">cast</span></code> y aprovecharnos de ellos.</p>
</div>
<p>Cuando se procesan archivos, se debe tener especial importancia a los espacios en blanco que pueda haber. Estos dos archivos no son iguales:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span>El primer hijo de listado es <span class="nt">&lt;futuro&gt;</span>
<span class="nt">&lt;listado&gt;&lt;futuro&gt;</span>...<span class="nt">&lt;/futuro&gt;&lt;/listado&gt;</span>
</pre></div>
</div>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span>Aquí el primer hijo de listado es \n
<span class="nt">&lt;listado&gt;</span>
        <span class="nt">&lt;futuro&gt;</span>...<span class="nt">&lt;/futuro&gt;</span>
<span class="nt">&lt;/listado&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="ejercicios">
<h2>Ejercicios<a class="headerlink" href="#ejercicios" title="Enlazar permanentemente con este título">¶</a></h2>
<div class="section" id="ejercicio">
<h3>Ejercicio<a class="headerlink" href="#ejercicio" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Dado el siguiente archivo XML crear un programa que muestre todos los nombres:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;listaempleados&gt;</span>
        <span class="nt">&lt;empleado</span> <span class="na">edad=</span><span class="s">&quot;27&quot;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;nombre&gt;</span>Pepe Perez<span class="nt">&lt;/nombre&gt;</span>
                <span class="nt">&lt;categoria&gt;</span>Empleado<span class="nt">&lt;/categoria&gt;</span>
        <span class="nt">&lt;/empleado&gt;</span>
        <span class="nt">&lt;empleado</span> <span class="na">edad=</span><span class="s">&quot;34&quot;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;nombre&gt;</span>Juan Sanchez<span class="nt">&lt;/nombre&gt;</span>
                <span class="nt">&lt;categoria&gt;</span>Gerente<span class="nt">&lt;/categoria&gt;</span>
        <span class="nt">&lt;/empleado&gt;</span>
<span class="nt">&lt;/listaempleados&gt;</span>
</pre></div>
</div>
<p>La solución podría ser algo así:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ProcesadorXML</span> <span class="o">{</span>
        <span class="n">String</span> <span class="n">ruta</span><span class="o">;</span>
        <span class="kd">public</span> <span class="nf">ProcesadorXML</span><span class="o">(</span><span class="n">String</span> <span class="n">ruta</span><span class="o">){</span>
                <span class="k">this</span><span class="o">.</span><span class="na">ruta</span><span class="o">=</span><span class="n">ruta</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="kd">public</span> <span class="n">Element</span> <span class="nf">getRaiz</span><span class="o">()</span>
                        <span class="kd">throws</span> <span class="n">ParserConfigurationException</span><span class="o">,</span> <span class="n">SAXException</span><span class="o">,</span> <span class="n">IOException</span><span class="o">{</span>
                <span class="n">DocumentBuilderFactory</span> <span class="n">fabrica</span><span class="o">;</span>
                <span class="n">fabrica</span><span class="o">=</span>
                <span class="n">DocumentBuilderFactory</span><span class="o">.</span><span class="na">newInstance</span><span class="o">();</span>
                <span class="cm">/* A partir de un fichero XML</span>
<span class="cm">                 * crea el objeto documento en memoria*/</span>
                <span class="n">DocumentBuilder</span> <span class="n">creadorObjDocumento</span><span class="o">;</span>
                <span class="n">creadorObjDocumento</span><span class="o">=</span>
                        <span class="n">fabrica</span><span class="o">.</span><span class="na">newDocumentBuilder</span><span class="o">();</span>
                <span class="n">FileInputStream</span> <span class="n">fich</span><span class="o">;</span>
                <span class="n">fich</span><span class="o">=</span><span class="k">new</span> <span class="n">FileInputStream</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">ruta</span><span class="o">);</span>

                <span class="cm">/* Analiza el XML y</span>
<span class="cm">                 * lo carga en memoria */</span>
                <span class="n">Document</span> <span class="n">documento</span><span class="o">;</span>
                <span class="n">documento</span><span class="o">=</span>
                        <span class="n">creadorObjDocumento</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="n">fich</span><span class="o">);</span>
                <span class="n">Element</span> <span class="n">raiz</span><span class="o">;</span>
                <span class="n">raiz</span><span class="o">=</span><span class="n">documento</span><span class="o">.</span><span class="na">getDocumentElement</span><span class="o">();</span>
                <span class="k">return</span> <span class="n">raiz</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="cm">/* Este método imprime todos los nombres*/</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">todosNombres</span><span class="o">()</span>
                        <span class="kd">throws</span> <span class="n">ParserConfigurationException</span><span class="o">,</span>
                                <span class="n">SAXException</span><span class="o">,</span> <span class="n">IOException</span>
        <span class="o">{</span>
                <span class="n">Element</span> <span class="n">raiz</span><span class="o">=</span><span class="n">getRaiz</span><span class="o">();</span>
                <span class="n">Node</span> <span class="n">hijo</span><span class="o">=</span><span class="n">raiz</span><span class="o">.</span><span class="na">getFirstChild</span><span class="o">();</span>
                <span class="k">while</span> <span class="o">(</span><span class="n">hijo</span><span class="o">!=</span><span class="kc">null</span><span class="o">){</span>
                        <span class="n">String</span> <span class="n">nombreElemento</span><span class="o">;</span>
                        <span class="n">nombreElemento</span><span class="o">=</span><span class="n">hijo</span><span class="o">.</span><span class="na">getNodeName</span><span class="o">();</span>
                        <span class="k">if</span> <span class="o">(</span><span class="n">nombreElemento</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">&quot;empleado&quot;</span><span class="o">)){</span>
                                <span class="n">Node</span> <span class="n">hijoFinLinea</span><span class="o">=</span><span class="n">hijo</span><span class="o">.</span><span class="na">getFirstChild</span><span class="o">();</span>
                                <span class="n">Element</span> <span class="n">hijoNombre</span><span class="o">=(</span><span class="n">Element</span><span class="o">)</span> <span class="n">hijoFinLinea</span><span class="o">.</span><span class="na">getNextSibling</span><span class="o">();</span>
                                <span class="n">String</span> <span class="n">contenido</span><span class="o">=</span><span class="n">hijoNombre</span><span class="o">.</span><span class="na">getTextContent</span><span class="o">();</span>
                                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Empleado &quot;</span><span class="o">+</span><span class="n">contenido</span><span class="o">);</span>
                        <span class="o">}</span>
                        <span class="n">hijo</span><span class="o">=</span><span class="n">hijo</span><span class="o">.</span><span class="na">getNextSibling</span><span class="o">();</span>
                <span class="o">}</span>
        <span class="o">}</span>
        <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ParserConfigurationException</span><span class="o">,</span> <span class="n">SAXException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
                <span class="n">ProcesadorXML</span> <span class="n">procesador</span><span class="o">;</span>
                <span class="n">procesador</span><span class="o">=</span><span class="k">new</span> <span class="n">ProcesadorXML</span><span class="o">(</span>
                        <span class="s">&quot;D:/oscar/empleados.xml&quot;</span><span class="o">);</span>
                <span class="n">procesador</span><span class="o">.</span><span class="na">todosNombres</span><span class="o">();</span>
        <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<p>Ampliaciones:</p>
<ul class="simple">
<li><p>Añadir uno que devuelva todas las edades.</p></li>
<li><p>Añadir uno que devuelva los nombres de los empleados mayores de 30 (mostrando los nombres pero no las edades).</p></li>
<li><p>Añadir un método que diga cuantos empleados hay. El método debe ser capaz de tolerar que haya muchas líneas en blanco seguidas.</p></li>
</ul>
<p>El siguiente código resuelve el problema de mostrar los mayores de cierta edad:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kt">void</span> <span class="nf">mostrarMayoresDe</span><span class="o">(</span><span class="kt">int</span> <span class="n">edadMinima</span><span class="o">)</span>
                <span class="kd">throws</span> <span class="n">ParserConfigurationException</span><span class="o">,</span>
                <span class="n">SAXException</span><span class="o">,</span> <span class="n">IOException</span>
<span class="o">{</span>
        <span class="n">Element</span> <span class="n">raiz</span><span class="o">=</span><span class="n">getRaiz</span><span class="o">();</span>
        <span class="n">Node</span> <span class="n">finLinea</span><span class="o">=</span><span class="n">raiz</span><span class="o">.</span><span class="na">getFirstChild</span><span class="o">();</span>
        <span class="n">Element</span> <span class="n">empleado</span><span class="o">=(</span><span class="n">Element</span><span class="o">)</span> <span class="n">finLinea</span><span class="o">.</span><span class="na">getNextSibling</span><span class="o">();</span>
        <span class="k">while</span> <span class="o">(</span><span class="n">empleado</span><span class="o">!=</span><span class="kc">null</span><span class="o">){</span>
                <span class="n">String</span> <span class="n">edad</span><span class="o">=</span><span class="n">empleado</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&quot;edad&quot;</span><span class="o">);</span>
                <span class="kt">int</span> <span class="n">iEdad</span><span class="o">=</span><span class="n">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">edad</span><span class="o">);</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">iEdad</span><span class="o">&gt;</span><span class="n">edadMinima</span><span class="o">){</span>
                        <span class="n">finLinea</span><span class="o">=</span><span class="n">empleado</span><span class="o">.</span><span class="na">getFirstChild</span><span class="o">();</span>
                        <span class="n">Element</span> <span class="n">elemNombre</span><span class="o">=(</span><span class="n">Element</span><span class="o">)</span>
                                        <span class="n">finLinea</span><span class="o">.</span><span class="na">getNextSibling</span><span class="o">();</span>
                        <span class="n">String</span> <span class="n">nombreEmpleado</span><span class="o">=</span>
                                        <span class="n">elemNombre</span><span class="o">.</span><span class="na">getTextContent</span><span class="o">();</span>
                        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">nombreEmpleado</span> <span class="o">+</span>
                                        <span class="s">&quot; es mayor de &quot;</span><span class="o">+</span><span class="n">iEdad</span><span class="o">);</span>
                <span class="o">}</span> <span class="c1">//Fin del if</span>
                <span class="n">finLinea</span><span class="o">=</span><span class="n">empleado</span><span class="o">.</span><span class="na">getNextSibling</span><span class="o">();</span>
                <span class="n">empleado</span><span class="o">=(</span><span class="n">Element</span><span class="o">)</span> <span class="n">finLinea</span><span class="o">.</span><span class="na">getNextSibling</span><span class="o">();</span>
        <span class="o">}</span>       <span class="c1">//Fin del while</span>
<span class="o">}</span> <span class="c1">//Fin del método</span>
</pre></div>
</div>
<p>El método <code class="docutils literal notranslate"><span class="pre">getElementsByTagName</span></code> puede facilitar mucho el resolver ciertas tareas. Por ejemplo, supongamos que queremos resolver el problema de contar cuantos empleados hay:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kt">int</span> <span class="nf">contarEmpleados</span><span class="o">()</span>
                <span class="kd">throws</span> <span class="n">ParserConfigurationException</span><span class="o">,</span> <span class="n">SAXException</span><span class="o">,</span> <span class="n">IOException</span><span class="o">{</span>
        <span class="kt">int</span> <span class="n">numEmpleados</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span>
        <span class="n">Element</span> <span class="n">raiz</span><span class="o">=</span><span class="n">getRaiz</span><span class="o">();</span>
        <span class="n">NodeList</span> <span class="n">lista</span><span class="o">=</span><span class="n">raiz</span><span class="o">.</span><span class="na">getElementsByTagName</span><span class="o">(</span><span class="s">&quot;empleado&quot;</span><span class="o">);</span>
        <span class="n">numEmpleados</span><span class="o">=</span><span class="n">lista</span><span class="o">.</span><span class="na">getLength</span><span class="o">();</span>
        <span class="k">return</span> <span class="n">numEmpleados</span><span class="o">;</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="id1">
<h3>Ejercicio<a class="headerlink" href="#id1" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Extraer la raíz de un archivo XML</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="n">Node</span> <span class="nf">extraerRaiz</span><span class="o">(</span><span class="n">String</span> <span class="n">nombreArchivo</span><span class="o">){</span>
        <span class="n">DocumentBuilderFactory</span> <span class="n">fabrica</span><span class="o">;</span>
        <span class="n">DocumentBuilder</span> <span class="n">constructor</span><span class="o">;</span>
        <span class="n">Document</span> <span class="n">documentoXML</span><span class="o">=</span><span class="kc">null</span><span class="o">;</span>
        <span class="n">File</span> <span class="n">fichero</span><span class="o">=</span><span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="n">nombreArchivo</span><span class="o">);</span>
        <span class="n">fabrica</span><span class="o">=</span>
                <span class="n">DocumentBuilderFactory</span><span class="o">.</span><span class="na">newInstance</span><span class="o">();</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Procesando &quot;</span><span class="o">+</span><span class="n">nombreArchivo</span><span class="o">);</span>
        <span class="k">try</span> <span class="o">{</span>
                <span class="n">constructor</span><span class="o">=</span>
                  <span class="n">fabrica</span><span class="o">.</span><span class="na">newDocumentBuilder</span><span class="o">();</span>
                <span class="n">documentoXML</span><span class="o">=</span><span class="n">constructor</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="n">fichero</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                <span class="c1">// TODO Auto-generated catch block</span>
                <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">documentoXML</span><span class="o">.</span><span class="na">getDocumentElement</span><span class="o">();</span>

<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="id2">
<h3>Ejercicio<a class="headerlink" href="#id2" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Imprimir todos los elementos hijo del archivo XML.</p>
<p>Una posibilidad es la siguiente:</p>
<ul class="simple">
<li><p>Usar <code class="docutils literal notranslate"><span class="pre">getNextSibling</span></code> para ir recorriendo hermano a hermano hasta que se encuentre un <code class="docutils literal notranslate"><span class="pre">null</span></code></p></li>
<li><p>Para evitar los nodos texto, solo imprimiremos cosas cuando el <code class="docutils literal notranslate"><span class="pre">getNodeType()</span></code> nos devuelva un tipo <code class="docutils literal notranslate"><span class="pre">Node.ELEMENT_NODE</span></code></p></li>
</ul>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kt">void</span> <span class="nf">imprimirHijos</span><span class="o">(</span><span class="n">Node</span> <span class="n">nodoRaiz</span><span class="o">){</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">nodoRaiz</span><span class="o">==</span><span class="kc">null</span><span class="o">){</span>
                        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Imposible procesar raiz null&quot;</span><span class="o">);</span>
                        <span class="k">return</span> <span class="o">;</span>
                <span class="o">}</span>
                <span class="n">Node</span> <span class="n">nodo</span><span class="o">=</span><span class="n">nodoRaiz</span><span class="o">.</span><span class="na">getFirstChild</span><span class="o">();</span>
                <span class="k">while</span> <span class="o">(</span><span class="n">nodo</span><span class="o">!=</span><span class="kc">null</span><span class="o">){</span>
                        <span class="kt">short</span> <span class="n">tipo</span><span class="o">=</span><span class="n">nodo</span><span class="o">.</span><span class="na">getNodeType</span><span class="o">();</span>
                        <span class="k">if</span> <span class="o">(</span><span class="n">tipo</span><span class="o">==</span><span class="n">nodo</span><span class="o">.</span><span class="na">ELEMENT_NODE</span><span class="o">){</span>
                                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Nodo hijo:&quot;</span><span class="o">+</span><span class="n">nodo</span><span class="o">.</span><span class="na">getNodeName</span><span class="o">());</span>
                        <span class="o">}</span>
                        <span class="n">nodo</span><span class="o">=</span><span class="n">nodo</span><span class="o">.</span><span class="na">getNextSibling</span><span class="o">();</span>
                <span class="o">}</span>
        <span class="o">}</span>
</pre></div>
</div>
<p>Otra posibilidad sería usar el <code class="docutils literal notranslate"><span class="pre">getChildNodes</span></code> que nos devuelve un vector con todos los hijos. Sin embargo ocurrirá lo mismo, deberemos evitar el visitar nodos texto, solo nos interesan los nodos Elemento.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kt">void</span> <span class="nf">imprimirHijos2</span><span class="o">(</span><span class="n">Node</span> <span class="n">nodoRaiz</span><span class="o">){</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">nodoRaiz</span><span class="o">==</span><span class="kc">null</span><span class="o">){</span>
                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Imposible procesar raíz nula&quot;</span><span class="o">);</span>
                <span class="k">return</span><span class="o">;</span>
        <span class="o">}</span> <span class="c1">//Fin del if null</span>
        <span class="n">NodeList</span> <span class="n">lista</span><span class="o">=</span><span class="n">nodoRaiz</span><span class="o">.</span><span class="na">getChildNodes</span><span class="o">();</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">lista</span><span class="o">.</span><span class="na">getLength</span><span class="o">();</span><span class="n">i</span><span class="o">++){</span>
                <span class="n">Node</span> <span class="n">nodo</span><span class="o">=</span><span class="n">lista</span><span class="o">.</span><span class="na">item</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
                <span class="kt">short</span> <span class="n">tipo</span><span class="o">=</span><span class="n">nodo</span><span class="o">.</span><span class="na">getNodeType</span><span class="o">();</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">tipo</span><span class="o">==</span><span class="n">Node</span><span class="o">.</span><span class="na">ELEMENT_NODE</span><span class="o">){</span>
                        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Hijo:&quot;</span><span class="o">+</span><span class="n">nodo</span><span class="o">.</span><span class="na">getNodeName</span><span class="o">());</span>
                <span class="o">}</span> <span class="c1">//Fin del if</span>
        <span class="o">}</span> <span class="c1">//Fin del for</span>
<span class="o">}</span> <span class="c1">//Fin del método</span>
</pre></div>
</div>
</div>
<div class="section" id="ejercicio-extraccion-de-informacion-financiera">
<h3>Ejercicio: extracción de información financiera<a class="headerlink" href="#ejercicio-extraccion-de-informacion-financiera" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Dado el archivo XML siguiente…</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;listado&gt;</span>
        <span class="nt">&lt;futuro</span> <span class="na">precio=</span><span class="s">&quot;11.28&quot;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;producto&gt;</span>Cafe<span class="nt">&lt;/producto&gt;</span>
                <span class="nt">&lt;mercado&gt;</span>América Latina<span class="nt">&lt;/mercado&gt;</span>
                <span class="nt">&lt;ciudad_procedencia&gt;</span>
                        <span class="nt">&lt;frankfurt/&gt;</span>
                <span class="nt">&lt;/ciudad_procedencia&gt;</span>
        <span class="nt">&lt;/futuro&gt;</span>
        <span class="nt">&lt;divisa</span> <span class="na">precio=</span><span class="s">&quot;183&quot;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;nombre_divisa&gt;</span>Libra esterlina<span class="nt">&lt;/nombre_divisa&gt;</span>
                <span class="nt">&lt;tipo_de_cambio&gt;</span>2.7:1 euros<span class="nt">&lt;/tipo_de_cambio&gt;</span>
                <span class="nt">&lt;tipo_de_cambio&gt;</span>1:0.87 dólares<span class="nt">&lt;/tipo_de_cambio&gt;</span>
                <span class="nt">&lt;ciudad_procedencia&gt;</span>
                        <span class="nt">&lt;madrid/&gt;</span>
                <span class="nt">&lt;/ciudad_procedencia&gt;</span>
        <span class="nt">&lt;/divisa&gt;</span>
        <span class="nt">&lt;bono</span> <span class="na">precio=</span><span class="s">&quot;10000&quot;</span> <span class="na">estable=</span><span class="s">&quot;si&quot;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;pais_de_procedencia&gt;</span>
                        Islandia
                <span class="nt">&lt;/pais_de_procedencia&gt;</span>
                <span class="nt">&lt;valor_deseado&gt;</span>9980<span class="nt">&lt;/valor_deseado&gt;</span>
                <span class="nt">&lt;valor_minimo&gt;</span>9950<span class="nt">&lt;/valor_minimo&gt;</span>
                <span class="nt">&lt;valor_maximo&gt;</span>10020<span class="nt">&lt;/valor_maximo&gt;</span>
                <span class="nt">&lt;ciudad_procedencia&gt;</span>
                        <span class="nt">&lt;tokio/&gt;</span>
                <span class="nt">&lt;/ciudad_procedencia&gt;</span>
        <span class="nt">&lt;/bono&gt;</span>
        <span class="nt">&lt;letra</span> <span class="na">precio=</span><span class="s">&quot;45020&quot;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;tipo_de_interes&gt;</span>4.54%<span class="nt">&lt;/tipo_de_interes&gt;</span>
                <span class="nt">&lt;pais_emisor&gt;</span>
                        <span class="nt">&lt;espania/&gt;</span>
                <span class="nt">&lt;/pais_emisor&gt;</span>
                <span class="nt">&lt;ciudad_procedencia&gt;</span>
                        <span class="nt">&lt;madrid/&gt;</span>
                <span class="nt">&lt;/ciudad_procedencia&gt;</span>
        <span class="nt">&lt;/letra&gt;</span>
<span class="nt">&lt;/listado&gt;</span>
</pre></div>
</div>
<p>…crear un programa XML que:</p>
<ul class="simple">
<li><p>Busque todos los elementos cuya ciudad de procedencia sea «Madrid».</p></li>
<li><p>Si el elemento es un futuro mostrará el contenido de la etiqueta «producto».</p></li>
<li><p>Si el elemento es una divisa se mostrará el contenido de la etiqueta «nombre».</p></li>
<li><p>Si el elemento es una letra  se mostrará el contenido de la etiqueta «pais_emisor».</p></li>
<li><p>Si el elemento es un bono  se mostrará el contenido de la etiqueta «pais_de_procedencia».</p></li>
</ul>
<p>Una posibilidad (incompleta) sería esta:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span> <span class="kd">public</span> <span class="kd">class</span> <span class="nc">ProcesadorFinanzas</span> <span class="o">{</span>

   <span class="kd">public</span> <span class="kd">static</span> <span class="n">Element</span> <span class="nf">getRaiz</span> <span class="o">(</span><span class="n">String</span> <span class="n">rutaFichero</span><span class="o">){</span>

     <span class="n">Element</span> <span class="n">raiz</span><span class="o">=</span><span class="kc">null</span><span class="o">;</span>
     <span class="n">DocumentBuilderFactory</span> <span class="n">fabrica</span><span class="o">;</span>
     <span class="n">fabrica</span><span class="o">=</span><span class="n">DocumentBuilderFactory</span><span class="o">.</span><span class="na">newInstance</span><span class="o">();</span>
     <span class="n">DocumentBuilder</span> <span class="n">constructor</span><span class="o">;</span>
     <span class="k">try</span> <span class="o">{</span>
       <span class="n">constructor</span><span class="o">=</span><span class="n">fabrica</span><span class="o">.</span><span class="na">newDocumentBuilder</span><span class="o">();</span>
       <span class="n">FileInputStream</span> <span class="n">fichero</span><span class="o">;</span>
       <span class="n">fichero</span><span class="o">=</span><span class="k">new</span> <span class="n">FileInputStream</span><span class="o">(</span><span class="n">rutaFichero</span><span class="o">);</span>
       <span class="n">Document</span> <span class="n">documento</span><span class="o">;</span>
       <span class="n">documento</span><span class="o">=</span><span class="n">constructor</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="n">fichero</span><span class="o">);</span>
       <span class="n">raiz</span><span class="o">=</span><span class="n">documento</span><span class="o">.</span><span class="na">getDocumentElement</span><span class="o">();</span>
     <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">ParserConfigurationException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
       <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
     <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">FileNotFoundException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
       <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
     <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">SAXException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
       <span class="c1">// TODO Auto-generated catch block</span>
     <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
       <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
     <span class="o">}</span>
     <span class="k">return</span> <span class="n">raiz</span><span class="o">;</span>
   <span class="o">}</span>
   <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">mostrarMadrid</span><span class="o">(</span><span class="n">Element</span> <span class="n">raiz</span><span class="o">){</span>
     <span class="n">NodeList</span> <span class="n">hijos</span><span class="o">=</span><span class="n">raiz</span><span class="o">.</span><span class="na">getChildNodes</span><span class="o">();</span>
     <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">hijos</span><span class="o">.</span><span class="na">getLength</span><span class="o">();</span> <span class="n">i</span><span class="o">++){</span>
       <span class="n">Node</span> <span class="n">nodoVisitado</span><span class="o">=</span><span class="n">hijos</span><span class="o">.</span><span class="na">item</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
       <span class="k">if</span> <span class="o">(</span><span class="n">nodoVisitado</span><span class="o">.</span><span class="na">getNodeType</span><span class="o">()</span>
           <span class="o">==</span> <span class="n">Node</span><span class="o">.</span><span class="na">ELEMENT_NODE</span><span class="o">)</span> <span class="o">{</span>
         <span class="c1">//El nodo sí es un elemento y no</span>
         <span class="c1">//un nodo con texto \n</span>
         <span class="n">Element</span> <span class="n">elemVisitado</span><span class="o">;</span>
         <span class="n">elemVisitado</span><span class="o">=(</span><span class="n">Element</span><span class="o">)</span> <span class="n">nodoVisitado</span><span class="o">;</span>
         <span class="k">if</span> <span class="o">(</span><span class="n">elemVisitado</span><span class="o">.</span><span class="na">getTagName</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="s">&quot;futuro&quot;</span><span class="o">)){</span>
           <span class="n">procesarFuturo</span><span class="o">(</span><span class="n">elemVisitado</span><span class="o">);</span>
         <span class="o">}</span>
         <span class="k">if</span> <span class="o">(</span><span class="n">elemVisitado</span><span class="o">.</span><span class="na">getTagName</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="s">&quot;bono&quot;</span><span class="o">)){</span>
           <span class="n">procesarBono</span><span class="o">(</span><span class="n">elemVisitado</span><span class="o">);</span>
         <span class="o">}</span>
         <span class="k">if</span> <span class="o">(</span><span class="n">elemVisitado</span><span class="o">.</span><span class="na">getTagName</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="s">&quot;letra&quot;</span><span class="o">)){</span>
           <span class="n">procesarLetra</span><span class="o">(</span><span class="n">elemVisitado</span><span class="o">);</span>
         <span class="o">}</span>
         <span class="k">if</span> <span class="o">(</span><span class="n">elemVisitado</span><span class="o">.</span><span class="na">getTagName</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="s">&quot;divisa&quot;</span><span class="o">)){</span>
           <span class="n">procesarDivisa</span><span class="o">(</span><span class="n">elemVisitado</span><span class="o">);</span>
         <span class="o">}</span>
       <span class="o">}</span>
     <span class="o">}</span>
   <span class="o">}</span>
   <span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">procesarDivisa</span><span class="o">(</span><span class="n">Element</span> <span class="n">elemVisitado</span><span class="o">)</span> <span class="o">{</span>
     <span class="c1">// TODO Auto-generated method stub</span>

   <span class="o">}</span>
   <span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">procesarLetra</span><span class="o">(</span><span class="n">Element</span> <span class="n">elemVisitado</span><span class="o">)</span> <span class="o">{</span>
     <span class="c1">// TODO Auto-generated method stub</span>

   <span class="o">}</span>
   <span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">procesarBono</span><span class="o">(</span><span class="n">Element</span> <span class="n">elemVisitado</span><span class="o">)</span> <span class="o">{</span>
     <span class="c1">// TODO Auto-generated method stub</span>

   <span class="o">}</span>
   <span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">procesarFuturo</span><span class="o">(</span><span class="n">Element</span> <span class="n">elemVisitado</span><span class="o">)</span> <span class="o">{</span>
     <span class="n">NodeList</span> <span class="n">hijosCiudad</span><span class="o">;</span>
     <span class="n">hijosCiudad</span><span class="o">=</span><span class="n">elemVisitado</span><span class="o">.</span><span class="na">getElementsByTagName</span><span class="o">(</span>
         <span class="s">&quot;ciudad_procedencia&quot;</span><span class="o">);</span>
     <span class="n">Node</span> <span class="n">unicaCiudad</span><span class="o">=</span><span class="n">hijosCiudad</span><span class="o">.</span><span class="na">item</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
     <span class="n">NodeList</span> <span class="n">ciudades</span><span class="o">=</span><span class="n">unicaCiudad</span><span class="o">.</span><span class="na">getChildNodes</span><span class="o">();</span>
     <span class="n">Node</span> <span class="n">ciudadProcedencia</span><span class="o">=</span><span class="n">ciudades</span><span class="o">.</span><span class="na">item</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
     <span class="n">Element</span> <span class="n">elemCiudad</span><span class="o">=(</span><span class="n">Element</span><span class="o">)</span> <span class="n">ciudadProcedencia</span><span class="o">;</span>
     <span class="k">if</span> <span class="o">(</span><span class="n">elemCiudad</span><span class="o">.</span><span class="na">getTagName</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="s">&quot;madrid&quot;</span><span class="o">)){</span>
       <span class="n">NodeList</span> <span class="n">productos</span><span class="o">;</span>
       <span class="n">productos</span><span class="o">=</span><span class="n">elemVisitado</span><span class="o">.</span><span class="na">getElementsByTagName</span><span class="o">(</span>
           <span class="s">&quot;producto&quot;</span><span class="o">);</span>
       <span class="n">Element</span> <span class="n">elemProducto</span><span class="o">;</span>
       <span class="n">elemProducto</span><span class="o">=(</span><span class="n">Element</span><span class="o">)</span> <span class="n">productos</span><span class="o">.</span><span class="na">item</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
       <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span>
           <span class="n">elemProducto</span><span class="o">.</span><span class="na">getTextContent</span><span class="o">()</span> <span class="o">);</span>

     <span class="o">}</span>
   <span class="o">}</span>
   <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
     <span class="n">Element</span> <span class="n">raiz</span><span class="o">=</span><span class="n">getRaiz</span><span class="o">(</span>
       <span class="s">&quot;c:/users/ogomez/documents/finanzas.xml&quot;</span><span class="o">);</span>
     <span class="n">mostrarMadrid</span><span class="o">(</span><span class="n">raiz</span><span class="o">);</span>
   <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="id3">
<h3>Ejercicio<a class="headerlink" href="#id3" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Ampliar el programa para que nos diga cuantos elementos «divisa» hay en el archivo.</p>
<p>Para practicar esto y de paso practicar programación genérica, fabricaremos un método al que le pasaremos el nombre del elemento a buscar y el método nos dirá cuantos elementos con ese nombre hay.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kt">int</span> <span class="nf">contadorElementos</span><span class="o">(</span><span class="n">Node</span> <span class="n">raiz</span><span class="o">,</span><span class="n">String</span> <span class="n">nombreElemento</span><span class="o">){</span>
        <span class="kt">int</span> <span class="n">contador</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span>
        <span class="n">NodeList</span> <span class="n">nodosHijo</span><span class="o">=</span><span class="n">raiz</span><span class="o">.</span><span class="na">getChildNodes</span><span class="o">();</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">nodosHijo</span><span class="o">.</span><span class="na">getLength</span><span class="o">();</span><span class="n">i</span><span class="o">++){</span>
                <span class="n">Node</span> <span class="n">nodo</span><span class="o">=</span><span class="n">nodosHijo</span><span class="o">.</span><span class="na">item</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
                <span class="kt">short</span> <span class="n">tipo</span><span class="o">=</span><span class="n">nodo</span><span class="o">.</span><span class="na">getNodeType</span><span class="o">();</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">tipo</span><span class="o">==</span><span class="n">Node</span><span class="o">.</span><span class="na">ELEMENT_NODE</span><span class="o">){</span>
                        <span class="n">String</span> <span class="n">nombre</span><span class="o">=</span><span class="n">nodo</span><span class="o">.</span><span class="na">getNodeName</span><span class="o">();</span>
                        <span class="k">if</span> <span class="o">(</span><span class="n">nombre</span><span class="o">==</span><span class="n">nombreElemento</span><span class="o">){</span>
                                <span class="n">contador</span><span class="o">++;</span>
                        <span class="o">}</span> <span class="c1">//Fin del if interno</span>
                <span class="o">}</span> <span class="c1">//Fin del if externo</span>
        <span class="o">}</span> <span class="c1">//Fin del for</span>
        <span class="k">return</span> <span class="n">contador</span><span class="o">;</span>
<span class="o">}</span> <span class="c1">//Fin del método</span>
</pre></div>
</div>
</div>
<div class="section" id="id4">
<h3>Ejercicio<a class="headerlink" href="#id4" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Nos interesa conocer el precio de todos los bonos. Crear un programa que ejecute esta tarea.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">private</span> <span class="kt">void</span> <span class="nf">comprobarSiEsBono</span><span class="o">(</span><span class="n">Node</span> <span class="n">n</span><span class="o">){</span>
        <span class="n">String</span> <span class="n">nombre</span><span class="o">=</span><span class="n">n</span><span class="o">.</span><span class="na">getNodeName</span><span class="o">();</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">nombre</span><span class="o">==</span><span class="s">&quot;bono&quot;</span><span class="o">){</span>
                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Encontrado un bono&quot;</span><span class="o">);</span>
        <span class="o">}</span>
<span class="o">}</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">imprimirPrecioBonos</span><span class="o">(</span><span class="n">Node</span> <span class="n">raiz</span><span class="o">){</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">raiz</span><span class="o">==</span><span class="kc">null</span><span class="o">){</span>
                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Imposible procesar null&quot;</span><span class="o">);</span>
                <span class="k">return</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="n">NodeList</span> <span class="n">nodos</span><span class="o">=</span><span class="n">raiz</span><span class="o">.</span><span class="na">getChildNodes</span><span class="o">();</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">nodos</span><span class="o">.</span><span class="na">getLength</span><span class="o">();</span> <span class="n">i</span><span class="o">++){</span>
                <span class="n">Node</span> <span class="n">nodo</span><span class="o">=</span><span class="n">nodos</span><span class="o">.</span><span class="na">item</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
                <span class="kt">short</span> <span class="n">tipo</span><span class="o">=</span><span class="n">nodo</span><span class="o">.</span><span class="na">getNodeType</span><span class="o">();</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">tipo</span><span class="o">==</span><span class="n">Node</span><span class="o">.</span><span class="na">ELEMENT_NODE</span><span class="o">){</span>
                        <span class="k">this</span><span class="o">.</span><span class="na">comprobarSiEsBono</span><span class="o">(</span><span class="n">nodo</span><span class="o">);</span>
                <span class="o">}</span>
        <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="id5">
<h3>Ejercicio<a class="headerlink" href="#id5" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Crear un programa que nos diga cuantos productos financieros del listado no son estables. Es decir, que tengan el atributo estable y lo tengan a <code class="docutils literal notranslate"><span class="pre">false</span></code>.</p>
<p>En su momento, en la DTD se permitió que el atributo <code class="docutils literal notranslate"><span class="pre">estable</span></code> fuera <code class="docutils literal notranslate"><span class="pre">#IMPLIED</span></code>, es decir <strong>optativo</strong>. Al ser la DTD como un contrato, esto nos obliga a preparar nuestro código para manejar la posibilidad de que el atributo no esté presente.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kt">int</span> <span class="nf">cuantosInestables</span> <span class="o">(</span><span class="n">Node</span> <span class="n">raiz</span><span class="o">){</span>
        <span class="kt">int</span> <span class="n">cuantos</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span>
        <span class="n">NodeList</span> <span class="n">lista</span><span class="o">=</span><span class="n">raiz</span><span class="o">.</span><span class="na">getChildNodes</span><span class="o">();</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">lista</span><span class="o">.</span><span class="na">getLength</span><span class="o">();</span> <span class="n">i</span><span class="o">++){</span>
                <span class="n">Node</span> <span class="n">n</span><span class="o">=</span><span class="n">lista</span><span class="o">.</span><span class="na">item</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">n</span><span class="o">.</span><span class="na">getNodeType</span><span class="o">()!=</span><span class="n">Node</span><span class="o">.</span><span class="na">ELEMENT_NODE</span><span class="o">)</span> <span class="k">continue</span><span class="o">;</span>
                <span class="n">Element</span> <span class="n">e</span><span class="o">=(</span><span class="n">Element</span><span class="o">)</span> <span class="n">lista</span><span class="o">.</span><span class="na">item</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">e</span><span class="o">.</span><span class="na">getNodeName</span><span class="o">()==</span><span class="s">&quot;divisa&quot;</span> <span class="o">||</span>
                                <span class="n">e</span><span class="o">.</span><span class="na">getNodeName</span><span class="o">()==</span><span class="s">&quot;bono&quot;</span><span class="o">){</span>
                        <span class="n">String</span> <span class="n">atEstable</span><span class="o">=</span><span class="n">e</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&quot;estable&quot;</span><span class="o">);</span>
                        <span class="k">if</span> <span class="o">(</span><span class="n">atEstable</span><span class="o">!=</span><span class="kc">null</span><span class="o">){</span>
                                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Atributo:&quot;</span><span class="o">+</span><span class="n">atEstable</span><span class="o">);</span>
                                <span class="k">if</span> <span class="o">(</span><span class="n">atEstable</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">&quot;no&quot;</span><span class="o">)){</span>
                                        <span class="n">cuantos</span><span class="o">+=</span><span class="mi">1</span><span class="o">;</span>
                                <span class="o">}</span> <span class="c1">//Fin del if interno</span>
                        <span class="o">}</span> <span class="c1">//Fin del if atEstable</span>
                <span class="o">}</span> <span class="c1">//Fin de if nodo es divisa o bono</span>
        <span class="o">}</span> <span class="c1">//Fin del for que recorre los nodos</span>
        <span class="k">return</span> <span class="n">cuantos</span><span class="o">;</span>
<span class="o">}</span> <span class="c1">//Fin del método cuantosInestables</span>
</pre></div>
</div>
</div>
<div class="section" id="id6">
<h3>Ejercicio<a class="headerlink" href="#id6" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Sumar los precios de todos los productos financieros.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kt">float</span> <span class="nf">sumarAtributosPrecio</span><span class="o">(</span><span class="n">Node</span> <span class="n">raiz</span><span class="o">){</span>
        <span class="kt">float</span> <span class="n">precioTotal</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span>
        <span class="n">NodeList</span> <span class="n">hijos</span><span class="o">=</span><span class="n">raiz</span><span class="o">.</span><span class="na">getChildNodes</span><span class="o">();</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">hijos</span><span class="o">.</span><span class="na">getLength</span><span class="o">();</span> <span class="n">i</span><span class="o">++){</span>
                <span class="n">Node</span> <span class="n">hijo</span><span class="o">=</span><span class="n">hijos</span><span class="o">.</span><span class="na">item</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">hijo</span><span class="o">.</span><span class="na">getNodeType</span><span class="o">()!=</span><span class="n">Node</span><span class="o">.</span><span class="na">ELEMENT_NODE</span><span class="o">)</span> <span class="k">continue</span><span class="o">;</span>
                <span class="n">Element</span> <span class="n">e</span><span class="o">=(</span><span class="n">Element</span><span class="o">)</span> <span class="n">hijo</span><span class="o">;</span>
                <span class="n">String</span> <span class="n">precio</span><span class="o">=</span><span class="n">e</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&quot;precio&quot;</span><span class="o">);</span>
                <span class="n">Float</span> <span class="n">f</span><span class="o">=</span><span class="n">Float</span><span class="o">.</span><span class="na">parseFloat</span><span class="o">(</span><span class="n">precio</span><span class="o">);</span>
                <span class="n">precioTotal</span><span class="o">+=</span><span class="n">f</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">precioTotal</span><span class="o">;</span>
<span class="o">}</span> <span class="c1">//Fin del método sumarAtributosPrecio</span>
</pre></div>
</div>
</div>
<div class="section" id="id7">
<h3>Ejercicio<a class="headerlink" href="#id7" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Contar cuantos productos financieros tienen algo que ver con el país «Islandia»</p>
<p>Se deben tener presentes varias cosas:</p>
<ul>
<li><p>Si no se tiene claro lo que nos piden, preguntar.</p></li>
<li><p>En cualquier caso, si se tiene DTD, hay una buena pista.</p>
<blockquote>
<div><ul class="simple">
<li><p>Aparece un elemento llamado <code class="docutils literal notranslate"><span class="pre">&lt;pais_de_procedencia&gt;</span></code>, que puede contener cualquier cosa (incluido Islandia)</p></li>
<li><p>La ciudad de procedencia no incluye la capital o ninguna ciudad de dicho país, así que podemos ignorar eso.</p></li>
<li><p>También aparece un elemento llamado <code class="docutils literal notranslate"><span class="pre">&lt;pais_emisor&gt;</span></code>, pero tampoco incluye Islandia, en principio también podemos saltarlo.</p></li>
</ul>
</div></blockquote>
</li>
</ul>
<div class="section" id="analisis-del-problema">
<h4>Análisis del problema<a class="headerlink" href="#analisis-del-problema" title="Enlazar permanentemente con este título">¶</a></h4>
<p>Despues de haber examinado la DTD se llega a la conclusión de que el único elemento que puede transportar alguna clase de información relacionada con «Islandia» es el nodo <code class="docutils literal notranslate"><span class="pre">país_de_procedencia</span></code>, que es un elemento hijo del elemento <code class="docutils literal notranslate"><span class="pre">bono</span></code>.</p>
</div>
<div class="section" id="solucion">
<h4>Solución<a class="headerlink" href="#solucion" title="Enlazar permanentemente con este título">¶</a></h4>
<ul class="simple">
<li><p>La clase <code class="docutils literal notranslate"><span class="pre">Element</span></code> tiene un método llamado <code class="docutils literal notranslate"><span class="pre">getElementsByTagName</span></code> que nos permite recuperar de una sola vez todos los elementos con el nombre <code class="docutils literal notranslate"><span class="pre">bono</span></code>.</p></li>
<li><p>Se debe tener en cuenta que para llegar al elemento que nos interesa podemos seguir usando los métodos <code class="docutils literal notranslate"><span class="pre">getFirstChild</span></code> o <code class="docutils literal notranslate"><span class="pre">getNextSibling</span></code> para ir al primer hijo o para ir al siguiente hermano.</p></li>
<li><p>El contenido textual de un nodo se puede extraer con <code class="docutils literal notranslate"><span class="pre">getTextContent</span></code></p></li>
<li><p>Al procesar un contenido textual, podríamos encontrar muchos espacios en blanco, tabuladores u otros elementos que alteren las comparaciones entre cadenas, por lo que deberemos usar métodos como <code class="docutils literal notranslate"><span class="pre">trim()</span></code> que limpian los espacios en blanco.</p></li>
</ul>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kt">int</span> <span class="nf">algoQueVerCon</span><span class="o">(</span><span class="n">Node</span> <span class="n">raiz</span><span class="o">,</span> <span class="n">String</span> <span class="n">nombrePais</span><span class="o">){</span>
        <span class="kt">int</span> <span class="n">cuantos</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span>
        <span class="n">Element</span> <span class="n">elementoRaiz</span><span class="o">=(</span><span class="n">Element</span><span class="o">)</span> <span class="n">raiz</span><span class="o">;</span>
        <span class="n">NodeList</span> <span class="n">lista</span><span class="o">=</span><span class="n">elementoRaiz</span><span class="o">.</span><span class="na">getElementsByTagName</span><span class="o">(</span><span class="s">&quot;bono&quot;</span><span class="o">);</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">lista</span><span class="o">.</span><span class="na">getLength</span><span class="o">();</span> <span class="n">i</span><span class="o">++){</span>
                <span class="n">Node</span> <span class="n">nodoBono</span><span class="o">=</span><span class="n">lista</span><span class="o">.</span><span class="na">item</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
                <span class="n">Node</span> <span class="n">primerHijoTexto</span><span class="o">=</span><span class="n">nodoBono</span><span class="o">.</span><span class="na">getFirstChild</span><span class="o">();</span>
                <span class="n">Node</span> <span class="n">segHijoPais</span><span class="o">=</span><span class="n">primerHijoTexto</span><span class="o">.</span><span class="na">getNextSibling</span><span class="o">();</span>
                <span class="n">String</span> <span class="n">paisExtraido</span><span class="o">=</span><span class="n">segHijoPais</span><span class="o">.</span><span class="na">getTextContent</span><span class="o">();</span>
                <span class="c1">//Limpiamos espacios</span>
                <span class="n">paisExtraido</span><span class="o">=</span><span class="n">paisExtraido</span><span class="o">.</span><span class="na">trim</span><span class="o">();</span>
                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Pais extraido:&quot;</span><span class="o">+</span><span class="n">paisExtraido</span><span class="o">);</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">paisExtraido</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">nombrePais</span><span class="o">)){</span>
                        <span class="n">cuantos</span><span class="o">++;</span>
                <span class="o">}</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">cuantos</span><span class="o">;</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id8">
<h3>Ejercicio<a class="headerlink" href="#id8" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Se desea crear un método que indique cuantos elementos tienen relación de alguna forma con «España».</p>
<div class="section" id="analisis">
<h4>Análisis<a class="headerlink" href="#analisis" title="Enlazar permanentemente con este título">¶</a></h4>
<ul class="simple">
<li><p>Se dispone del método anterior <code class="docutils literal notranslate"><span class="pre">algoQueVerCon</span></code> que nos permite contabilizar cuantos bonos tienen el país «España».</p></li>
<li><p>Al analizar la DTD, se ha encontrado que la ciudad de procedencia de un elemento <code class="docutils literal notranslate"><span class="pre">futuro</span></code> puede ser Madrid.</p></li>
<li><p>Al analizar la DTD también se ha encontrado que elemento <code class="docutils literal notranslate"><span class="pre">pais_emisor</span></code> de un elemento <code class="docutils literal notranslate"><span class="pre">letra</span></code> puede ser <code class="docutils literal notranslate"><span class="pre">espania</span></code></p></li>
<li><p>Al analizar las divisas se debe comprobar si el elemento <code class="docutils literal notranslate"><span class="pre">ciudad_procedencia</span></code> es el elemento <code class="docutils literal notranslate"><span class="pre">madrid</span></code></p></li>
</ul>
</div>
<div class="section" id="diseno">
<h4>Diseño<a class="headerlink" href="#diseno" title="Enlazar permanentemente con este título">¶</a></h4>
<p>Crearemos dos métodos extra, uno para calcular la solución para el segundo punto (ver cuantos elementos <code class="docutils literal notranslate"><span class="pre">futuro</span></code> tienen como <code class="docutils literal notranslate"><span class="pre">ciudad_procedencia</span></code> el valor Madrid y otro método para el tercer punto.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kt">int</span> <span class="nf">cuantosFuturosTienenCiudadProcedencia</span><span class="o">(</span>
                <span class="n">Node</span> <span class="n">raiz</span><span class="o">,</span> <span class="n">String</span> <span class="n">ciudad</span><span class="o">)</span>
<span class="o">{</span>
        <span class="kt">int</span> <span class="n">cuantos</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span>
        <span class="n">Element</span> <span class="n">nodoRaiz</span><span class="o">=(</span><span class="n">Element</span><span class="o">)</span> <span class="n">raiz</span><span class="o">;</span>
        <span class="n">NodeList</span> <span class="n">lista</span><span class="o">=</span><span class="n">nodoRaiz</span><span class="o">.</span><span class="na">getElementsByTagName</span><span class="o">(</span><span class="s">&quot;futuro&quot;</span><span class="o">);</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">lista</span><span class="o">.</span><span class="na">getLength</span><span class="o">();</span> <span class="n">i</span><span class="o">++){</span>
                <span class="n">Element</span> <span class="n">e</span><span class="o">=(</span><span class="n">Element</span><span class="o">)</span><span class="n">lista</span><span class="o">.</span><span class="na">item</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
                <span class="n">NodeList</span> <span class="n">listaHijos</span><span class="o">=</span><span class="n">e</span><span class="o">.</span><span class="na">getChildNodes</span><span class="o">();</span>
                <span class="c1">//El elemento ciudad procedencia es el quinto hijo</span>
                <span class="n">Node</span> <span class="n">nodoCiudad</span><span class="o">=</span><span class="n">listaHijos</span><span class="o">.</span><span class="na">item</span><span class="o">(</span><span class="mi">5</span><span class="o">);</span>
                <span class="n">NodeList</span> <span class="n">hijosCiudad</span><span class="o">=</span><span class="n">nodoCiudad</span><span class="o">.</span><span class="na">getChildNodes</span><span class="o">();</span>
                <span class="n">Node</span> <span class="n">nodoElemCiudad</span><span class="o">=</span><span class="n">hijosCiudad</span><span class="o">.</span><span class="na">item</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
                <span class="n">String</span> <span class="n">nombreCiudad</span><span class="o">=</span><span class="n">nodoElemCiudad</span><span class="o">.</span><span class="na">getNodeName</span><span class="o">();</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">nombreCiudad</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">ciudad</span><span class="o">)){</span>
                        <span class="n">cuantos</span><span class="o">++;</span>
                <span class="o">}</span> <span class="c1">//Fin del if</span>
        <span class="o">}</span> <span class="c1">//Fin del for</span>
        <span class="k">return</span> <span class="n">cuantos</span><span class="o">;</span>
<span class="o">}</span>
</pre></div>
</div>
<p>Para resolver el último punto nos bastaría un método como este:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kt">int</span> <span class="nf">letrasConPaisEmisor</span><span class="o">(</span><span class="n">Node</span> <span class="n">raiz</span><span class="o">,</span> <span class="n">String</span> <span class="n">nombrePais</span><span class="o">){</span>
        <span class="kt">int</span> <span class="n">cuantos</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span>
        <span class="n">Element</span> <span class="n">eRaiz</span><span class="o">=(</span><span class="n">Element</span><span class="o">)</span> <span class="n">raiz</span><span class="o">;</span>
        <span class="n">NodeList</span> <span class="n">listaLetras</span><span class="o">=</span><span class="n">eRaiz</span><span class="o">.</span><span class="na">getElementsByTagName</span><span class="o">(</span><span class="s">&quot;letra&quot;</span><span class="o">);</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">listaLetras</span><span class="o">.</span><span class="na">getLength</span><span class="o">();</span><span class="n">i</span><span class="o">++){</span>
                <span class="n">Node</span> <span class="n">nodo</span><span class="o">=</span><span class="n">listaLetras</span><span class="o">.</span><span class="na">item</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
                <span class="n">Element</span> <span class="n">eNodo</span><span class="o">=(</span><span class="n">Element</span><span class="o">)</span> <span class="n">nodo</span><span class="o">;</span> <span class="c1">//Devuelve elemento letra</span>
                <span class="n">NodeList</span> <span class="n">hijosLetra</span><span class="o">=</span><span class="n">eNodo</span><span class="o">.</span><span class="na">getChildNodes</span><span class="o">();</span>
                <span class="n">Node</span> <span class="n">nodoPaisEmisor</span><span class="o">=</span><span class="n">hijosLetra</span><span class="o">.</span><span class="na">item</span><span class="o">(</span><span class="mi">3</span><span class="o">);</span>
                <span class="n">NodeList</span> <span class="n">hijosPais</span><span class="o">=</span><span class="n">nodoPaisEmisor</span><span class="o">.</span><span class="na">getChildNodes</span><span class="o">();</span>
                <span class="n">Node</span> <span class="n">nodoPais</span><span class="o">=</span><span class="n">hijosPais</span><span class="o">.</span><span class="na">item</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
                <span class="n">String</span> <span class="n">nombreNodoPais</span><span class="o">=</span><span class="n">nodoPais</span><span class="o">.</span><span class="na">getNodeName</span><span class="o">();</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">nombreNodoPais</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">nombrePais</span><span class="o">)){</span>
                        <span class="n">cuantos</span><span class="o">++;</span>
                <span class="o">}</span>
        <span class="o">}</span> <span class="c1">//Fin del for</span>
        <span class="k">return</span> <span class="n">cuantos</span><span class="o">;</span>
<span class="o">}</span>
</pre></div>
</div>
<p>Ahora el método que resuelve este ejercicio es tan simple como esto:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kt">int</span> <span class="nf">algoQueVerConEspania</span><span class="o">(</span><span class="n">Node</span> <span class="n">raiz</span><span class="o">){</span>
        <span class="kt">int</span> <span class="n">cuantasLetras</span><span class="o">=</span><span class="k">this</span><span class="o">.</span><span class="na">letrasConPaisEmisor</span><span class="o">(</span><span class="n">raiz</span><span class="o">,</span> <span class="s">&quot;espania&quot;</span><span class="o">);</span>
        <span class="kt">int</span> <span class="n">cuantosFuturos</span><span class="o">=</span><span class="k">this</span><span class="o">.</span><span class="na">cuantosFuturosTienenCiudadProcedencia</span><span class="o">(</span><span class="n">raiz</span><span class="o">,</span>
                        <span class="s">&quot;madrid&quot;</span><span class="o">);</span>
        <span class="kt">int</span> <span class="n">cuantosBonos</span><span class="o">=</span><span class="k">this</span><span class="o">.</span><span class="na">algoQueVerCon</span><span class="o">(</span><span class="n">raiz</span><span class="o">,</span> <span class="s">&quot;España&quot;</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">cuantasLetras</span><span class="o">+</span><span class="n">cuantosFuturos</span><span class="o">+</span><span class="n">cuantosBonos</span><span class="o">;</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id9">
<h3>Ejercicio<a class="headerlink" href="#id9" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Crear un programa que indique el país de procedencia de todos aquellos bonos en los que el precio deseado tenga un valor comprendido entre el precio mínimo y el máximo.</p>
<p>Una posible solución sería esta:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kt">void</span> <span class="nf">imprimirBonos</span><span class="o">(</span><span class="n">Node</span> <span class="n">raiz</span><span class="o">){</span>

        <span class="n">Element</span> <span class="n">eRaiz</span><span class="o">=(</span><span class="n">Element</span><span class="o">)</span> <span class="n">raiz</span><span class="o">;</span>
        <span class="n">NodeList</span> <span class="n">listaBonos</span><span class="o">=</span><span class="n">eRaiz</span><span class="o">.</span><span class="na">getElementsByTagName</span><span class="o">(</span><span class="s">&quot;bono&quot;</span><span class="o">);</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">listaBonos</span><span class="o">.</span><span class="na">getLength</span><span class="o">();</span> <span class="n">i</span><span class="o">++){</span>
                <span class="n">Node</span> <span class="n">bono</span><span class="o">=</span><span class="n">listaBonos</span><span class="o">.</span><span class="na">item</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
                <span class="n">Element</span> <span class="n">eBono</span><span class="o">=(</span><span class="n">Element</span><span class="o">)</span> <span class="n">bono</span><span class="o">;</span>
                <span class="c1">// Element eBono=(Element) listaBonos.item(i);</span>
                <span class="n">NodeList</span> <span class="n">listaParaValorDeseado</span><span class="o">=</span>
                                <span class="n">eBono</span><span class="o">.</span><span class="na">getElementsByTagName</span><span class="o">(</span><span class="s">&quot;valor_deseado&quot;</span><span class="o">);</span>
                <span class="n">NodeList</span> <span class="n">listaParaValorMinimo</span><span class="o">=</span>
                                <span class="n">eBono</span><span class="o">.</span><span class="na">getElementsByTagName</span><span class="o">(</span><span class="s">&quot;valor_minimo&quot;</span><span class="o">);</span>
                <span class="n">NodeList</span> <span class="n">listaParaValorMaximo</span><span class="o">=</span>
                                <span class="n">eBono</span><span class="o">.</span><span class="na">getElementsByTagName</span><span class="o">(</span><span class="s">&quot;valor_maximo&quot;</span><span class="o">);</span>
                <span class="n">Node</span> <span class="n">nodoValorDeseado</span><span class="o">=</span><span class="n">listaParaValorDeseado</span><span class="o">.</span><span class="na">item</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
                <span class="n">Node</span> <span class="n">nodoValorMinimo</span><span class="o">=</span><span class="n">listaParaValorMinimo</span><span class="o">.</span><span class="na">item</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
                <span class="n">Node</span> <span class="n">nodoValorMaximo</span><span class="o">=</span><span class="n">listaParaValorMaximo</span><span class="o">.</span><span class="na">item</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>

                <span class="n">Element</span> <span class="n">eValorDeseado</span><span class="o">=(</span><span class="n">Element</span><span class="o">)</span> <span class="n">nodoValorDeseado</span><span class="o">;</span>
                <span class="n">Element</span> <span class="n">eValorMinimo</span><span class="o">=(</span><span class="n">Element</span><span class="o">)</span> <span class="n">nodoValorMinimo</span><span class="o">;</span>
                <span class="n">Element</span> <span class="n">eValorMaximo</span><span class="o">=(</span><span class="n">Element</span><span class="o">)</span> <span class="n">nodoValorMaximo</span><span class="o">;</span>

                <span class="n">String</span> <span class="n">cadValorDeseado</span><span class="o">=</span><span class="n">eValorDeseado</span><span class="o">.</span><span class="na">getTextContent</span><span class="o">();</span>
                <span class="n">String</span> <span class="n">cadValorMinimo</span><span class="o">=</span><span class="n">eValorMinimo</span><span class="o">.</span><span class="na">getTextContent</span><span class="o">();</span>
                <span class="n">String</span> <span class="n">cadValorMaximo</span><span class="o">=</span><span class="n">eValorMaximo</span><span class="o">.</span><span class="na">getTextContent</span><span class="o">();</span>

                <span class="kt">int</span> <span class="n">valorDeseado</span><span class="o">=</span><span class="n">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">cadValorDeseado</span><span class="o">);</span>
                <span class="kt">int</span> <span class="n">valorMinimo</span><span class="o">=</span><span class="n">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">cadValorMinimo</span><span class="o">);</span>
                <span class="kt">int</span> <span class="n">valorMaximo</span><span class="o">=</span><span class="n">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">cadValorMaximo</span><span class="o">);</span>

                <span class="k">if</span> <span class="o">((</span><span class="n">valorDeseado</span><span class="o">&gt;</span><span class="n">valorMinimo</span><span class="o">)</span> <span class="o">&amp;&amp;</span>
                        <span class="o">(</span><span class="n">valorDeseado</span><span class="o">&lt;</span><span class="n">valorMaximo</span><span class="o">)</span> <span class="o">){</span>
                        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Encontrado un bono!&quot;</span><span class="o">);</span>
                <span class="o">}</span>
                <span class="c1">//Element eValorDeseado=(Element)</span>
                <span class="c1">//              listaParaValorDeseado.item(0);</span>

        <span class="o">}</span>

<span class="o">}</span>
</pre></div>
</div>
<p>Una solución mejor sería esta:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kt">int</span> <span class="nf">extraerHijoNumero</span> <span class="o">(</span><span class="n">Element</span> <span class="n">padre</span><span class="o">,</span>
                <span class="n">String</span> <span class="n">nombreHijo</span><span class="o">){</span>
        <span class="kt">int</span> <span class="n">valor</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span>
        <span class="c1">//Esta lista tiene solo un elemento</span>
        <span class="n">NodeList</span> <span class="n">listaHijos</span><span class="o">=</span>
                        <span class="n">padre</span><span class="o">.</span><span class="na">getElementsByTagName</span><span class="o">(</span><span class="n">nombreHijo</span><span class="o">);</span>
        <span class="n">Element</span> <span class="n">hijoNumerico</span><span class="o">=(</span><span class="n">Element</span><span class="o">)</span> <span class="n">listaHijos</span><span class="o">.</span><span class="na">item</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
        <span class="n">String</span> <span class="n">contenidoTextual</span><span class="o">=</span><span class="n">hijoNumerico</span><span class="o">.</span><span class="na">getTextContent</span><span class="o">();</span>
        <span class="n">valor</span><span class="o">=</span><span class="n">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">contenidoTextual</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">valor</span><span class="o">;</span>
<span class="o">}</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">imprimirBonos</span><span class="o">(</span><span class="n">Node</span> <span class="n">raiz</span><span class="o">){</span>

        <span class="n">Element</span> <span class="n">eRaiz</span><span class="o">=(</span><span class="n">Element</span><span class="o">)</span> <span class="n">raiz</span><span class="o">;</span>
        <span class="n">NodeList</span> <span class="n">listaBonos</span><span class="o">=</span><span class="n">eRaiz</span><span class="o">.</span><span class="na">getElementsByTagName</span><span class="o">(</span><span class="s">&quot;bono&quot;</span><span class="o">);</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">listaBonos</span><span class="o">.</span><span class="na">getLength</span><span class="o">();</span> <span class="n">i</span><span class="o">++){</span>
                <span class="n">Node</span> <span class="n">bono</span><span class="o">=</span><span class="n">listaBonos</span><span class="o">.</span><span class="na">item</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
                <span class="n">Element</span> <span class="n">eBono</span><span class="o">=(</span><span class="n">Element</span><span class="o">)</span> <span class="n">listaBonos</span><span class="o">.</span><span class="na">item</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>

                <span class="kt">int</span> <span class="n">valorDeseado</span><span class="o">=</span><span class="k">this</span><span class="o">.</span><span class="na">extraerHijoNumero</span><span class="o">(</span>
                                <span class="n">eBono</span><span class="o">,</span> <span class="s">&quot;valor_deseado&quot;</span><span class="o">);</span>
                <span class="kt">int</span> <span class="n">valorMinimo</span><span class="o">=</span><span class="k">this</span><span class="o">.</span><span class="na">extraerHijoNumero</span><span class="o">(</span>
                                <span class="n">eBono</span><span class="o">,</span> <span class="s">&quot;valor_minimo&quot;</span><span class="o">);</span>
                <span class="kt">int</span> <span class="n">valorMaximo</span><span class="o">=</span><span class="k">this</span><span class="o">.</span><span class="na">extraerHijoNumero</span><span class="o">(</span>
                                <span class="n">eBono</span><span class="o">,</span> <span class="s">&quot;valor_maximo&quot;</span><span class="o">);</span>

                <span class="k">if</span> <span class="o">((</span><span class="n">valorDeseado</span><span class="o">&gt;</span><span class="n">valorMinimo</span><span class="o">)</span> <span class="o">&amp;&amp;</span>
                        <span class="o">(</span><span class="n">valorDeseado</span><span class="o">&lt;</span><span class="n">valorMaximo</span><span class="o">)</span> <span class="o">){</span>
                        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Encontrado un bono!&quot;</span><span class="o">);</span>
                <span class="o">}</span>
                <span class="c1">//Element eValorDeseado=(Element)</span>
                <span class="c1">//              listaParaValorDeseado.item(0);</span>

        <span class="o">}</span>

<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="id10">
<h3>Ejercicio<a class="headerlink" href="#id10" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Imprimir, los productos financieros con la misma ciudad de procedencia.</p>
<div class="section" id="id11">
<h4>Análisis<a class="headerlink" href="#id11" title="Enlazar permanentemente con este título">¶</a></h4>
<p>En general, todos los problemas donde nos piden algo como <em>comprobar todos los elementos que tengan las mismas características</em> implican hacer una comprobación de <em>todos con todos</em>.</p>
</div>
<div class="section" id="id12">
<h4>Diseño<a class="headerlink" href="#id12" title="Enlazar permanentemente con este título">¶</a></h4>
<p>Todos los elementos tienen un elemento <code class="docutils literal notranslate"><span class="pre">ciudad_de_procedencia</span></code>, por lo cual, probablemente sea útil crear algún pequeño método de utilidad que dado un elemento nos devuelva un string con la ciudad de procedencia.</p>
<p>Por otro lado, comparar <em>todos con todos</em> suele implicar un doble bucle, donde el primer irá extrayendo elementos y el otro irá extrayendo todos los demás.</p>
</div>
<div class="section" id="implementacion">
<h4>Implementación<a class="headerlink" href="#implementacion" title="Enlazar permanentemente con este título">¶</a></h4>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="n">String</span> <span class="nf">getCiudadProcedencia</span><span class="o">(</span><span class="n">Element</span> <span class="n">e</span><span class="o">){</span>
        <span class="n">NodeList</span> <span class="n">listaHijos</span><span class="o">=</span>
                        <span class="n">e</span><span class="o">.</span><span class="na">getElementsByTagName</span><span class="o">(</span><span class="s">&quot;ciudad_procedencia&quot;</span><span class="o">);</span>
        <span class="n">Element</span> <span class="n">eCiudad</span><span class="o">=(</span><span class="n">Element</span><span class="o">)</span> <span class="n">listaHijos</span><span class="o">.</span><span class="na">item</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
        <span class="n">NodeList</span> <span class="n">listaHijosCiudad</span><span class="o">=</span><span class="n">eCiudad</span><span class="o">.</span><span class="na">getChildNodes</span><span class="o">();</span>
        <span class="n">Element</span> <span class="n">eCiudadConcreto</span><span class="o">=</span>
                        <span class="o">(</span><span class="n">Element</span><span class="o">)</span> <span class="n">listaHijosCiudad</span><span class="o">.</span><span class="na">item</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
        <span class="n">String</span> <span class="n">nombre</span><span class="o">=</span><span class="n">eCiudadConcreto</span><span class="o">.</span><span class="na">getNodeName</span><span class="o">();</span>
        <span class="k">return</span> <span class="n">nombre</span><span class="o">;</span>
<span class="o">}</span>
</pre></div>
</div>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kt">void</span> <span class="nf">imprimirMismaCiudad</span><span class="o">(</span><span class="n">Node</span> <span class="n">raiz</span><span class="o">){</span>
        <span class="n">NodeList</span> <span class="n">hijos</span><span class="o">=</span><span class="n">raiz</span><span class="o">.</span><span class="na">getChildNodes</span><span class="o">();</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">hijos</span><span class="o">.</span><span class="na">getLength</span><span class="o">();</span> <span class="n">i</span><span class="o">++){</span>
                <span class="n">Node</span> <span class="n">hijo</span><span class="o">=</span><span class="n">hijos</span><span class="o">.</span><span class="na">item</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">hijo</span><span class="o">.</span><span class="na">getNodeType</span><span class="o">()!=</span><span class="n">Node</span><span class="o">.</span><span class="na">ELEMENT_NODE</span><span class="o">){</span>
                        <span class="k">continue</span><span class="o">;</span>
                <span class="o">}</span>
                <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">j</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span> <span class="n">j</span><span class="o">&lt;</span><span class="n">hijos</span><span class="o">.</span><span class="na">getLength</span><span class="o">();</span> <span class="n">j</span><span class="o">++){</span>
                        <span class="n">Node</span> <span class="n">otroHijo</span><span class="o">=</span><span class="n">hijos</span><span class="o">.</span><span class="na">item</span><span class="o">(</span><span class="n">j</span><span class="o">);</span>
                        <span class="k">if</span> <span class="o">(</span><span class="n">otroHijo</span><span class="o">.</span><span class="na">getNodeType</span><span class="o">()!=</span><span class="n">Node</span><span class="o">.</span><span class="na">ELEMENT_NODE</span><span class="o">){</span>
                                <span class="k">continue</span><span class="o">;</span>
                        <span class="o">}</span>
                        <span class="n">String</span> <span class="n">ciudadHijo</span><span class="o">=</span>
                                        <span class="k">this</span><span class="o">.</span><span class="na">getCiudadProcedencia</span><span class="o">((</span><span class="n">Element</span><span class="o">)</span><span class="n">hijo</span><span class="o">);</span>
                        <span class="n">String</span> <span class="n">ciudadOtro</span><span class="o">=</span>
                                        <span class="k">this</span><span class="o">.</span><span class="na">getCiudadProcedencia</span><span class="o">((</span><span class="n">Element</span><span class="o">)</span><span class="n">otroHijo</span><span class="o">);</span>
                        <span class="k">if</span> <span class="o">(</span><span class="n">ciudadHijo</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">ciudadOtro</span><span class="o">)){</span>
                                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span>
                                                <span class="s">&quot;Encontré dos elementos con la ciudad &quot;</span><span class="o">+</span><span class="n">ciudadHijo</span><span class="o">);</span>

                        <span class="o">}</span> <span class="c1">//Fin del if ciudadHijo</span>
                <span class="o">}</span> <span class="c1">//Fin del for interno</span>
        <span class="o">}</span> <span class="c1">//Fin del for externo</span>
<span class="o">}</span> <span class="c1">//Fin del método</span>

<span class="kd">public</span> <span class="kt">void</span> <span class="nf">imprimirMismaCiudad</span><span class="o">(</span><span class="n">Node</span> <span class="n">raiz</span><span class="o">){</span>
        <span class="n">NodeList</span> <span class="n">hijos</span><span class="o">=</span><span class="n">raiz</span><span class="o">.</span><span class="na">getChildNodes</span><span class="o">();</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">hijos</span><span class="o">.</span><span class="na">getLength</span><span class="o">();</span> <span class="n">i</span><span class="o">++){</span>
                <span class="n">Node</span> <span class="n">hijo</span><span class="o">=</span><span class="n">hijos</span><span class="o">.</span><span class="na">item</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">hijo</span><span class="o">.</span><span class="na">getNodeType</span><span class="o">()!=</span><span class="n">Node</span><span class="o">.</span><span class="na">ELEMENT_NODE</span><span class="o">){</span>
                        <span class="k">continue</span><span class="o">;</span>
                <span class="o">}</span>
                <span class="n">String</span> <span class="n">ciudadHijo</span><span class="o">=</span>
                                <span class="k">this</span><span class="o">.</span><span class="na">getCiudadProcedencia</span><span class="o">((</span><span class="n">Element</span><span class="o">)</span><span class="n">hijo</span><span class="o">);</span>
                <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">j</span><span class="o">=</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="o">;</span> <span class="n">j</span><span class="o">&lt;</span><span class="n">hijos</span><span class="o">.</span><span class="na">getLength</span><span class="o">();</span> <span class="n">j</span><span class="o">++){</span>
                        <span class="n">Node</span> <span class="n">otroHijo</span><span class="o">=</span><span class="n">hijos</span><span class="o">.</span><span class="na">item</span><span class="o">(</span><span class="n">j</span><span class="o">);</span>
                        <span class="k">if</span> <span class="o">(</span><span class="n">otroHijo</span><span class="o">.</span><span class="na">getNodeType</span><span class="o">()!=</span><span class="n">Node</span><span class="o">.</span><span class="na">ELEMENT_NODE</span><span class="o">){</span>
                                <span class="k">continue</span><span class="o">;</span>
                        <span class="o">}</span>

                        <span class="n">String</span> <span class="n">ciudadOtro</span><span class="o">=</span>
                                        <span class="k">this</span><span class="o">.</span><span class="na">getCiudadProcedencia</span><span class="o">((</span><span class="n">Element</span><span class="o">)</span><span class="n">otroHijo</span><span class="o">);</span>
                        <span class="k">if</span> <span class="o">(</span><span class="n">ciudadHijo</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">ciudadOtro</span><span class="o">)){</span>
                                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span>
                                                <span class="s">&quot;Encontré dos elementos con la ciudad &quot;</span><span class="o">+</span><span class="n">ciudadHijo</span><span class="o">);</span>

                        <span class="o">}</span> <span class="c1">//Fin del if ciudadHijo</span>
                <span class="o">}</span> <span class="c1">//Fin del for interno</span>
        <span class="o">}</span> <span class="c1">//Fin del for externo</span>
<span class="o">}</span> <span class="c1">//Fin del método</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id13">
<h3>Ejercicio<a class="headerlink" href="#id13" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Contar cuantos productos que no sean estables tienen como ciudad de procedencia Tokio. Si hay más de 2, devolver los precios en un vector y si no devolver un vector vacío.</p>
<div class="section" id="id14">
<h4>Análisis<a class="headerlink" href="#id14" title="Enlazar permanentemente con este título">¶</a></h4>
<p>El atributo <code class="docutils literal notranslate"><span class="pre">estable</span></code>, solo lo tienen los productos <code class="docutils literal notranslate"><span class="pre">bono</span></code>. Ese atributo es optativo, puede que esté o puede que no. Si existe, debemos comprobar si tiene un «no».</p>
<p>Por otro lado, no sabemos a priori si habrá más de 2 o no.</p>
<ul class="simple">
<li><p>Podríamos hacer la cuenta, y si da más de 2 repetir operaciones y meter los bonos correctos en un vector.</p></li>
<li><p>Podríamos ir haciendo las operaciones y a la vez las inserciones en un vector y ahorrarnos operaciones.</p></li>
</ul>
<p>Optaremos por la segunda.</p>
</div>
<div class="section" id="id15">
<h4>Diseño<a class="headerlink" href="#id15" title="Enlazar permanentemente con este título">¶</a></h4>
<ul class="simple">
<li><p>Aprovecharemos los métodos que nos permiten extraer el elemento raíz de un fichero.</p></li>
<li><p>Necesitaremos crear vectores que tengan un cierto tamaño. Crearemos vectores muy grandes y los dejaremos con la inicialización que hace Java por defecto llenándolo con valores <code class="docutils literal notranslate"><span class="pre">null</span></code>.</p></li>
<li><p>Podemos aprovechar métodos ofrecidos por Java como <code class="docutils literal notranslate"><span class="pre">getElementsByTagName</span></code>.</p></li>
<li><p>Después recorreremos los elementos, comprobaremos si sus atributos cumplen las condiciones y si las cumplen almacenaremos en el vector a devolver la ciudad de ese bono.</p></li>
<li><p>Nuestro método devolverá siempre algo como String[], ese vector puede que vaya lleno o no.</p></li>
</ul>
</div>
<div class="section" id="solucion-1">
<h4>Solución 1<a class="headerlink" href="#solucion-1" title="Enlazar permanentemente con este título">¶</a></h4>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ProcesadorXML</span> <span class="o">{</span>
        <span class="kd">public</span> <span class="n">Element</span> <span class="nf">getRaiz</span><span class="o">(</span><span class="n">String</span> <span class="n">nombreFichero</span><span class="o">)</span>
                        <span class="kd">throws</span> <span class="n">ParserConfigurationException</span><span class="o">,</span> <span class="n">SAXException</span><span class="o">,</span> <span class="n">IOException</span><span class="o">{</span>
                <span class="n">DocumentBuilderFactory</span>
                        <span class="n">fabrica</span> <span class="o">=</span> <span class="n">DocumentBuilderFactory</span><span class="o">.</span><span class="na">newInstance</span><span class="o">();</span>
                <span class="n">DocumentBuilder</span> <span class="n">constructor</span><span class="o">=</span>
                                <span class="n">fabrica</span><span class="o">.</span><span class="na">newDocumentBuilder</span><span class="o">();</span>
                <span class="n">FileInputStream</span> <span class="n">fichero</span><span class="o">=</span>
                                <span class="k">new</span> <span class="n">FileInputStream</span><span class="o">(</span><span class="n">nombreFichero</span><span class="o">);</span>
                <span class="n">Document</span> <span class="n">documento</span><span class="o">=</span>
                                <span class="n">constructor</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="n">fichero</span><span class="o">);</span>
                <span class="n">Element</span> <span class="n">raiz</span><span class="o">=</span><span class="n">documento</span><span class="o">.</span><span class="na">getDocumentElement</span><span class="o">();</span>
                <span class="k">return</span> <span class="n">raiz</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="kd">public</span> <span class="kt">int</span><span class="o">[]</span> <span class="nf">getPreciosInestables</span><span class="o">()</span>
                        <span class="kd">throws</span> <span class="n">ParserConfigurationException</span><span class="o">,</span> <span class="n">SAXException</span><span class="o">,</span> <span class="n">IOException</span><span class="o">{</span>
                <span class="kt">int</span><span class="o">[]</span> <span class="n">vPrecios</span><span class="o">=</span><span class="kc">null</span><span class="o">;</span>
                <span class="kt">int</span> <span class="n">contador</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span>
                <span class="n">Element</span> <span class="n">raiz</span><span class="o">=</span>
                                <span class="n">getRaiz</span><span class="o">(</span><span class="s">&quot;d:/oscar/productos.xml&quot;</span><span class="o">);</span>
                <span class="n">Element</span> <span class="n">hijo</span><span class="o">=(</span><span class="n">Element</span><span class="o">)</span>
                                <span class="n">raiz</span><span class="o">.</span><span class="na">getFirstChild</span><span class="o">();</span>
                <span class="cm">/* Mientras le queden hijos a la raíz...*/</span>
                <span class="k">while</span> <span class="o">(</span><span class="n">hijo</span><span class="o">!=</span><span class="kc">null</span><span class="o">){</span>
                        <span class="n">String</span> <span class="n">atrEstable</span><span class="o">=</span>
                                        <span class="n">hijo</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&quot;estable&quot;</span><span class="o">);</span>
                        <span class="k">if</span> <span class="o">(</span><span class="n">atrEstable</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">&quot;no&quot;</span><span class="o">)){</span>
                                <span class="n">NodeList</span> <span class="n">vector</span><span class="o">=</span>
                                                <span class="n">hijo</span><span class="o">.</span><span class="na">getElementsByTagName</span><span class="o">(</span>
                                                        <span class="s">&quot;tokio&quot;</span><span class="o">);</span>
                                <span class="k">if</span> <span class="o">(</span><span class="n">vector</span><span class="o">.</span><span class="na">getLength</span><span class="o">()&gt;</span><span class="mi">0</span><span class="o">){</span>
                                        <span class="c1">//El producto sí es de Tokio</span>
                                        <span class="n">String</span> <span class="n">precio</span><span class="o">=</span>
                                                        <span class="n">hijo</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span>
                                                                        <span class="s">&quot;precio&quot;</span><span class="o">);</span>
                                        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Precio:&quot;</span><span class="o">+</span><span class="n">precio</span><span class="o">);</span>
                                <span class="o">}</span>
                        <span class="o">}</span>
                        <span class="n">Node</span> <span class="n">finLinea</span><span class="o">=</span><span class="n">hijo</span><span class="o">.</span><span class="na">getNextSibling</span><span class="o">();</span>
                        <span class="n">hijo</span><span class="o">=(</span><span class="n">Element</span><span class="o">)</span>
                                        <span class="n">finLinea</span><span class="o">.</span><span class="na">getNextSibling</span><span class="o">();</span>
                <span class="o">}</span>
                <span class="k">return</span> <span class="n">vPrecios</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span>
                        <span class="kd">throws</span> <span class="n">ParserConfigurationException</span><span class="o">,</span> <span class="n">SAXException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
                <span class="n">ProcesadorXML</span> <span class="n">procesador</span><span class="o">=</span>
                                <span class="k">new</span> <span class="n">ProcesadorXML</span><span class="o">();</span>
                <span class="kt">int</span><span class="o">[]</span> <span class="n">precios</span><span class="o">=</span>
                                <span class="n">procesador</span><span class="o">.</span><span class="na">getPreciosInestables</span><span class="o">();</span>
        <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="solucion-2">
<h4>Solución 2<a class="headerlink" href="#solucion-2" title="Enlazar permanentemente con este título">¶</a></h4>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="n">String</span><span class="o">[]</span> <span class="nf">obtenerListaBonos</span><span class="o">(</span><span class="n">Node</span> <span class="n">raiz</span><span class="o">){</span>
        <span class="kt">int</span> <span class="n">tamanioMaximo</span><span class="o">=</span><span class="mi">1000</span><span class="o">;</span>
        <span class="n">String</span><span class="o">[]</span> <span class="n">ciudades</span><span class="o">=</span><span class="k">new</span> <span class="n">String</span><span class="o">[</span><span class="n">tamanioMaximo</span><span class="o">];</span>
        <span class="n">String</span><span class="o">[]</span> <span class="n">aux</span><span class="o">=</span><span class="k">new</span> <span class="n">String</span><span class="o">[</span><span class="n">tamanioMaximo</span><span class="o">];</span>
        <span class="kt">int</span> <span class="n">posPrecio</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span>
        <span class="n">Element</span> <span class="n">eRaiz</span><span class="o">=(</span><span class="n">Element</span><span class="o">)</span> <span class="n">raiz</span><span class="o">;</span>
        <span class="n">NodeList</span> <span class="n">listaBonos</span><span class="o">=</span><span class="n">eRaiz</span><span class="o">.</span><span class="na">getElementsByTagName</span><span class="o">(</span><span class="s">&quot;bono&quot;</span><span class="o">);</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">listaBonos</span><span class="o">.</span><span class="na">getLength</span><span class="o">();</span> <span class="n">i</span><span class="o">++){</span>
                <span class="n">Element</span> <span class="n">bono</span><span class="o">=(</span><span class="n">Element</span><span class="o">)</span> <span class="n">listaBonos</span><span class="o">.</span><span class="na">item</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
                <span class="n">String</span> <span class="n">atEstable</span><span class="o">=</span><span class="n">bono</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&quot;estable&quot;</span><span class="o">);</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">atEstable</span><span class="o">!=</span><span class="kc">null</span><span class="o">){</span>
                        <span class="k">if</span> <span class="o">(</span><span class="n">atEstable</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">&quot;no&quot;</span><span class="o">)){</span>
                                <span class="c1">//Examinamos la ciudad aprovechando</span>
                                <span class="c1">//un método ya construido.</span>
                                <span class="n">String</span> <span class="n">ciudad</span><span class="o">=</span><span class="k">this</span><span class="o">.</span><span class="na">getCiudadProcedencia</span><span class="o">(</span><span class="n">bono</span><span class="o">);</span>
                                <span class="k">if</span> <span class="o">(</span><span class="n">ciudad</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">&quot;tokio&quot;</span><span class="o">)){</span>
                                        <span class="c1">//Si es de tokio, copiamos el precio</span>
                                        <span class="n">String</span> <span class="n">precio</span><span class="o">=</span><span class="n">bono</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&quot;precio&quot;</span><span class="o">);</span>
                                        <span class="n">aux</span><span class="o">[</span><span class="n">posPrecio</span><span class="o">]=</span><span class="n">precio</span><span class="o">;</span>
                                        <span class="n">posPrecio</span><span class="o">++;</span>
                                <span class="o">}</span> <span class="c1">//Fin del if para tokio</span>
                        <span class="o">}</span> <span class="c1">//Fin del if para el &quot;no&quot;</span>
                <span class="o">}</span> <span class="c1">//Fin del if para atEstable</span>
        <span class="o">}</span> <span class="c1">//Fin del for que recorre los bonos</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">posPrecio</span><span class="o">&gt;</span><span class="mi">2</span><span class="o">){</span>
                <span class="k">return</span> <span class="n">aux</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">ciudades</span><span class="o">;</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="anexo">
<h2>Anexo<a class="headerlink" href="#anexo" title="Enlazar permanentemente con este título">¶</a></h2>
<div class="section" id="codigo-java">
<h3>Código Java<a class="headerlink" href="#codigo-java" title="Enlazar permanentemente con este título">¶</a></h3>
<p>A continuación se muestra el código Java completo:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">com.ies</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.xml.parsers.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.xml.transform.Transformer</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.xml.transform.TransformerFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.xml.transform.dom.DOMSource</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.xml.transform.stream.StreamResult</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.File</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.w3c.dom.*</span><span class="o">;</span>



<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ProcesadorXML</span> <span class="o">{</span>
        <span class="kd">public</span> <span class="n">Node</span> <span class="nf">extraerRaiz</span><span class="o">(</span><span class="n">String</span> <span class="n">nombreArchivo</span><span class="o">){</span>
                <span class="n">DocumentBuilderFactory</span> <span class="n">fabrica</span><span class="o">;</span>
                <span class="n">DocumentBuilder</span> <span class="n">constructor</span><span class="o">;</span>
                <span class="n">Document</span> <span class="n">documentoXML</span><span class="o">=</span><span class="kc">null</span><span class="o">;</span>
                <span class="n">File</span> <span class="n">fichero</span><span class="o">=</span><span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="n">nombreArchivo</span><span class="o">);</span>
                <span class="n">fabrica</span><span class="o">=</span>
                        <span class="n">DocumentBuilderFactory</span><span class="o">.</span><span class="na">newInstance</span><span class="o">();</span>
                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Procesando &quot;</span><span class="o">+</span><span class="n">nombreArchivo</span><span class="o">);</span>
                <span class="k">try</span> <span class="o">{</span>
                        <span class="n">constructor</span><span class="o">=</span>
                          <span class="n">fabrica</span><span class="o">.</span><span class="na">newDocumentBuilder</span><span class="o">();</span>
                        <span class="n">documentoXML</span><span class="o">=</span><span class="n">constructor</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="n">fichero</span><span class="o">);</span>
                <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                        <span class="c1">// TODO Auto-generated catch block</span>
                        <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
                <span class="o">}</span>
                <span class="k">return</span> <span class="n">documentoXML</span><span class="o">.</span><span class="na">getDocumentElement</span><span class="o">();</span>

        <span class="o">}</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">imprimirNombreDeLaRaiz</span><span class="o">(</span><span class="n">Node</span> <span class="n">nodo</span><span class="o">){</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">nodo</span><span class="o">!=</span><span class="kc">null</span><span class="o">){</span>
                        <span class="n">String</span> <span class="n">nombre</span><span class="o">=</span><span class="n">nodo</span><span class="o">.</span><span class="na">getNodeName</span><span class="o">();</span>
                        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;La raíz se llama:&quot;</span><span class="o">+</span><span class="n">nombre</span><span class="o">);</span>
                        <span class="n">Node</span> <span class="n">primerHijo</span><span class="o">=</span><span class="n">nodo</span><span class="o">.</span><span class="na">getFirstChild</span><span class="o">();</span>
                        <span class="n">String</span> <span class="n">nombreHijo</span><span class="o">=</span><span class="n">primerHijo</span><span class="o">.</span><span class="na">getNodeName</span><span class="o">();</span>
                        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;El primer hijo se llama &lt;&quot;</span><span class="o">+</span><span class="n">nombreHijo</span><span class="o">+</span><span class="s">&quot;&gt;&quot;</span><span class="o">);</span>
                <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;No se pudo leer la raíz por ser nula&quot;</span><span class="o">);</span>
                <span class="o">}</span>
        <span class="o">}</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">imprimirHijos</span><span class="o">(</span><span class="n">Node</span> <span class="n">nodoRaiz</span><span class="o">){</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">nodoRaiz</span><span class="o">==</span><span class="kc">null</span><span class="o">){</span>
                        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Imposible procesar raiz null&quot;</span><span class="o">);</span>
                        <span class="k">return</span> <span class="o">;</span>
                <span class="o">}</span>
                <span class="n">Node</span> <span class="n">nodo</span><span class="o">=</span><span class="n">nodoRaiz</span><span class="o">.</span><span class="na">getFirstChild</span><span class="o">();</span>
                <span class="k">while</span> <span class="o">(</span><span class="n">nodo</span><span class="o">!=</span><span class="kc">null</span><span class="o">){</span>
                        <span class="kt">short</span> <span class="n">tipo</span><span class="o">=</span><span class="n">nodo</span><span class="o">.</span><span class="na">getNodeType</span><span class="o">();</span>
                        <span class="k">if</span> <span class="o">(</span><span class="n">tipo</span><span class="o">==</span><span class="n">nodo</span><span class="o">.</span><span class="na">ELEMENT_NODE</span><span class="o">){</span>
                                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Nodo hijo:&quot;</span><span class="o">+</span><span class="n">nodo</span><span class="o">.</span><span class="na">getNodeName</span><span class="o">());</span>
                        <span class="o">}</span>
                        <span class="n">nodo</span><span class="o">=</span><span class="n">nodo</span><span class="o">.</span><span class="na">getNextSibling</span><span class="o">();</span>
                <span class="o">}</span>
        <span class="o">}</span>

        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">imprimirHijos2</span><span class="o">(</span><span class="n">Node</span> <span class="n">nodoRaiz</span><span class="o">){</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">nodoRaiz</span><span class="o">==</span><span class="kc">null</span><span class="o">){</span>
                        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Imposible procesar raíz nula&quot;</span><span class="o">);</span>
                        <span class="k">return</span><span class="o">;</span>
                <span class="o">}</span> <span class="c1">//Fin del if null</span>
                <span class="n">NodeList</span> <span class="n">lista</span><span class="o">=</span><span class="n">nodoRaiz</span><span class="o">.</span><span class="na">getChildNodes</span><span class="o">();</span>
                <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">lista</span><span class="o">.</span><span class="na">getLength</span><span class="o">();</span><span class="n">i</span><span class="o">++){</span>
                        <span class="n">Node</span> <span class="n">nodo</span><span class="o">=</span><span class="n">lista</span><span class="o">.</span><span class="na">item</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
                        <span class="kt">short</span> <span class="n">tipo</span><span class="o">=</span><span class="n">nodo</span><span class="o">.</span><span class="na">getNodeType</span><span class="o">();</span>
                        <span class="k">if</span> <span class="o">(</span><span class="n">tipo</span><span class="o">==</span><span class="n">Node</span><span class="o">.</span><span class="na">ELEMENT_NODE</span><span class="o">){</span>
                                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Hijo:&quot;</span><span class="o">+</span><span class="n">nodo</span><span class="o">.</span><span class="na">getNodeName</span><span class="o">());</span>
                        <span class="o">}</span> <span class="c1">//Fin del if</span>
                <span class="o">}</span> <span class="c1">//Fin del for</span>
        <span class="o">}</span> <span class="c1">//Fin del método</span>

        <span class="kd">public</span> <span class="kt">int</span> <span class="nf">contadorElementos</span><span class="o">(</span><span class="n">Node</span> <span class="n">raiz</span><span class="o">,</span><span class="n">String</span> <span class="n">nombreElemento</span><span class="o">){</span>
                <span class="kt">int</span> <span class="n">contador</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span>
                <span class="n">NodeList</span> <span class="n">nodosHijo</span><span class="o">=</span><span class="n">raiz</span><span class="o">.</span><span class="na">getChildNodes</span><span class="o">();</span>
                <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">nodosHijo</span><span class="o">.</span><span class="na">getLength</span><span class="o">();</span><span class="n">i</span><span class="o">++){</span>
                        <span class="n">Node</span> <span class="n">nodo</span><span class="o">=</span><span class="n">nodosHijo</span><span class="o">.</span><span class="na">item</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
                        <span class="kt">short</span> <span class="n">tipo</span><span class="o">=</span><span class="n">nodo</span><span class="o">.</span><span class="na">getNodeType</span><span class="o">();</span>
                        <span class="k">if</span> <span class="o">(</span><span class="n">tipo</span><span class="o">==</span><span class="n">Node</span><span class="o">.</span><span class="na">ELEMENT_NODE</span><span class="o">){</span>
                                <span class="n">String</span> <span class="n">nombre</span><span class="o">=</span><span class="n">nodo</span><span class="o">.</span><span class="na">getNodeName</span><span class="o">();</span>
                                <span class="k">if</span> <span class="o">(</span><span class="n">nombre</span><span class="o">==</span><span class="n">nombreElemento</span><span class="o">){</span>
                                        <span class="n">contador</span><span class="o">++;</span>
                                <span class="o">}</span> <span class="c1">//Fin del if interno</span>
                        <span class="o">}</span> <span class="c1">//Fin del if externo</span>
                <span class="o">}</span> <span class="c1">//Fin del for</span>
                <span class="k">return</span> <span class="n">contador</span><span class="o">;</span>
        <span class="o">}</span> <span class="c1">//Fin del método</span>
        <span class="kd">private</span> <span class="kt">void</span> <span class="nf">comprobarSiEsBono</span><span class="o">(</span><span class="n">Node</span> <span class="n">n</span><span class="o">){</span>
                <span class="n">String</span> <span class="n">nombre</span><span class="o">=</span><span class="n">n</span><span class="o">.</span><span class="na">getNodeName</span><span class="o">();</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">nombre</span><span class="o">==</span><span class="s">&quot;bono&quot;</span><span class="o">){</span>
                        <span class="n">Element</span> <span class="n">e</span><span class="o">=(</span><span class="n">Element</span><span class="o">)</span> <span class="n">n</span><span class="o">;</span>
                        <span class="n">String</span> <span class="n">precio</span><span class="o">=</span><span class="n">e</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&quot;precio&quot;</span><span class="o">);</span>
                        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Precio:&quot;</span><span class="o">+</span><span class="n">precio</span><span class="o">);</span>
                <span class="o">}</span>
        <span class="o">}</span>

        <span class="kd">public</span> <span class="kt">int</span> <span class="nf">cuantosInestables</span> <span class="o">(</span><span class="n">Node</span> <span class="n">raiz</span><span class="o">){</span>
                <span class="kt">int</span> <span class="n">cuantos</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span>
                <span class="n">NodeList</span> <span class="n">lista</span><span class="o">=</span><span class="n">raiz</span><span class="o">.</span><span class="na">getChildNodes</span><span class="o">();</span>
                <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">lista</span><span class="o">.</span><span class="na">getLength</span><span class="o">();</span> <span class="n">i</span><span class="o">++){</span>
                        <span class="n">Node</span> <span class="n">n</span><span class="o">=</span><span class="n">lista</span><span class="o">.</span><span class="na">item</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
                        <span class="k">if</span> <span class="o">(</span><span class="n">n</span><span class="o">.</span><span class="na">getNodeType</span><span class="o">()!=</span><span class="n">Node</span><span class="o">.</span><span class="na">ELEMENT_NODE</span><span class="o">)</span> <span class="k">continue</span><span class="o">;</span>
                        <span class="n">Element</span> <span class="n">e</span><span class="o">=(</span><span class="n">Element</span><span class="o">)</span> <span class="n">lista</span><span class="o">.</span><span class="na">item</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
                        <span class="k">if</span> <span class="o">(</span><span class="n">e</span><span class="o">.</span><span class="na">getNodeName</span><span class="o">()==</span><span class="s">&quot;divisa&quot;</span> <span class="o">||</span>
                                        <span class="n">e</span><span class="o">.</span><span class="na">getNodeName</span><span class="o">()==</span><span class="s">&quot;bono&quot;</span><span class="o">){</span>
                                <span class="n">String</span> <span class="n">atEstable</span><span class="o">=</span><span class="n">e</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&quot;estable&quot;</span><span class="o">);</span>
                                <span class="k">if</span> <span class="o">(</span><span class="n">atEstable</span><span class="o">!=</span><span class="kc">null</span><span class="o">){</span>
                                        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Atributo:&quot;</span><span class="o">+</span><span class="n">atEstable</span><span class="o">);</span>
                                        <span class="k">if</span> <span class="o">(</span><span class="n">atEstable</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">&quot;no&quot;</span><span class="o">)){</span>
                                                <span class="n">cuantos</span><span class="o">+=</span><span class="mi">1</span><span class="o">;</span>
                                        <span class="o">}</span> <span class="c1">//Fin del if interno</span>
                                <span class="o">}</span> <span class="c1">//Fin del if atEstable</span>
                        <span class="o">}</span> <span class="c1">//Fin de if nodo es divisa o bono</span>
                <span class="o">}</span> <span class="c1">//Fin del for que recorre los nodos</span>
                <span class="k">return</span> <span class="n">cuantos</span><span class="o">;</span>
        <span class="o">}</span> <span class="c1">//Fin del método cuantosInestables</span>

        <span class="kd">public</span> <span class="kt">float</span> <span class="nf">sumarAtributosPrecio</span><span class="o">(</span><span class="n">Node</span> <span class="n">raiz</span><span class="o">){</span>
                <span class="kt">float</span> <span class="n">precioTotal</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span>
                <span class="n">NodeList</span> <span class="n">hijos</span><span class="o">=</span><span class="n">raiz</span><span class="o">.</span><span class="na">getChildNodes</span><span class="o">();</span>
                <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">hijos</span><span class="o">.</span><span class="na">getLength</span><span class="o">();</span> <span class="n">i</span><span class="o">++){</span>
                        <span class="n">Node</span> <span class="n">hijo</span><span class="o">=</span><span class="n">hijos</span><span class="o">.</span><span class="na">item</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
                        <span class="k">if</span> <span class="o">(</span><span class="n">hijo</span><span class="o">.</span><span class="na">getNodeType</span><span class="o">()!=</span><span class="n">Node</span><span class="o">.</span><span class="na">ELEMENT_NODE</span><span class="o">)</span> <span class="k">continue</span><span class="o">;</span>
                        <span class="n">Element</span> <span class="n">e</span><span class="o">=(</span><span class="n">Element</span><span class="o">)</span> <span class="n">hijo</span><span class="o">;</span>
                        <span class="n">String</span> <span class="n">precio</span><span class="o">=</span><span class="n">e</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&quot;precio&quot;</span><span class="o">);</span>
                        <span class="n">Float</span> <span class="n">f</span><span class="o">=</span><span class="n">Float</span><span class="o">.</span><span class="na">parseFloat</span><span class="o">(</span><span class="n">precio</span><span class="o">);</span>
                        <span class="n">precioTotal</span><span class="o">+=</span><span class="n">f</span><span class="o">;</span>
                <span class="o">}</span>
                <span class="k">return</span> <span class="n">precioTotal</span><span class="o">;</span>
        <span class="o">}</span> <span class="c1">//Fin del método sumarAtributosPrecio</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">imprimirPrecioBonos</span><span class="o">(</span><span class="n">Node</span> <span class="n">raiz</span><span class="o">){</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">raiz</span><span class="o">==</span><span class="kc">null</span><span class="o">){</span>
                        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Imposible procesar null&quot;</span><span class="o">);</span>
                        <span class="k">return</span><span class="o">;</span>
                <span class="o">}</span>
                <span class="n">NodeList</span> <span class="n">nodos</span><span class="o">=</span><span class="n">raiz</span><span class="o">.</span><span class="na">getChildNodes</span><span class="o">();</span>
                <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">nodos</span><span class="o">.</span><span class="na">getLength</span><span class="o">();</span> <span class="n">i</span><span class="o">++){</span>
                        <span class="n">Node</span> <span class="n">nodo</span><span class="o">=</span><span class="n">nodos</span><span class="o">.</span><span class="na">item</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
                        <span class="kt">short</span> <span class="n">tipo</span><span class="o">=</span><span class="n">nodo</span><span class="o">.</span><span class="na">getNodeType</span><span class="o">();</span>
                        <span class="k">if</span> <span class="o">(</span><span class="n">tipo</span><span class="o">==</span><span class="n">Node</span><span class="o">.</span><span class="na">ELEMENT_NODE</span><span class="o">){</span>
                                <span class="k">this</span><span class="o">.</span><span class="na">comprobarSiEsBono</span><span class="o">(</span><span class="n">nodo</span><span class="o">);</span>
                        <span class="o">}</span>
                <span class="o">}</span>
        <span class="o">}</span>
        <span class="cm">/**</span>
<span class="cm">         *</span>
<span class="cm">         * @param raiz</span>
<span class="cm">         * @param nombrePais</span>
<span class="cm">         * @return Numero de elementos dentro del nodo en</span>
<span class="cm">         * los cuales aparece de alguna forma el país</span>
<span class="cm">         */</span>
        <span class="kd">public</span> <span class="kt">int</span> <span class="nf">algoQueVerCon</span><span class="o">(</span><span class="n">Node</span> <span class="n">raiz</span><span class="o">,</span> <span class="n">String</span> <span class="n">nombrePais</span><span class="o">){</span>
                <span class="kt">int</span> <span class="n">cuantos</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span>
                <span class="n">Element</span> <span class="n">elementoRaiz</span><span class="o">=(</span><span class="n">Element</span><span class="o">)</span> <span class="n">raiz</span><span class="o">;</span>
                <span class="n">NodeList</span> <span class="n">lista</span><span class="o">=</span><span class="n">elementoRaiz</span><span class="o">.</span><span class="na">getElementsByTagName</span><span class="o">(</span><span class="s">&quot;bono&quot;</span><span class="o">);</span>
                <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">lista</span><span class="o">.</span><span class="na">getLength</span><span class="o">();</span> <span class="n">i</span><span class="o">++){</span>
                        <span class="n">Node</span> <span class="n">nodoBono</span><span class="o">=</span><span class="n">lista</span><span class="o">.</span><span class="na">item</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
                        <span class="n">Node</span> <span class="n">primerHijoTexto</span><span class="o">=</span><span class="n">nodoBono</span><span class="o">.</span><span class="na">getFirstChild</span><span class="o">();</span>
                        <span class="n">Node</span> <span class="n">segHijoPais</span><span class="o">=</span><span class="n">primerHijoTexto</span><span class="o">.</span><span class="na">getNextSibling</span><span class="o">();</span>
                        <span class="n">String</span> <span class="n">paisExtraido</span><span class="o">=</span><span class="n">segHijoPais</span><span class="o">.</span><span class="na">getTextContent</span><span class="o">();</span>
                        <span class="c1">//Limpiamos espacios</span>
                        <span class="n">paisExtraido</span><span class="o">=</span><span class="n">paisExtraido</span><span class="o">.</span><span class="na">trim</span><span class="o">();</span>
                        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Pais extraido:&quot;</span><span class="o">+</span><span class="n">paisExtraido</span><span class="o">);</span>
                        <span class="k">if</span> <span class="o">(</span><span class="n">paisExtraido</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">nombrePais</span><span class="o">)){</span>
                                <span class="n">cuantos</span><span class="o">++;</span>
                        <span class="o">}</span>
                <span class="o">}</span>
                <span class="k">return</span> <span class="n">cuantos</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="cm">/**</span>
<span class="cm">         * Este método averigua cuantos elementos futuro</span>
<span class="cm">         * tienen una cierta ciudad procedencia</span>
<span class="cm">         * @param argumentos</span>
<span class="cm">         */</span>
        <span class="kd">public</span> <span class="kt">int</span> <span class="nf">cuantosFuturosTienenCiudadProcedencia</span><span class="o">(</span>
                        <span class="n">Node</span> <span class="n">raiz</span><span class="o">,</span> <span class="n">String</span> <span class="n">ciudad</span>
                        <span class="o">)</span>
        <span class="o">{</span>
                <span class="kt">int</span> <span class="n">cuantos</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span>
                <span class="n">Element</span> <span class="n">nodoRaiz</span><span class="o">=(</span><span class="n">Element</span><span class="o">)</span> <span class="n">raiz</span><span class="o">;</span>
                <span class="n">NodeList</span> <span class="n">lista</span><span class="o">=</span><span class="n">nodoRaiz</span><span class="o">.</span><span class="na">getElementsByTagName</span><span class="o">(</span><span class="s">&quot;futuro&quot;</span><span class="o">);</span>
                <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">lista</span><span class="o">.</span><span class="na">getLength</span><span class="o">();</span> <span class="n">i</span><span class="o">++){</span>
                        <span class="n">Element</span> <span class="n">e</span><span class="o">=(</span><span class="n">Element</span><span class="o">)</span><span class="n">lista</span><span class="o">.</span><span class="na">item</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
                        <span class="n">NodeList</span> <span class="n">listaHijos</span><span class="o">=</span><span class="n">e</span><span class="o">.</span><span class="na">getChildNodes</span><span class="o">();</span>
                        <span class="c1">//El elemento ciudad procedencia es el quinto hijo</span>
                        <span class="n">Node</span> <span class="n">nodoCiudad</span><span class="o">=</span><span class="n">listaHijos</span><span class="o">.</span><span class="na">item</span><span class="o">(</span><span class="mi">5</span><span class="o">);</span>
                        <span class="n">NodeList</span> <span class="n">hijosCiudad</span><span class="o">=</span><span class="n">nodoCiudad</span><span class="o">.</span><span class="na">getChildNodes</span><span class="o">();</span>
                        <span class="n">Node</span> <span class="n">nodoElemCiudad</span><span class="o">=</span><span class="n">hijosCiudad</span><span class="o">.</span><span class="na">item</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
                        <span class="n">String</span> <span class="n">nombreCiudad</span><span class="o">=</span><span class="n">nodoElemCiudad</span><span class="o">.</span><span class="na">getNodeName</span><span class="o">();</span>
                        <span class="k">if</span> <span class="o">(</span><span class="n">nombreCiudad</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">ciudad</span><span class="o">)){</span>
                                <span class="n">cuantos</span><span class="o">++;</span>
                        <span class="o">}</span> <span class="c1">//Fin del if</span>
                <span class="o">}</span> <span class="c1">//Fin del for</span>
                <span class="k">return</span> <span class="n">cuantos</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="cm">/**</span>
<span class="cm">         *</span>
<span class="cm">         * @param raiz Raíz del documento</span>
<span class="cm">         * @param nombrePais (Debe ser &quot;espania&quot; para España)</span>
<span class="cm">         * @return</span>
<span class="cm">         */</span>
        <span class="kd">public</span> <span class="kt">int</span> <span class="nf">letrasConPaisEmisor</span><span class="o">(</span><span class="n">Node</span> <span class="n">raiz</span><span class="o">,</span> <span class="n">String</span> <span class="n">nombrePais</span><span class="o">){</span>
                <span class="kt">int</span> <span class="n">cuantos</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span>
                <span class="n">Element</span> <span class="n">eRaiz</span><span class="o">=(</span><span class="n">Element</span><span class="o">)</span> <span class="n">raiz</span><span class="o">;</span>
                <span class="n">NodeList</span> <span class="n">listaLetras</span><span class="o">=</span><span class="n">eRaiz</span><span class="o">.</span><span class="na">getElementsByTagName</span><span class="o">(</span><span class="s">&quot;letra&quot;</span><span class="o">);</span>
                <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">listaLetras</span><span class="o">.</span><span class="na">getLength</span><span class="o">();</span><span class="n">i</span><span class="o">++){</span>
                        <span class="n">Node</span> <span class="n">nodo</span><span class="o">=</span><span class="n">listaLetras</span><span class="o">.</span><span class="na">item</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
                        <span class="n">Element</span> <span class="n">eNodo</span><span class="o">=(</span><span class="n">Element</span><span class="o">)</span> <span class="n">nodo</span><span class="o">;</span> <span class="c1">//Devuelve elemento letra</span>
                        <span class="n">NodeList</span> <span class="n">hijosLetra</span><span class="o">=</span><span class="n">eNodo</span><span class="o">.</span><span class="na">getChildNodes</span><span class="o">();</span>
                        <span class="n">Node</span> <span class="n">nodoPaisEmisor</span><span class="o">=</span><span class="n">hijosLetra</span><span class="o">.</span><span class="na">item</span><span class="o">(</span><span class="mi">3</span><span class="o">);</span>
                        <span class="n">NodeList</span> <span class="n">hijosPais</span><span class="o">=</span><span class="n">nodoPaisEmisor</span><span class="o">.</span><span class="na">getChildNodes</span><span class="o">();</span>
                        <span class="n">Node</span> <span class="n">nodoPais</span><span class="o">=</span><span class="n">hijosPais</span><span class="o">.</span><span class="na">item</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
                        <span class="n">String</span> <span class="n">nombreNodoPais</span><span class="o">=</span><span class="n">nodoPais</span><span class="o">.</span><span class="na">getNodeName</span><span class="o">();</span>
                        <span class="k">if</span> <span class="o">(</span><span class="n">nombreNodoPais</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">nombrePais</span><span class="o">)){</span>
                                <span class="n">cuantos</span><span class="o">++;</span>
                        <span class="o">}</span>
                <span class="o">}</span> <span class="c1">//Fin del for</span>
                <span class="k">return</span> <span class="n">cuantos</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="kd">public</span> <span class="kt">int</span> <span class="nf">algoQueVerConEspania</span><span class="o">(</span><span class="n">Node</span> <span class="n">raiz</span><span class="o">){</span>
                <span class="kt">int</span> <span class="n">cuantasLetras</span><span class="o">=</span><span class="k">this</span><span class="o">.</span><span class="na">letrasConPaisEmisor</span><span class="o">(</span><span class="n">raiz</span><span class="o">,</span> <span class="s">&quot;espania&quot;</span><span class="o">);</span>
                <span class="kt">int</span> <span class="n">cuantosFuturos</span><span class="o">=</span><span class="k">this</span><span class="o">.</span><span class="na">cuantosFuturosTienenCiudadProcedencia</span><span class="o">(</span><span class="n">raiz</span><span class="o">,</span>
                                <span class="s">&quot;madrid&quot;</span><span class="o">);</span>
                <span class="kt">int</span> <span class="n">cuantosBonos</span><span class="o">=</span><span class="k">this</span><span class="o">.</span><span class="na">algoQueVerCon</span><span class="o">(</span><span class="n">raiz</span><span class="o">,</span> <span class="s">&quot;España&quot;</span><span class="o">);</span>
                <span class="k">return</span> <span class="n">cuantasLetras</span><span class="o">+</span><span class="n">cuantosFuturos</span><span class="o">+</span><span class="n">cuantosBonos</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="kd">public</span> <span class="kt">int</span> <span class="nf">extraerHijoNumero</span> <span class="o">(</span><span class="n">Element</span> <span class="n">padre</span><span class="o">,</span>
                        <span class="n">String</span> <span class="n">nombreHijo</span><span class="o">){</span>
                <span class="kt">int</span> <span class="n">valor</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span>
                <span class="c1">//Esta lista tiene solo un elemento</span>
                <span class="n">NodeList</span> <span class="n">listaHijos</span><span class="o">=</span>
                                <span class="n">padre</span><span class="o">.</span><span class="na">getElementsByTagName</span><span class="o">(</span><span class="n">nombreHijo</span><span class="o">);</span>
                <span class="n">Element</span> <span class="n">hijoNumerico</span><span class="o">=(</span><span class="n">Element</span><span class="o">)</span> <span class="n">listaHijos</span><span class="o">.</span><span class="na">item</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
                <span class="n">String</span> <span class="n">contenidoTextual</span><span class="o">=</span><span class="n">hijoNumerico</span><span class="o">.</span><span class="na">getTextContent</span><span class="o">();</span>
                <span class="n">valor</span><span class="o">=</span><span class="n">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">contenidoTextual</span><span class="o">);</span>
                <span class="k">return</span> <span class="n">valor</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">imprimirBonos</span><span class="o">(</span><span class="n">Node</span> <span class="n">raiz</span><span class="o">){</span>

                <span class="n">Element</span> <span class="n">eRaiz</span><span class="o">=(</span><span class="n">Element</span><span class="o">)</span> <span class="n">raiz</span><span class="o">;</span>
                <span class="n">NodeList</span> <span class="n">listaBonos</span><span class="o">=</span><span class="n">eRaiz</span><span class="o">.</span><span class="na">getElementsByTagName</span><span class="o">(</span><span class="s">&quot;bono&quot;</span><span class="o">);</span>
                <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">listaBonos</span><span class="o">.</span><span class="na">getLength</span><span class="o">();</span> <span class="n">i</span><span class="o">++){</span>
                        <span class="n">Node</span> <span class="n">bono</span><span class="o">=</span><span class="n">listaBonos</span><span class="o">.</span><span class="na">item</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
                        <span class="n">Element</span> <span class="n">eBono</span><span class="o">=(</span><span class="n">Element</span><span class="o">)</span> <span class="n">listaBonos</span><span class="o">.</span><span class="na">item</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>

                        <span class="kt">int</span> <span class="n">valorDeseado</span><span class="o">=</span><span class="k">this</span><span class="o">.</span><span class="na">extraerHijoNumero</span><span class="o">(</span>
                                        <span class="n">eBono</span><span class="o">,</span> <span class="s">&quot;valor_deseado&quot;</span><span class="o">);</span>
                        <span class="kt">int</span> <span class="n">valorMinimo</span><span class="o">=</span><span class="k">this</span><span class="o">.</span><span class="na">extraerHijoNumero</span><span class="o">(</span>
                                        <span class="n">eBono</span><span class="o">,</span> <span class="s">&quot;valor_minimo&quot;</span><span class="o">);</span>
                        <span class="kt">int</span> <span class="n">valorMaximo</span><span class="o">=</span><span class="k">this</span><span class="o">.</span><span class="na">extraerHijoNumero</span><span class="o">(</span>
                                        <span class="n">eBono</span><span class="o">,</span> <span class="s">&quot;valor_maximo&quot;</span><span class="o">);</span>

                        <span class="k">if</span> <span class="o">((</span><span class="n">valorDeseado</span><span class="o">&gt;</span><span class="n">valorMinimo</span><span class="o">)</span> <span class="o">&amp;&amp;</span>
                                <span class="o">(</span><span class="n">valorDeseado</span><span class="o">&lt;</span><span class="n">valorMaximo</span><span class="o">)</span> <span class="o">){</span>
                                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Encontrado un bono!&quot;</span><span class="o">);</span>
                                <span class="n">String</span> <span class="n">ciudad</span><span class="o">=</span><span class="k">this</span><span class="o">.</span><span class="na">getCiudadProcedencia</span><span class="o">(</span><span class="n">eBono</span><span class="o">);</span>
                                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Su ciudad era:&quot;</span><span class="o">+</span><span class="n">ciudad</span><span class="o">);</span>
                        <span class="o">}</span>
                        <span class="c1">//Element eValorDeseado=(Element)</span>
                        <span class="c1">//              listaParaValorDeseado.item(0);</span>

                <span class="o">}</span>

        <span class="o">}</span>
        <span class="kd">public</span> <span class="n">String</span> <span class="nf">getCiudadProcedencia</span><span class="o">(</span><span class="n">Element</span> <span class="n">e</span><span class="o">){</span>
                <span class="n">NodeList</span> <span class="n">listaHijos</span><span class="o">=</span>
                                <span class="n">e</span><span class="o">.</span><span class="na">getElementsByTagName</span><span class="o">(</span><span class="s">&quot;ciudad_procedencia&quot;</span><span class="o">);</span>
                <span class="n">Element</span> <span class="n">eCiudad</span><span class="o">=(</span><span class="n">Element</span><span class="o">)</span> <span class="n">listaHijos</span><span class="o">.</span><span class="na">item</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
                <span class="n">NodeList</span> <span class="n">listaHijosCiudad</span><span class="o">=</span><span class="n">eCiudad</span><span class="o">.</span><span class="na">getChildNodes</span><span class="o">();</span>
                <span class="n">Element</span> <span class="n">eCiudadConcreto</span><span class="o">=</span>
                                <span class="o">(</span><span class="n">Element</span><span class="o">)</span> <span class="n">listaHijosCiudad</span><span class="o">.</span><span class="na">item</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
                <span class="n">String</span> <span class="n">nombre</span><span class="o">=</span><span class="n">eCiudadConcreto</span><span class="o">.</span><span class="na">getNodeName</span><span class="o">();</span>
                <span class="k">return</span> <span class="n">nombre</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">imprimirMismaCiudad</span><span class="o">(</span><span class="n">Node</span> <span class="n">raiz</span><span class="o">){</span>
                <span class="n">NodeList</span> <span class="n">hijos</span><span class="o">=</span><span class="n">raiz</span><span class="o">.</span><span class="na">getChildNodes</span><span class="o">();</span>
                <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">hijos</span><span class="o">.</span><span class="na">getLength</span><span class="o">();</span> <span class="n">i</span><span class="o">++){</span>
                        <span class="n">Node</span> <span class="n">hijo</span><span class="o">=</span><span class="n">hijos</span><span class="o">.</span><span class="na">item</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
                        <span class="k">if</span> <span class="o">(</span><span class="n">hijo</span><span class="o">.</span><span class="na">getNodeType</span><span class="o">()!=</span><span class="n">Node</span><span class="o">.</span><span class="na">ELEMENT_NODE</span><span class="o">){</span>
                                <span class="k">continue</span><span class="o">;</span>
                        <span class="o">}</span>
                        <span class="n">String</span> <span class="n">ciudadHijo</span><span class="o">=</span>
                                        <span class="k">this</span><span class="o">.</span><span class="na">getCiudadProcedencia</span><span class="o">((</span><span class="n">Element</span><span class="o">)</span><span class="n">hijo</span><span class="o">);</span>
                        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">j</span><span class="o">=</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="o">;</span> <span class="n">j</span><span class="o">&lt;</span><span class="n">hijos</span><span class="o">.</span><span class="na">getLength</span><span class="o">();</span> <span class="n">j</span><span class="o">++){</span>
                                <span class="n">Node</span> <span class="n">otroHijo</span><span class="o">=</span><span class="n">hijos</span><span class="o">.</span><span class="na">item</span><span class="o">(</span><span class="n">j</span><span class="o">);</span>
                                <span class="k">if</span> <span class="o">(</span><span class="n">otroHijo</span><span class="o">.</span><span class="na">getNodeType</span><span class="o">()!=</span><span class="n">Node</span><span class="o">.</span><span class="na">ELEMENT_NODE</span><span class="o">){</span>
                                        <span class="k">continue</span><span class="o">;</span>
                                <span class="o">}</span>

                                <span class="n">String</span> <span class="n">ciudadOtro</span><span class="o">=</span>
                                                <span class="k">this</span><span class="o">.</span><span class="na">getCiudadProcedencia</span><span class="o">((</span><span class="n">Element</span><span class="o">)</span><span class="n">otroHijo</span><span class="o">);</span>
                                <span class="k">if</span> <span class="o">(</span><span class="n">ciudadHijo</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">ciudadOtro</span><span class="o">)){</span>
                                        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span>
                                                        <span class="s">&quot;Encontré dos elementos con la ciudad &quot;</span><span class="o">+</span><span class="n">ciudadHijo</span><span class="o">);</span>

                                <span class="o">}</span> <span class="c1">//Fin del if ciudadHijo</span>
                        <span class="o">}</span> <span class="c1">//Fin del for interno</span>
                <span class="o">}</span> <span class="c1">//Fin del for externo</span>
        <span class="o">}</span> <span class="c1">//Fin del método</span>

        <span class="kd">public</span> <span class="n">String</span><span class="o">[]</span> <span class="nf">obtenerListaBonos</span><span class="o">(</span><span class="n">Node</span> <span class="n">raiz</span><span class="o">){</span>
                <span class="kt">int</span> <span class="n">tamanioMaximo</span><span class="o">=</span><span class="mi">1000</span><span class="o">;</span>
                <span class="n">String</span><span class="o">[]</span> <span class="n">ciudades</span><span class="o">=</span><span class="k">new</span> <span class="n">String</span><span class="o">[</span><span class="n">tamanioMaximo</span><span class="o">];</span>
                <span class="n">String</span><span class="o">[]</span> <span class="n">aux</span><span class="o">=</span><span class="k">new</span> <span class="n">String</span><span class="o">[</span><span class="n">tamanioMaximo</span><span class="o">];</span>
                <span class="kt">int</span> <span class="n">posPrecio</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span>
                <span class="n">Element</span> <span class="n">eRaiz</span><span class="o">=(</span><span class="n">Element</span><span class="o">)</span> <span class="n">raiz</span><span class="o">;</span>
                <span class="n">NodeList</span> <span class="n">listaBonos</span><span class="o">=</span><span class="n">eRaiz</span><span class="o">.</span><span class="na">getElementsByTagName</span><span class="o">(</span><span class="s">&quot;bono&quot;</span><span class="o">);</span>
                <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">listaBonos</span><span class="o">.</span><span class="na">getLength</span><span class="o">();</span> <span class="n">i</span><span class="o">++){</span>
                        <span class="n">Element</span> <span class="n">bono</span><span class="o">=(</span><span class="n">Element</span><span class="o">)</span> <span class="n">listaBonos</span><span class="o">.</span><span class="na">item</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
                        <span class="n">String</span> <span class="n">atEstable</span><span class="o">=</span><span class="n">bono</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&quot;estable&quot;</span><span class="o">);</span>
                        <span class="k">if</span> <span class="o">(</span><span class="n">atEstable</span><span class="o">!=</span><span class="kc">null</span><span class="o">){</span>
                                <span class="k">if</span> <span class="o">(</span><span class="n">atEstable</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">&quot;no&quot;</span><span class="o">)){</span>
                                        <span class="c1">//Examinamos la ciudad aprovechando</span>
                                        <span class="c1">//un método ya construido.</span>
                                        <span class="n">String</span> <span class="n">ciudad</span><span class="o">=</span><span class="k">this</span><span class="o">.</span><span class="na">getCiudadProcedencia</span><span class="o">(</span><span class="n">bono</span><span class="o">);</span>
                                        <span class="k">if</span> <span class="o">(</span><span class="n">ciudad</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">&quot;tokio&quot;</span><span class="o">)){</span>
                                                <span class="c1">//Si es de tokio, copiamos el precio</span>
                                                <span class="n">String</span> <span class="n">precio</span><span class="o">=</span><span class="n">bono</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&quot;precio&quot;</span><span class="o">);</span>
                                                <span class="n">aux</span><span class="o">[</span><span class="n">posPrecio</span><span class="o">]=</span><span class="n">precio</span><span class="o">;</span>
                                                <span class="n">posPrecio</span><span class="o">++;</span>
                                        <span class="o">}</span> <span class="c1">//Fin del if para tokio</span>
                                <span class="o">}</span> <span class="c1">//Fin del if para el &quot;no&quot;</span>
                        <span class="o">}</span> <span class="c1">//Fin del if para atEstable</span>
                <span class="o">}</span> <span class="c1">//Fin del for que recorre los bonos</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">posPrecio</span><span class="o">&gt;</span><span class="mi">2</span><span class="o">){</span>
                        <span class="k">return</span> <span class="n">aux</span><span class="o">;</span>
                <span class="o">}</span>
                <span class="k">return</span> <span class="n">ciudades</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">crearElemento</span><span class="o">(</span><span class="n">Document</span> <span class="n">d</span><span class="o">,</span>
                        <span class="n">String</span> <span class="n">nombre</span><span class="o">,</span><span class="n">String</span> <span class="n">contenido</span><span class="o">){</span>
                <span class="n">Element</span> <span class="n">e</span><span class="o">=</span><span class="n">d</span><span class="o">.</span><span class="na">createElement</span><span class="o">(</span><span class="n">nombre</span><span class="o">);</span>
                <span class="n">e</span><span class="o">.</span><span class="na">setTextContent</span><span class="o">(</span><span class="n">contenido</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">crearRSS</span><span class="o">(){</span>
                <span class="n">DocumentBuilderFactory</span> <span class="n">fabrica</span><span class="o">;</span>
                <span class="n">DocumentBuilder</span> <span class="n">constructor</span><span class="o">;</span>
                <span class="n">Document</span> <span class="n">documentoXML</span><span class="o">;</span>
                <span class="k">try</span><span class="o">{</span>
                        <span class="n">fabrica</span><span class="o">=</span>
                                        <span class="n">DocumentBuilderFactory</span><span class="o">.</span><span class="na">newInstance</span><span class="o">();</span>
                        <span class="n">constructor</span><span class="o">=</span><span class="n">fabrica</span><span class="o">.</span><span class="na">newDocumentBuilder</span><span class="o">();</span>
                        <span class="n">documentoXML</span><span class="o">=</span><span class="n">constructor</span><span class="o">.</span><span class="na">newDocument</span><span class="o">();</span>
                        <span class="n">TransformerFactory</span> <span class="n">fabricaConv</span> <span class="o">=</span>
                                        <span class="n">TransformerFactory</span><span class="o">.</span><span class="na">newInstance</span><span class="o">();</span>
                        <span class="n">Transformer</span> <span class="n">transformador</span> <span class="o">=</span>
                                        <span class="n">fabricaConv</span><span class="o">.</span><span class="na">newTransformer</span><span class="o">();</span>
                        <span class="n">DOMSource</span> <span class="n">origenDOM</span> <span class="o">=</span>
                                        <span class="k">new</span> <span class="n">DOMSource</span><span class="o">(</span><span class="n">documentoXML</span><span class="o">);</span>
                        <span class="n">Element</span> <span class="n">e</span><span class="o">=</span><span class="n">documentoXML</span><span class="o">.</span><span class="na">createElement</span><span class="o">(</span><span class="s">&quot;rss&quot;</span><span class="o">);</span>
                        <span class="n">documentoXML</span><span class="o">.</span><span class="na">appendChild</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
                        <span class="n">StreamResult</span> <span class="n">resultado</span><span class="o">=</span>
                                        <span class="k">new</span> <span class="n">StreamResult</span><span class="o">(</span>
                                                        <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="s">&quot;D:\\oscar\\archivo.rss&quot;</span><span class="o">));</span>
                        <span class="n">transformador</span><span class="o">.</span><span class="na">transform</span><span class="o">(</span><span class="n">origenDOM</span><span class="o">,</span> <span class="n">resultado</span><span class="o">);</span>
                <span class="o">}</span>
                <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">){</span>
                        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="s">&quot;No se han podido crear los&quot;</span><span class="o">);</span>
                        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot; objetos necesarios.&quot;</span><span class="o">);</span>
                        <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
                        <span class="k">return</span> <span class="o">;</span>
                <span class="o">}</span>
        <span class="o">}</span>

        <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span> <span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">argumentos</span><span class="o">){</span>
                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Probando...&quot;</span><span class="o">);</span>
                <span class="n">ProcesadorXML</span> <span class="n">proc</span><span class="o">=</span><span class="k">new</span> <span class="n">ProcesadorXML</span><span class="o">();</span>
                <span class="n">Node</span> <span class="n">nodoRaiz</span><span class="o">=</span><span class="n">proc</span><span class="o">.</span><span class="na">extraerRaiz</span><span class="o">(</span><span class="s">&quot;bolsas.xml&quot;</span><span class="o">);</span>
<span class="c1">//              proc.imprimirNombreDeLaRaiz(nodoRaiz);</span>
<span class="c1">//              proc.imprimirHijos(nodoRaiz);</span>
<span class="c1">//              proc.imprimirHijos2(nodoRaiz);</span>
<span class="c1">//              int cuantosFuturos=proc.contadorElementos(nodoRaiz, &quot;futuro&quot;);</span>
<span class="c1">//              System.out.println(&quot;Hay &quot;+cuantosFuturos);</span>
<span class="c1">//              proc.imprimirPrecioBonos(nodoRaiz);</span>
<span class="c1">//              int inestables=proc.cuantosInestables(nodoRaiz);</span>
<span class="c1">//              System.out.println(&quot;Inestables hay:&quot;+inestables);</span>
<span class="c1">//              float preciosTotales=proc.sumarAtributosPrecio(nodoRaiz);</span>
<span class="c1">//              System.out.println(&quot;La suma total es:&quot;+preciosTotales);</span>
                <span class="kt">int</span> <span class="n">cuantos</span><span class="o">=</span><span class="n">proc</span><span class="o">.</span><span class="na">algoQueVerCon</span><span class="o">(</span><span class="n">nodoRaiz</span><span class="o">,</span> <span class="s">&quot;Islandia&quot;</span><span class="o">);</span>
<span class="c1">//              System.out.println(&quot;Num paises Islandia:&quot;+cuantos);</span>
<span class="c1">//              cuantos=proc.cuantosFuturosTienenCiudadProcedencia(</span>
<span class="c1">//                              nodoRaiz, &quot;madrid&quot;);</span>
<span class="c1">//              System.out.println(&quot;Futuros de Madrid:&quot;+cuantos);</span>
<span class="c1">//              cuantos=proc.letrasConPaisEmisor(nodoRaiz, &quot;espania&quot;);</span>
<span class="c1">//              System.out.println(&quot;Letras con espania:&quot;+cuantos);</span>
                <span class="n">cuantos</span><span class="o">=</span><span class="n">proc</span><span class="o">.</span><span class="na">algoQueVerConEspania</span><span class="o">(</span><span class="n">nodoRaiz</span><span class="o">);</span>
                <span class="c1">//System.out.println(&quot;Productos rel. con España:&quot;+cuantos);</span>
                <span class="c1">//proc.imprimirBonos(nodoRaiz);</span>
                <span class="n">proc</span><span class="o">.</span><span class="na">imprimirMismaCiudad</span><span class="o">(</span><span class="n">nodoRaiz</span><span class="o">);</span>
                <span class="n">String</span><span class="o">[]</span> <span class="n">resultados</span><span class="o">=</span><span class="n">proc</span><span class="o">.</span><span class="na">obtenerListaBonos</span><span class="o">(</span><span class="n">nodoRaiz</span><span class="o">);</span>
                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;La ciudad 0 es:&quot;</span><span class="o">+</span><span class="n">resultados</span><span class="o">[</span><span class="mi">0</span><span class="o">]);</span>
                <span class="n">proc</span><span class="o">.</span><span class="na">crearRSS</span><span class="o">();</span>
        <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="archivo-xml">
<h3>Archivo XML<a class="headerlink" href="#archivo-xml" title="Enlazar permanentemente con este título">¶</a></h3>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span>
<span class="cp">&lt;!DOCTYPE listado [</span>
<span class="cp">        &lt;!ELEMENT listado (futuro+, divisa+, bono+, letra+)&gt;</span>
        <span class="cp">&lt;!ATTLIST futuro precio CDATA #REQUIRED&gt;</span>
        <span class="cp">&lt;!ATTLIST divisa precio CDATA #REQUIRED&gt;</span>
        <span class="cp">&lt;!ATTLIST bono precio CDATA #REQUIRED&gt;</span>
        <span class="cp">&lt;!ATTLIST letra precio CDATA #REQUIRED&gt;</span>
        <span class="cp">&lt;!ELEMENT ciudad_procedencia (madrid|nyork|frankfurt|tokio)&gt;</span>
        <span class="cp">&lt;!ELEMENT madrid EMPTY&gt;</span>
        <span class="cp">&lt;!ELEMENT nyork EMPTY&gt;</span>
        <span class="cp">&lt;!ELEMENT frankfurt EMPTY&gt;</span>
        <span class="cp">&lt;!ELEMENT tokio EMPTY&gt;</span>
        <span class="cp">&lt;!ATTLIST divisa estable CDATA #IMPLIED&gt;</span>
        <span class="cp">&lt;!ATTLIST bono estable CDATA #IMPLIED&gt;</span>
        <span class="cp">&lt;!ELEMENT futuro (producto, mercado?, ciudad_procedencia)&gt;</span>
        <span class="cp">&lt;!ELEMENT producto (#PCDATA)&gt;</span>
        <span class="cp">&lt;!ELEMENT mercado (#PCDATA)&gt;</span>
        <span class="cp">&lt;!ELEMENT bono (pais_de_procedencia,valor_deseado,</span>
<span class="cp">                        valor_minimo, valor_maximo, ciudad_procedencia)&gt;</span>
        <span class="cp">&lt;!ELEMENT valor_deseado (#PCDATA)&gt;</span>
        <span class="cp">&lt;!ELEMENT valor_minimo (#PCDATA)&gt;</span>
        <span class="cp">&lt;!ELEMENT valor_maximo (#PCDATA)&gt;</span>
        <span class="cp">&lt;!ELEMENT pais_de_procedencia (#PCDATA)&gt;</span>
        <span class="cp">&lt;!ELEMENT divisa (nombre_divisa,</span>
<span class="cp">                        tipo_de_cambio+, ciudad_procedencia)&gt;</span>
        <span class="cp">&lt;!ELEMENT nombre_divisa (#PCDATA)&gt;</span>
        <span class="cp">&lt;!ELEMENT tipo_de_cambio (#PCDATA)&gt;</span>
        <span class="cp">&lt;!ELEMENT letra (tipo_de_interes, pais_emisor,ciudad_procedencia)&gt;</span>
        <span class="cp">&lt;!ELEMENT tipo_de_interes (#PCDATA)&gt;</span>
        <span class="cp">&lt;!ELEMENT pais_emisor (espania|eeuu|alemania|japon)&gt;</span>
        <span class="cp">&lt;!ELEMENT espania     EMPTY&gt;</span>
        <span class="cp">&lt;!ELEMENT eeuu        EMPTY&gt;</span>
        <span class="cp">&lt;!ELEMENT alemania    EMPTY&gt;</span>
        <span class="cp">&lt;!ELEMENT japon       EMPTY&gt;</span>
]&gt;


<span class="nt">&lt;listado&gt;&lt;futuro</span> <span class="na">precio=</span><span class="s">&quot;11.28&quot;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;producto&gt;</span>Cafe<span class="nt">&lt;/producto&gt;</span>
                <span class="nt">&lt;mercado&gt;</span>América Latina<span class="nt">&lt;/mercado&gt;</span>
                <span class="nt">&lt;ciudad_procedencia&gt;</span>
                        <span class="nt">&lt;madrid/&gt;</span>
                <span class="nt">&lt;/ciudad_procedencia&gt;</span>
        <span class="nt">&lt;/futuro&gt;</span>
        <span class="nt">&lt;divisa</span> <span class="na">precio=</span><span class="s">&quot;183&quot;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;nombre_divisa&gt;</span>Libra esterlina<span class="nt">&lt;/nombre_divisa&gt;</span>
                <span class="nt">&lt;tipo_de_cambio&gt;</span>2.7:1 euros<span class="nt">&lt;/tipo_de_cambio&gt;</span>
                <span class="nt">&lt;tipo_de_cambio&gt;</span>1:0.87 dólares<span class="nt">&lt;/tipo_de_cambio&gt;</span>
                <span class="nt">&lt;ciudad_procedencia&gt;</span>
                        <span class="nt">&lt;madrid/&gt;</span>
                <span class="nt">&lt;/ciudad_procedencia&gt;</span>
        <span class="nt">&lt;/divisa&gt;</span>
        <span class="nt">&lt;bono</span> <span class="na">precio=</span><span class="s">&quot;100&quot;</span> <span class="na">estable=</span><span class="s">&quot;si&quot;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;pais_de_procedencia&gt;</span>
                        España
                <span class="nt">&lt;/pais_de_procedencia&gt;</span>
                <span class="nt">&lt;valor_deseado&gt;</span>9980<span class="nt">&lt;/valor_deseado&gt;</span>
                <span class="nt">&lt;valor_minimo&gt;</span>9950<span class="nt">&lt;/valor_minimo&gt;</span>
                <span class="nt">&lt;valor_maximo&gt;</span>10020<span class="nt">&lt;/valor_maximo&gt;</span>
                <span class="nt">&lt;ciudad_procedencia&gt;</span>
                        <span class="nt">&lt;tokio/&gt;</span>
                <span class="nt">&lt;/ciudad_procedencia&gt;</span>
        <span class="nt">&lt;/bono&gt;</span>
        <span class="nt">&lt;bono</span> <span class="na">precio=</span><span class="s">&quot;10000&quot;</span> <span class="na">estable=</span><span class="s">&quot;si&quot;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;pais_de_procedencia&gt;</span>
                        España
                <span class="nt">&lt;/pais_de_procedencia&gt;</span>
                <span class="nt">&lt;valor_deseado&gt;</span>9980<span class="nt">&lt;/valor_deseado&gt;</span>
                <span class="nt">&lt;valor_minimo&gt;</span>9950<span class="nt">&lt;/valor_minimo&gt;</span>
                <span class="nt">&lt;valor_maximo&gt;</span>10020<span class="nt">&lt;/valor_maximo&gt;</span>
                <span class="nt">&lt;ciudad_procedencia&gt;</span>
                        <span class="nt">&lt;tokio/&gt;</span>
                <span class="nt">&lt;/ciudad_procedencia&gt;</span>
        <span class="nt">&lt;/bono&gt;</span>
        <span class="nt">&lt;bono</span> <span class="na">precio=</span><span class="s">&quot;10000&quot;</span> <span class="na">estable=</span><span class="s">&quot;no&quot;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;pais_de_procedencia&gt;</span>
                        España
                <span class="nt">&lt;/pais_de_procedencia&gt;</span>
                <span class="nt">&lt;valor_deseado&gt;</span>9980<span class="nt">&lt;/valor_deseado&gt;</span>
                <span class="nt">&lt;valor_minimo&gt;</span>9950<span class="nt">&lt;/valor_minimo&gt;</span>
                <span class="nt">&lt;valor_maximo&gt;</span>10020<span class="nt">&lt;/valor_maximo&gt;</span>
                <span class="nt">&lt;ciudad_procedencia&gt;</span>
                        <span class="nt">&lt;tokio/&gt;</span>
                <span class="nt">&lt;/ciudad_procedencia&gt;</span>
        <span class="nt">&lt;/bono&gt;</span>
        <span class="nt">&lt;bono</span> <span class="na">precio=</span><span class="s">&quot;10000&quot;</span> <span class="na">estable=</span><span class="s">&quot;no&quot;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;pais_de_procedencia&gt;</span>
                        España
                <span class="nt">&lt;/pais_de_procedencia&gt;</span>
                <span class="nt">&lt;valor_deseado&gt;</span>9980<span class="nt">&lt;/valor_deseado&gt;</span>
                <span class="nt">&lt;valor_minimo&gt;</span>9950<span class="nt">&lt;/valor_minimo&gt;</span>
                <span class="nt">&lt;valor_maximo&gt;</span>10020<span class="nt">&lt;/valor_maximo&gt;</span>
                <span class="nt">&lt;ciudad_procedencia&gt;</span>
                        <span class="nt">&lt;tokio/&gt;</span>
                <span class="nt">&lt;/ciudad_procedencia&gt;</span>
        <span class="nt">&lt;/bono&gt;</span>
        <span class="nt">&lt;letra</span> <span class="na">precio=</span><span class="s">&quot;45020&quot;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;tipo_de_interes&gt;</span>4.54%<span class="nt">&lt;/tipo_de_interes&gt;</span>
                <span class="nt">&lt;pais_emisor&gt;</span>
                        <span class="nt">&lt;espania/&gt;</span>
                <span class="nt">&lt;/pais_emisor&gt;</span>
                <span class="nt">&lt;ciudad_procedencia&gt;</span>
                        <span class="nt">&lt;madrid/&gt;</span>
                <span class="nt">&lt;/ciudad_procedencia&gt;</span>
        <span class="nt">&lt;/letra&gt;</span>
<span class="nt">&lt;/listado&gt;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="procesamiento-con-sax">
<h2>Procesamiento con SAX<a class="headerlink" href="#procesamiento-con-sax" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Simple Api for XML (o SAX) es un conjunto de clases para procesar XML de una forma muchísimo más eficiente (pero también más incómoda). Consiste en un <em>parser</em> que va leyendo etiqueta por etiqueta. Cada vez que el parser encuentra una etiqueta nueva nos lo comunicará mediante un evento y tendremos que incluir código de gestión de eventos que decidan que hacer.</p>
<p>La forma más sencilla de trabajar es hacer que nuestra clase herede de <code class="docutils literal notranslate"><span class="pre">DefaultHandler</span></code> y sobrecargar el código de los métodos <code class="docutils literal notranslate"><span class="pre">startElement</span></code> y <code class="docutils literal notranslate"><span class="pre">endElement</span></code>.</p>
<p>Cuando se procesa XML podemos encontrarnos con que se usen o no espacios de nombres. Si usamos espacios de nombres SAX nos devolverá un argumento pero si no los usamos SAX nos devolverá otro argumento. Observemos el siguiente código:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ProcesadorSAX</span> <span class="kd">extends</span> <span class="n">DefaultHandler</span><span class="o">{</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">startElement</span><span class="o">(</span>
      <span class="n">String</span> <span class="n">ns</span><span class="o">,</span> <span class="n">String</span> <span class="n">nombreCuandoHayNS</span><span class="o">,</span>
      <span class="n">String</span> <span class="n">nombreCuandoNoHayNS</span><span class="o">,</span>
      <span class="n">Attributes</span> <span class="n">atributos</span><span class="o">)</span>
      <span class="kd">throws</span> <span class="n">SAXException</span>
  <span class="o">{</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">nombreCuandoNoHayNS</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<p>En este código SAX avisará a nuestro método <code class="docutils literal notranslate"><span class="pre">startElement</span></code> (el nombre debe ser así), cada vez que
encuentre una etiqueta. Como en nuestros documentos no estamos usando espacios de nombres nos interesa imprimir el tercer parámetro.</p>
<p>Para hacer que Java procese un fichero mediante SAX usando nuestra clase como procesador de etiquetas haremos lo siguiente:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ProcesadorSAX</span> <span class="kd">extends</span> <span class="n">DefaultHandler</span><span class="o">{</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">startElement</span><span class="o">(</span>
      <span class="n">String</span> <span class="n">ns</span><span class="o">,</span> <span class="n">String</span> <span class="n">nombreCuandoHayNS</span><span class="o">,</span>
      <span class="n">String</span> <span class="n">nombreCuandoNoHayNS</span><span class="o">,</span>
      <span class="n">Attributes</span> <span class="n">atributos</span><span class="o">)</span>
      <span class="kd">throws</span> <span class="n">SAXException</span>
  <span class="o">{</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">nombreCuandoNoHayNS</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span>
      <span class="kd">throws</span> <span class="n">ParserConfigurationException</span><span class="o">,</span>
      <span class="n">SAXException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>

    <span class="n">SAXParserFactory</span> <span class="n">fabrica</span><span class="o">;</span>
    <span class="n">fabrica</span><span class="o">=</span><span class="n">SAXParserFactory</span><span class="o">.</span><span class="na">newInstance</span><span class="o">();</span>
    <span class="n">SAXParser</span> <span class="n">parser</span><span class="o">=</span><span class="n">fabrica</span><span class="o">.</span><span class="na">newSAXParser</span><span class="o">();</span>
    <span class="n">XMLReader</span> <span class="n">lector</span><span class="o">=</span><span class="n">parser</span><span class="o">.</span><span class="na">getXMLReader</span><span class="o">();</span>
    <span class="n">lector</span><span class="o">.</span><span class="na">setContentHandler</span><span class="o">(</span><span class="k">new</span> <span class="n">ProcesadorSAX</span><span class="o">());</span>
    <span class="n">lector</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span>
      <span class="s">&quot;c:/users/ogomez/documents/finanzas.xml&quot;</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<p>Ahora Java irá leyendo el fichero etiqueta por etiqueta y mostrándonos los nombres de todas. No importará que el fichero ocupe varios GB, ya que SAX no cargará el fichero completo en memoria.</p>
<div class="section" id="ejercicio-encontrar-producto">
<h3>Ejercicio: encontrar producto<a class="headerlink" href="#ejercicio-encontrar-producto" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Encontrar todos los productos cuyo nombre sea «Cafe» y su mercado «América Latina».</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kt">void</span> <span class="nf">characters</span><span class="o">(</span>
      <span class="kt">char</span><span class="o">[]</span> <span class="n">letras</span><span class="o">,</span> <span class="kt">int</span> <span class="n">ini</span><span class="o">,</span> <span class="kt">int</span> <span class="n">longitud</span><span class="o">){</span>
    <span class="k">if</span> <span class="o">((</span><span class="n">mercadoEncontrado</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="o">(</span><span class="n">cafeEncontrado</span><span class="o">)){</span>
      <span class="n">String</span> <span class="n">cadena</span><span class="o">=</span><span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="n">letras</span><span class="o">,</span> <span class="n">ini</span><span class="o">,</span> <span class="n">longitud</span><span class="o">);</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">cadena</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">&quot;América Latina&quot;</span><span class="o">)){</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Encontrado Cafe de AL&quot;</span><span class="o">);</span>
        <span class="n">cafeEncontrado</span><span class="o">=</span><span class="kc">false</span><span class="o">;</span>
        <span class="n">mercadoEncontrado</span><span class="o">=</span><span class="kc">false</span><span class="o">;</span>
        <span class="n">productoEncontrado</span><span class="o">=</span><span class="kc">false</span><span class="o">;</span>
        <span class="n">futuroEncontrado</span><span class="o">=</span><span class="kc">false</span><span class="o">;</span>
      <span class="o">}</span>
    <span class="o">}</span>
    <span class="k">if</span> <span class="o">((</span><span class="n">productoEncontrado</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="o">(</span><span class="n">futuroEncontrado</span><span class="o">)){</span>
      <span class="n">String</span> <span class="n">cadena</span><span class="o">=</span><span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="n">letras</span><span class="o">,</span> <span class="n">ini</span><span class="o">,</span> <span class="n">longitud</span><span class="o">);</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">cadena</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">&quot;Cafe&quot;</span><span class="o">)){</span>
        <span class="n">cafeEncontrado</span><span class="o">=</span><span class="kc">true</span><span class="o">;</span>
      <span class="o">}</span> <span class="c1">//Fin del if interno</span>
    <span class="o">}</span> <span class="c1">//Fin del if externo</span>
  <span class="o">}</span> <span class="c1">//Fin del método characters</span>
</pre></div>
</div>
</div>
<div class="section" id="ejercicio-precios">
<h3>Ejercicio: precios<a class="headerlink" href="#ejercicio-precios" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Encontrar todos las divisas cuya ciudad de procedencia sea «Madrid».</p>
</div>
</div>
<div class="section" id="ejercicios-para-preparar-examen">
<h2>Ejercicios para preparar examen<a class="headerlink" href="#ejercicios-para-preparar-examen" title="Enlazar permanentemente con este título">¶</a></h2>
<ol class="arabic simple">
<li><p>Indicar cuantas letras tienen un tipo de interés inferior al 3% e indicar para cada una de ellas el país emisor.</p></li>
<li><p>Comprobar si hay alguna divisa con nombre «Euro» cuyo precio sea mayor de 195.</p></li>
<li><p>Indicar todos los productos que tengan la misma ciudad de procedencia.</p></li>
</ol>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="tema7.html" class="btn btn-neutral float-right" title="Sindicación y transformación de contenidos" accesskey="n" rel="next">Siguiente <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="tema5.html" class="btn btn-neutral float-left" title="XML" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Anterior</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2016, Oscar Gomez

    </p>
  </div>
    
    
    
    Construido con <a href="http://sphinx-doc.org/">Sphinx</a> usando un
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">tema</a>
    
    proporcionado por <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>